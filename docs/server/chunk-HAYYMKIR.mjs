import './polyfills.server.mjs';
import{$ as re,A as ee,Aa as J0,B as G0,Ba as X0,C as St,D as Xt,E as pr,Ea as Z0,F as j0,G as X,H as Z,I as W0,Ia as eb,J as wa,K as Pr,L as Cf,La as tb,M as Ps,Ma as Df,N as te,O as _e,P as wf,Q as Ea,R as Vi,S as ln,T as cn,U as Ef,V,W as z,X as Un,Y as et,Z as Te,_ as ct,a as Ns,aa as un,b as Ec,ba as xc,c as Tc,ca as Fs,d as L0,da as H0,e as Fi,ea as be,f as Os,fa as Se,g as qn,ga as Ce,h as Or,ha as Mc,i as ve,ia as Tf,j as V0,ja as K0,k as B0,l as Ca,la as $0,m as q0,n as U0,o as Ac,p as Ic,q as bf,qa as Af,r as Dc,ra as Q0,s as Li,t as Sf,ta as Y0,u as z0,ua as Ta,v as Rc,va as Fr,w as kc,wa as If,x as Ke,y as Jt,ya as dn,z as $e,za as Nc}from"./chunk-PAL4DEMT.mjs";import{a as nb,b as Rf,c as rb,d as Aa,e as kf,f as Oc,g as ib,h as sb,i as xf,j as Ve,k as Bi,l as zn,m as Pc,n as Ia,o as ob,p as ab,q as Lr,r as Zt}from"./chunk-XKLCX4PC.mjs";import{a as ne,b as Yt,c as Ee,f as R,h as F0,i as _f,j as C}from"./chunk-EXD34EPT.mjs";var we=R(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=hn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=hn.Propagate=hn.LogVerbosity=hn.Status=void 0;var Yb=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(Yb||(hn.Status=Yb={})),Jb=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(Jb||(hn.LogVerbosity=Jb={})),Xb=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(Xb||(hn.Propagate=Xb={}));hn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;hn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Zf=R((vG,pk)=>{pk.exports={name:"@grpc/grpc-js",version:"1.9.15",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var je=R(Ot=>{"use strict";var ep,tp,np,rp;Object.defineProperty(Ot,"__esModule",{value:!0});Ot.isTracerEnabled=Ot.trace=Ot.log=Ot.setLoggerVerbosity=Ot.setLogger=Ot.getLogger=void 0;var qr=we(),mk=Ee("process"),gk=Zf().version,yk={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},zi=yk,Gs=qr.LogVerbosity.ERROR,vk=(tp=(ep=process.env.GRPC_NODE_VERBOSITY)!==null&&ep!==void 0?ep:process.env.GRPC_VERBOSITY)!==null&&tp!==void 0?tp:"";switch(vk.toUpperCase()){case"DEBUG":Gs=qr.LogVerbosity.DEBUG;break;case"INFO":Gs=qr.LogVerbosity.INFO;break;case"ERROR":Gs=qr.LogVerbosity.ERROR;break;case"NONE":Gs=qr.LogVerbosity.NONE;break;default:}var _k=()=>zi;Ot.getLogger=_k;var bk=n=>{zi=n};Ot.setLogger=bk;var Sk=n=>{Gs=n};Ot.setLoggerVerbosity=Sk;var Ck=(n,...e)=>{let t;if(n>=Gs){switch(n){case qr.LogVerbosity.DEBUG:t=zi.debug;break;case qr.LogVerbosity.INFO:t=zi.info;break;case qr.LogVerbosity.ERROR:t=zi.error;break}t||(t=zi.error),t&&t.bind(zi)(...e)}};Ot.log=Ck;var wk=(rp=(np=process.env.GRPC_NODE_TRACE)!==null&&np!==void 0?np:process.env.GRPC_TRACE)!==null&&rp!==void 0?rp:"",ip=new Set,Zb=new Set;for(let n of wk.split(","))n.startsWith("-")?Zb.add(n.substring(1)):ip.add(n);var Ek=ip.has("all");function Tk(n,e,t){eS(e)&&(0,Ot.log)(n,new Date().toISOString()+" | v"+gk+" "+mk.pid+" | "+e+" | "+t)}Ot.trace=Tk;function eS(n){return!Zb.has(n)&&(Ek||ip.has(n))}Ot.isTracerEnabled=eS});var Yc=R(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.getErrorCode=js.getErrorMessage=void 0;function Ak(n){return n instanceof Error?n.message:String(n)}js.getErrorMessage=Ak;function Ik(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}js.getErrorCode=Ik});var jt=R(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.Metadata=void 0;var Dk=je(),Rk=we(),kk=Yc(),xk=/^[0-9a-z_.-]+$/,Mk=/^[ -~]*$/;function Nk(n){return xk.test(n)}function Ok(n){return Mk.test(n)}function nS(n){return n.endsWith("-bin")}function Pk(n){return!n.startsWith("grpc-")}function Jc(n){return n.toLowerCase()}function tS(n,e){if(!Nk(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(nS(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!Ok(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var sp=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=Jc(e),tS(e,t),this.internalRepr.set(e,[t])}add(e,t){e=Jc(e),tS(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=Jc(e),this.internalRepr.delete(e)}get(e){return e=Jc(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(Fk);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{nS(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(Pk(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,kk.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,Dk.log)(Rk.LogVerbosity.ERROR,o)}}return t}};Xc.Metadata=sp;var Fk=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var up=R(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.CallCredentials=void 0;var cp=jt();function Lk(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Ws=class n{static createFromMetadataGenerator(e){return new ap(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;Lk(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new cp.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new lp}};Zc.CallCredentials=Ws;var op=class n extends Ws{constructor(e){super(),this.creds=e}generateMetadata(e){return C(this,null,function*(){let t=new cp.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},ap=class n extends Ws{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new op([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},lp=class n extends Ws{generateMetadata(e){return Promise.resolve(new cp.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var hp=R(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});Hs.getDefaultRootsData=Hs.CIPHER_SUITES=void 0;var Vk=Ee("fs");Hs.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var rS=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,dp=null;function Bk(){return rS?(dp===null&&(dp=Vk.readFileSync(rS)),dp):null}Hs.getDefaultRootsData=Bk});var nu=R(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});tu.ChannelCredentials=void 0;var qk=Ee("tls"),Uk=up(),iS=hp();function fp(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Ks=class{constructor(e){this.callCredentials=e||Uk.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(fp(e,"Root certificate"),fp(t,"Private key"),fp(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,qk.createSecureContext)({ca:(s=e??(0,iS.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:iS.CIPHER_SUITES});return new eu(o,i??{})}static createFromSecureContext(e,t){return new eu(e,t??{})}static createInsecure(){return new pp}};tu.ChannelCredentials=Ks;var pp=class n extends Ks{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},eu=class n extends Ks{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new mp(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},mp=class n extends Ks{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var zr=R(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.validateLoadBalancingConfig=wt.getFirstUsableConfig=wt.isLoadBalancerNameRegistered=wt.createLoadBalancer=wt.registerDefaultLoadBalancerType=wt.registerLoadBalancerType=wt.createChildChannelControlHelper=void 0;function zk(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}wt.createChildChannelControlHelper=zk;var Ur={},gp=null;function Gk(n,e,t){Ur[n]={LoadBalancer:e,LoadBalancingConfig:t}}wt.registerLoadBalancerType=Gk;function jk(n){gp=n}wt.registerDefaultLoadBalancerType=jk;function Wk(n,e){let t=n.getLoadBalancerName();return t in Ur?new Ur[t].LoadBalancer(e):null}wt.createLoadBalancer=Wk;function Hk(n){return n in Ur}wt.isLoadBalancerNameRegistered=Hk;function Kk(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Ur)return t;return e&&gp?new Ur[gp].LoadBalancingConfig:null}wt.getFirstUsableConfig=Kk;function $k(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Ur)return Ur[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}wt.validateLoadBalancingConfig=$k});var yp=R(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.extractAndSelectServiceConfig=Gr.validateServiceConfig=Gr.validateRetryThrottling=void 0;var Qk=Ee("os"),ru=we(),Yk=zr(),iu=/^\d+(\.\d{1,9})?s$/,Jk="node";function Xk(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function Zk(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!iu.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!iu.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(ru.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(ru.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function ex(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!iu.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(ru.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(ru.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function tx(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(Xk(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&iu.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=Zk(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=ex(n.hedgingPolicy));return t}function sS(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Gr.validateRetryThrottling=sS;function oS(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,Yk.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(tx(r));"retryThrottling"in n&&(e.retryThrottling=sS(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Gr.validateServiceConfig=oS;function nx(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:oS(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function rx(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=nx(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===Qk.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===Jk&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function ix(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return rx(i,e)}return null}Gr.extractAndSelectServiceConfig=ix});var fn=R(su=>{"use strict";Object.defineProperty(su,"__esModule",{value:!0});su.ConnectivityState=void 0;var aS=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(aS||(su.ConnectivityState=aS={}))});var en=R(jr=>{"use strict";Object.defineProperty(jr,"__esModule",{value:!0});jr.uriToString=jr.splitHostPort=jr.parseUri=void 0;var sx=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function ox(n){let e=sx.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}jr.parseUri=ox;var lS=/^\d+$/;function ax(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return lS.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?lS.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}jr.splitHostPort=ax;function lx(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}jr.uriToString=lx});var Gn=R(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.mapUriDefaultScheme=pn.getDefaultAuthority=pn.createResolver=pn.registerDefaultScheme=pn.registerResolver=void 0;var _p=en(),$s={},vp=null;function cx(n,e){$s[n]=e}pn.registerResolver=cx;function ux(n){vp=n}pn.registerDefaultScheme=ux;function dx(n,e,t){if(n.scheme!==void 0&&n.scheme in $s)return new $s[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,_p.uriToString)(n)}`)}pn.createResolver=dx;function hx(n){if(n.scheme!==void 0&&n.scheme in $s)return $s[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,_p.uriToString)(n)}`)}pn.getDefaultAuthority=hx;function fx(n){return n.scheme===void 0||!(n.scheme in $s)?vp!==null?{scheme:vp,authority:void 0,path:(0,_p.uriToString)(n)}:null:n}pn.mapUriDefaultScheme=fx});var Hr=R(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.QueuePicker=Wr.UnavailablePicker=Wr.PickResultType=void 0;var px=jt(),mx=we(),ou=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(ou||(Wr.PickResultType=ou={})),bp=class{constructor(e){this.status=Object.assign({code:mx.Status.UNAVAILABLE,details:"No connection established",metadata:new px.Metadata},e)}pick(e){return{pickResultType:ou.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Wr.UnavailablePicker=bp;var Sp=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:ou.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Wr.QueuePicker=Sp});var La=R(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.BackoffTimeout=void 0;var gx=1e3,yx=1.6,vx=12e4,_x=.2;function bx(n,e){return Math.random()*(e-n)+n}var Cp=class{constructor(e,t){this.callback=e,this.initialDelay=gx,this.multiplier=yx,this.maxDelay=vx,this.jitter=_x,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+bx(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};au.BackoffTimeout=Cp});var cu=R(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.ChildLoadBalancerHandler=void 0;var Sx=zr(),Cx=fn(),wx="child_load_balancer_helper",wp=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===Cx.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,Sx.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return wx}};lu.ChildLoadBalancerHandler=wp});var uS=R(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});uu.ResolvingLoadBalancer=void 0;var Ex=zr(),Tx=yp(),Wt=fn(),Ax=Gn(),Qs=Hr(),Ix=La(),Ep=we(),Dx=jt(),Rx=je(),kx=we(),xx=en(),Mx=cu(),Nx="resolving_load_balancer";function cS(n){Rx.trace(kx.LogVerbosity.DEBUG,Nx,n)}var Ox=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function Px(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function Fx(n,e,t,r){for(let i of t)if(Px(n,e,i,r))return i;return null}function Lx(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of Ox){let u=Fx(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:Ep.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:Ep.Status.OK,dynamicFilterFactories:[]}}}var Tp=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Wt.ConnectivityState.IDLE,this.latestChildPicker=new Qs.QueuePicker(this),this.currentState=Wt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,Tx.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Wt.ConnectivityState.IDLE,new Qs.QueuePicker(this)),this.childLoadBalancer=new Mx.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(cS("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,Ax.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var f;this.backoffTimeout.stop(),this.backoffTimeout.reset();let v=null;l===null?c===null?(this.previousServiceConfig=null,v=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):v=this.previousServiceConfig:(v=l,this.previousServiceConfig=l);let w=(f=v?.loadBalancingConfig)!==null&&f!==void 0?f:[],A=(0,Ex.getFirstUsableConfig)(w,!0);if(A===null){this.handleResolutionFailure({code:Ep.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new Dx.Metadata});return}this.childLoadBalancer.updateAddressList(a,A,d);let T=v??this.defaultServiceConfig;this.onSuccessfulResolution(T,u??Lx(T))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new Ix.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Wt.ConnectivityState.IDLE&&this.updateState(Wt.ConnectivityState.CONNECTING,new Qs.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){cS((0,xx.uriToString)(this.target)+" "+Wt.ConnectivityState[this.currentState]+" -> "+Wt.ConnectivityState[e]),e===Wt.ConnectivityState.IDLE&&(t=new Qs.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Wt.ConnectivityState.IDLE&&(this.updateState(Wt.ConnectivityState.TRANSIENT_FAILURE,new Qs.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Wt.ConnectivityState.IDLE||this.currentState===Wt.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Wt.ConnectivityState.IDLE,this.latestChildPicker=new Qs.QueuePicker(this),this.currentState=Wt.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};uu.ResolvingLoadBalancer=Tp});var dS=R(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.channelOptionsEqual=Ys.recognizedOptions=void 0;Ys.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function Vx(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}Ys.channelOptionsEqual=Vx});var Wn=R(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.stringToSubchannelAddress=jn.subchannelAddressToString=jn.subchannelAddressEqual=jn.isTcpSubchannelAddress=void 0;var Bx=Ee("net");function Va(n){return"port"in n}jn.isTcpSubchannelAddress=Va;function qx(n,e){return!n&&!e?!0:!n||!e?!1:Va(n)?Va(e)&&n.host===e.host&&n.port===e.port:!Va(e)&&n.path===e.path}jn.subchannelAddressEqual=qx;function Ux(n){return Va(n)?n.host+":"+n.port:n.path}jn.subchannelAddressToString=Ux;var zx=443;function Gx(n,e){return(0,Bx.isIP)(n)?{host:n,port:e??zx}:{path:n}}jn.stringToSubchannelAddress=Gx});var du=R(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.addAdminServicesToServer=Js.registerAdminService=void 0;var hS=[];function jx(n,e){hS.push({getServiceDefinition:n,getHandlers:e})}Js.registerAdminService=jx;function Wx(n){for(let{getServiceDefinition:e,getHandlers:t}of hS)n.addService(e(),t())}Js.addAdminServicesToServer=Wx});var fS=R(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.ClientDuplexStreamImpl=mn.ClientWritableStreamImpl=mn.ClientReadableStreamImpl=mn.ClientUnaryCallImpl=mn.callErrorFromStatus=void 0;var Hx=Ee("events"),kp=Ee("stream"),Ba=we();function Kx(n,e){let t=`${n.code} ${Ba.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}mn.callErrorFromStatus=Kx;var Ap=class extends Hx.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ba.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};mn.ClientUnaryCallImpl=Ap;var Ip=class extends kp.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ba.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};mn.ClientReadableStreamImpl=Ip;var Dp=class extends kp.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ba.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};mn.ClientWritableStreamImpl=Dp;var Rp=class extends kp.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(Ba.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};mn.ClientDuplexStreamImpl=Rp});var pS=R(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.InterceptingListenerImpl=Xs.isInterceptingListener=void 0;function $x(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}Xs.isInterceptingListener=$x;var xp=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};Xs.InterceptingListenerImpl=xp});var Vp=R(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.getInterceptingCall=gn.InterceptingCall=gn.RequesterBuilder=gn.ListenerBuilder=gn.InterceptorConfigurationError=void 0;var Qx=jt(),mS=pS(),gS=we(),yS=Yc(),Ua=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};gn.InterceptorConfigurationError=Ua;var Np=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};gn.ListenerBuilder=Np;var Op=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};gn.RequesterBuilder=Op;var Mp={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},qa={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},Pp=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:qa.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:qa.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:qa.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:qa.cancel}:this.requester=qa}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var f,v,w;this.processingMetadata=!1;let A;if((0,mS.isInterceptingListener)(d))A=d;else{let T={onReceiveMetadata:(f=d.onReceiveMetadata)!==null&&f!==void 0?f:Mp.onReceiveMetadata,onReceiveMessage:(v=d.onReceiveMessage)!==null&&v!==void 0?v:Mp.onReceiveMessage,onReceiveStatus:(w=d.onReceiveStatus)!==null&&w!==void 0?w:Mp.onReceiveStatus};A=new mS.InterceptingListenerImpl(T,c)}this.nextCall.start(u,A),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};gn.InterceptingCall=Pp;function Yx(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var hu=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(gS.Status.INTERNAL,`Request message serialization failure: ${(0,yS.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:gS.Status.INTERNAL,details:`Response message parsing error: ${(0,yS.getErrorMessage)(a)}`,metadata:new Qx.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Fp=class extends hu{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},Lp=class extends hu{};function Jx(n,e,t){let r=Yx(n,t.path,e);return t.responseStream?new Lp(r,t):new Fp(r,t)}function Xx(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new Ua("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new Ua("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>Jx(r,a,e))(s)}gn.getInterceptingCall=Xx});var Up=R(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.Client=void 0;var Hn=fS(),Zx=zp(),eM=fn(),Kr=we(),Zs=jt(),fu=Vp(),Tn=Symbol(),eo=Symbol(),to=Symbol(),mr=Symbol();function Bp(n){return typeof n=="function"}function no(n){return n.stack.split(`
`).slice(1).join(`
`)}var qp=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[eo]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[to]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[eo].length>0&&this[to].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[mr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[Tn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[Tn]=o(e,t,r)}else this[Tn]=new Zx.ChannelImplementation(e,t,r)}close(){this[Tn].close()}getChannel(){return this[Tn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[Tn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===eM.ConnectivityState.READY)t();else try{this[Tn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(Bp(e))return{metadata:new Zs.Metadata,options:{},callback:e};if(Bp(t))return e instanceof Zs.Metadata?{metadata:e,options:{},callback:t}:{metadata:new Zs.Metadata,options:e,callback:t};if(!(e instanceof Zs.Metadata&&t instanceof Object&&Bp(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},f={argument:i,metadata:u.metadata,call:new Hn.ClientUnaryCallImpl,channel:this[Tn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[mr]&&(f=this[mr](f));let v=f.call,w={clientInterceptors:this[eo],clientInterceptorProviders:this[to],callInterceptors:(l=f.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=f.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},A=(0,fu.getInterceptingCall)(w,f.methodDefinition,f.callOptions,f.channel);v.call=A;let T=null,P=!1,U=new Error;return A.start(f.metadata,{onReceiveMetadata:L=>{v.emit("metadata",L)},onReceiveMessage(L){T!==null&&A.cancelWithStatus(Kr.Status.INTERNAL,"Too many responses received"),T=L},onReceiveStatus(L){if(!P){if(P=!0,L.code===Kr.Status.OK)if(T===null){let I=no(U);f.callback((0,Hn.callErrorFromStatus)({code:Kr.Status.INTERNAL,details:"No message received",metadata:L.metadata},I))}else f.callback(null,T);else{let I=no(U);f.callback((0,Hn.callErrorFromStatus)(L,I))}U=null,v.emit("status",L)}}}),A.sendMessage(i),A.halfClose(),v}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Hn.ClientWritableStreamImpl(t),channel:this[Tn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[mr]&&(d=this[mr](d));let f=d.call,v={clientInterceptors:this[eo],clientInterceptorProviders:this[to],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},w=(0,fu.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=w;let A=null,T=!1,P=new Error;return w.start(d.metadata,{onReceiveMetadata:U=>{f.emit("metadata",U)},onReceiveMessage(U){A!==null&&w.cancelWithStatus(Kr.Status.INTERNAL,"Too many responses received"),A=U},onReceiveStatus(U){if(!T){if(T=!0,U.code===Kr.Status.OK)if(A===null){let L=no(P);d.callback((0,Hn.callErrorFromStatus)({code:Kr.Status.INTERNAL,details:"No message received",metadata:U.metadata},L))}else d.callback(null,A);else{let L=no(P);d.callback((0,Hn.callErrorFromStatus)(U,L))}P=null,f.emit("status",U)}}}),f}checkMetadataAndOptions(e,t){let r,i;return e instanceof Zs.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new Zs.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Hn.ClientReadableStreamImpl(r),channel:this[Tn],methodDefinition:u,callOptions:c.options};this[mr]&&(d=this[mr](d));let f=d.call,v={clientInterceptors:this[eo],clientInterceptorProviders:this[to],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},w=(0,fu.getInterceptingCall)(v,d.methodDefinition,d.callOptions,d.channel);f.call=w;let A=!1,T=new Error;return w.start(d.metadata,{onReceiveMetadata(P){f.emit("metadata",P)},onReceiveMessage(P){f.push(P)},onReceiveStatus(P){if(!A){if(A=!0,f.push(null),P.code!==Kr.Status.OK){let U=no(T);f.emit("error",(0,Hn.callErrorFromStatus)(P,U))}T=null,f.emit("status",P)}}}),w.sendMessage(i),w.halfClose(),f}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Hn.ClientDuplexStreamImpl(t,r),channel:this[Tn],methodDefinition:c,callOptions:l.options};this[mr]&&(u=this[mr](u));let d=u.call,f={clientInterceptors:this[eo],clientInterceptorProviders:this[to],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},v=(0,fu.getInterceptingCall)(f,u.methodDefinition,u.callOptions,u.channel);d.call=v;let w=!1,A=new Error;return v.start(u.metadata,{onReceiveMetadata(T){d.emit("metadata",T)},onReceiveMessage(T){d.push(T)},onReceiveStatus(T){if(!w){if(w=!0,d.push(null),T.code!==Kr.Status.OK){let P=no(A);d.emit("error",(0,Hn.callErrorFromStatus)(T,P))}A=null,d.emit("status",T)}}}),d}};pu.Client=qp});var jp=R(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.loadPackageDefinition=ro.makeClientConstructor=void 0;var za=Up(),tM={unary:za.Client.prototype.makeUnaryRequest,server_stream:za.Client.prototype.makeServerStreamRequest,client_stream:za.Client.prototype.makeClientStreamRequest,bidi:za.Client.prototype.makeBidiStreamRequest};function Gp(n){return["__proto__","prototype","constructor"].includes(n)}function vS(n,e,t){t||(t={});class r extends za.Client{}return Object.keys(n).forEach(i=>{if(Gp(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=nM(tM[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Gp(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}ro.makeClientConstructor=vS;function nM(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function rM(n){return"format"in n}function iM(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Gp(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];rM(r)?o[s]=r:o[s]=vS(r,s,{})}return e}ro.loadPackageDefinition=iM});var GS=R((jG,zS)=>{"use strict";var sM=1/0,oM="[object Symbol]",aM=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lM=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,gu="\\ud800-\\udfff",AS="\\u0300-\\u036f\\ufe20-\\ufe23",IS="\\u20d0-\\u20f0",DS="\\u2700-\\u27bf",RS="a-z\\xdf-\\xf6\\xf8-\\xff",cM="\\xac\\xb1\\xd7\\xf7",uM="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",dM="\\u2000-\\u206f",hM=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",kS="A-Z\\xc0-\\xd6\\xd8-\\xde",xS="\\ufe0e\\ufe0f",MS=cM+uM+dM+hM,Hp="['\u2019]",fM="["+gu+"]",_S="["+MS+"]",mu="["+AS+IS+"]",NS="\\d+",pM="["+DS+"]",OS="["+RS+"]",PS="[^"+gu+MS+NS+DS+RS+kS+"]",Wp="\\ud83c[\\udffb-\\udfff]",mM="(?:"+mu+"|"+Wp+")",FS="[^"+gu+"]",Kp="(?:\\ud83c[\\udde6-\\uddff]){2}",$p="[\\ud800-\\udbff][\\udc00-\\udfff]",io="["+kS+"]",LS="\\u200d",bS="(?:"+OS+"|"+PS+")",gM="(?:"+io+"|"+PS+")",SS="(?:"+Hp+"(?:d|ll|m|re|s|t|ve))?",CS="(?:"+Hp+"(?:D|LL|M|RE|S|T|VE))?",VS=mM+"?",BS="["+xS+"]?",yM="(?:"+LS+"(?:"+[FS,Kp,$p].join("|")+")"+BS+VS+")*",qS=BS+VS+yM,vM="(?:"+[pM,Kp,$p].join("|")+")"+qS,_M="(?:"+[FS+mu+"?",mu,Kp,$p,fM].join("|")+")",bM=RegExp(Hp,"g"),SM=RegExp(mu,"g"),CM=RegExp(Wp+"(?="+Wp+")|"+_M+qS,"g"),wM=RegExp([io+"?"+OS+"+"+SS+"(?="+[_S,io,"$"].join("|")+")",gM+"+"+CS+"(?="+[_S,io+bS,"$"].join("|")+")",io+"?"+bS+"+"+SS,io+"+"+CS,NS,vM].join("|"),"g"),EM=RegExp("["+LS+gu+AS+IS+xS+"]"),TM=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,AM={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},IM=typeof global=="object"&&global&&global.Object===Object&&global,DM=typeof self=="object"&&self&&self.Object===Object&&self,RM=IM||DM||Function("return this")();function kM(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function xM(n){return n.split("")}function MM(n){return n.match(aM)||[]}function NM(n){return function(e){return n?.[e]}}var OM=NM(AM);function US(n){return EM.test(n)}function PM(n){return TM.test(n)}function FM(n){return US(n)?LM(n):xM(n)}function LM(n){return n.match(CM)||[]}function VM(n){return n.match(wM)||[]}var BM=Object.prototype,qM=BM.toString,wS=RM.Symbol,ES=wS?wS.prototype:void 0,TS=ES?ES.toString:void 0;function UM(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function zM(n){if(typeof n=="string")return n;if(KM(n))return TS?TS.call(n):"";var e=n+"";return e=="0"&&1/n==-sM?"-0":e}function GM(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:UM(n,e,t)}function jM(n){return function(e){e=yu(e);var t=US(e)?FM(e):void 0,r=t?t[0]:e.charAt(0),i=t?GM(t,1).join(""):e.slice(1);return r[n]()+i}}function WM(n){return function(e){return kM(XM(YM(e).replace(bM,"")),n,"")}}function HM(n){return!!n&&typeof n=="object"}function KM(n){return typeof n=="symbol"||HM(n)&&qM.call(n)==oM}function yu(n){return n==null?"":zM(n)}var $M=WM(function(n,e,t){return e=e.toLowerCase(),n+(t?QM(e):e)});function QM(n){return JM(yu(n).toLowerCase())}function YM(n){return n=yu(n),n&&n.replace(lM,OM).replace(SM,"")}var JM=jM("toUpperCase");function XM(n,e,t){return n=yu(n),e=t?void 0:e,e===void 0?PM(n)?VM(n):MM(n):n.match(e)||[]}zS.exports=$M});var Qp=R((WG,jS)=>{"use strict";jS.exports=ZM;function ZM(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f++]=arguments[f];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var $S=R(KS=>{"use strict";var vu=KS;vu.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var so=new Array(64),HS=new Array(123);for(An=0;An<64;)HS[so[An]=An<26?An+65:An<52?An+71:An<62?An-4:An-59|43]=An++;var An;vu.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=so[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=so[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=so[l|c>>6],s[o++]=so[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=so[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var WS="invalid encoding";vu.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=HS[l])===void 0)throw Error(WS);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(WS);return r-i};vu.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var YS=R((KG,QS)=>{"use strict";QS.exports=_u;function _u(){this._listeners={}}_u.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};_u.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};_u.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var rC=R(($G,nC)=>{"use strict";nC.exports=JS(JS);function JS(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,XS),n.writeFloatBE=e.bind(null,ZS);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,eC),n.readFloatBE=t.bind(null,tC)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,XS,0,4),n.writeDoubleBE=e.bind(null,ZS,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,f=4294967296*(c&1048575)+l;return d===2047?f?NaN:u*(1/0):d===0?u*5e-324*f:u*Math.pow(2,d-1075)*(f+4503599627370496)}n.readDoubleLE=t.bind(null,eC,0,4),n.readDoubleBE=t.bind(null,tC,4,0)}(),n}function XS(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function ZS(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function eC(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function tC(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Yp=R((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var sC=R(iC=>{"use strict";var Jp=iC;Jp.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Jp.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Jp.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var aC=R((YG,oC)=>{"use strict";oC.exports=eN;function eN(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var cC=R((JG,lC)=>{"use strict";lC.exports=ut;var Ga=Kn();function ut(n,e){this.lo=n>>>0,this.hi=e>>>0}var Gi=ut.zero=new ut(0,0);Gi.toNumber=function(){return 0};Gi.zzEncode=Gi.zzDecode=function(){return this};Gi.length=function(){return 1};var tN=ut.zeroHash="\0\0\0\0\0\0\0\0";ut.fromNumber=function(e){if(e===0)return Gi;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new ut(r,i)};ut.from=function(e){if(typeof e=="number")return ut.fromNumber(e);if(Ga.isString(e))if(Ga.Long)e=Ga.Long.fromString(e);else return ut.fromNumber(parseInt(e,10));return e.low||e.high?new ut(e.low>>>0,e.high>>>0):Gi};ut.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};ut.prototype.toLong=function(e){return Ga.Long?new Ga.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var $r=String.prototype.charCodeAt;ut.fromHash=function(e){return e===tN?Gi:new ut(($r.call(e,0)|$r.call(e,1)<<8|$r.call(e,2)<<16|$r.call(e,3)<<24)>>>0,($r.call(e,4)|$r.call(e,5)<<8|$r.call(e,6)<<16|$r.call(e,7)<<24)>>>0)};ut.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};ut.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};ut.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};ut.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Kn=R(Xp=>{"use strict";var Q=Xp;Q.asPromise=Qp();Q.base64=$S();Q.EventEmitter=YS();Q.float=rC();Q.inquire=Yp();Q.utf8=sC();Q.pool=aC();Q.LongBits=cC();Q.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);Q.global=Q.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Xp;Q.emptyArray=Object.freeze?Object.freeze([]):[];Q.emptyObject=Object.freeze?Object.freeze({}):{};Q.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Q.isString=function(e){return typeof e=="string"||e instanceof String};Q.isObject=function(e){return e&&typeof e=="object"};Q.isset=Q.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};Q.Buffer=function(){try{var n=Q.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();Q._Buffer_from=null;Q._Buffer_allocUnsafe=null;Q.newBuffer=function(e){return typeof e=="number"?Q.Buffer?Q._Buffer_allocUnsafe(e):new Q.Array(e):Q.Buffer?Q._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};Q.Array=typeof Uint8Array<"u"?Uint8Array:Array;Q.Long=Q.global.dcodeIO&&Q.global.dcodeIO.Long||Q.global.Long||Q.inquire("long");Q.key2Re=/^true|false|0|1$/;Q.key32Re=/^-?(?:0|[1-9][0-9]*)$/;Q.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;Q.longToHash=function(e){return e?Q.LongBits.from(e).toHash():Q.LongBits.zeroHash};Q.longFromHash=function(e,t){var r=Q.LongBits.fromHash(e);return Q.Long?Q.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function uC(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}Q.merge=uC;Q.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function dC(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&uC(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}Q.newError=dC;Q.ProtocolError=dC("ProtocolError");Q.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};Q.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};Q.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};Q._configure=function(){var n=Q.Buffer;if(!n){Q._Buffer_from=Q._Buffer_allocUnsafe=null;return}Q._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},Q._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var Su=R((ZG,mC)=>{"use strict";mC.exports=pe;var yn=Kn(),Zp,bu=yn.LongBits,hC=yn.base64,fC=yn.utf8;function ja(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function tm(){}function nN(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function pe(){this.len=0,this.head=new ja(tm,0,0),this.tail=this.head,this.states=null}var pC=function(){return yn.Buffer?function(){return(pe.create=function(){return new Zp})()}:function(){return new pe}};pe.create=pC();pe.alloc=function(e){return new yn.Array(e)};yn.Array!==Array&&(pe.alloc=yn.pool(pe.alloc,yn.Array.prototype.subarray));pe.prototype._push=function(e,t,r){return this.tail=this.tail.next=new ja(e,t,r),this.len+=t,this};function nm(n,e,t){e[t]=n&255}function rN(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function rm(n,e){this.len=n,this.next=void 0,this.val=e}rm.prototype=Object.create(ja.prototype);rm.prototype.fn=rN;pe.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new rm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};pe.prototype.int32=function(e){return e<0?this._push(im,10,bu.fromNumber(e)):this.uint32(e)};pe.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function im(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}pe.prototype.uint64=function(e){var t=bu.from(e);return this._push(im,t.length(),t)};pe.prototype.int64=pe.prototype.uint64;pe.prototype.sint64=function(e){var t=bu.from(e).zzEncode();return this._push(im,t.length(),t)};pe.prototype.bool=function(e){return this._push(nm,1,e?1:0)};function em(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}pe.prototype.fixed32=function(e){return this._push(em,4,e>>>0)};pe.prototype.sfixed32=pe.prototype.fixed32;pe.prototype.fixed64=function(e){var t=bu.from(e);return this._push(em,4,t.lo)._push(em,4,t.hi)};pe.prototype.sfixed64=pe.prototype.fixed64;pe.prototype.float=function(e){return this._push(yn.float.writeFloatLE,4,e)};pe.prototype.double=function(e){return this._push(yn.float.writeDoubleLE,8,e)};var iN=yn.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};pe.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(nm,1,0);if(yn.isString(e)){var r=pe.alloc(t=hC.length(e));hC.decode(e,r,0),e=r}return this.uint32(t)._push(iN,t,e)};pe.prototype.string=function(e){var t=fC.length(e);return t?this.uint32(t)._push(fC.write,t,e):this._push(nm,1,0)};pe.prototype.fork=function(){return this.states=new nN(this),this.head=this.tail=new ja(tm,0,0),this.len=0,this};pe.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ja(tm,0,0),this.len=0),this};pe.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};pe.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};pe._configure=function(n){Zp=n,pe.create=pC(),Zp._configure()}});var vC=R((ej,yC)=>{"use strict";yC.exports=$n;var gC=Su();($n.prototype=Object.create(gC.prototype)).constructor=$n;var Qr=Kn();function $n(){gC.call(this)}$n._configure=function(){$n.alloc=Qr._Buffer_allocUnsafe,$n.writeBytesBuffer=Qr.Buffer&&Qr.Buffer.prototype instanceof Uint8Array&&Qr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};$n.prototype.bytes=function(e){Qr.isString(e)&&(e=Qr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push($n.writeBytesBuffer,t,e),this};function sN(n,e,t){n.length<40?Qr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}$n.prototype.string=function(e){var t=Qr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(sN,t,e),this};$n._configure()});var wu=R((tj,wC)=>{"use strict";wC.exports=Qe;var In=Kn(),om,SC=In.LongBits,oN=In.utf8;function Dn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Qe(n){this.buf=n,this.pos=0,this.len=n.length}var _C=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Qe(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Qe(e);throw Error("illegal buffer")},CC=function(){return In.Buffer?function(t){return(Qe.create=function(i){return In.Buffer.isBuffer(i)?new om(i):_C(i)})(t)}:_C};Qe.create=CC();Qe.prototype._slice=In.Array.prototype.subarray||In.Array.prototype.slice;Qe.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Dn(this,10);return e}}();Qe.prototype.int32=function(){return this.uint32()|0};Qe.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function sm(){var n=new SC(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw Dn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw Dn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Qe.prototype.bool=function(){return this.uint32()!==0};function Cu(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Qe.prototype.fixed32=function(){if(this.pos+4>this.len)throw Dn(this,4);return Cu(this.buf,this.pos+=4)};Qe.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Dn(this,4);return Cu(this.buf,this.pos+=4)|0};function bC(){if(this.pos+8>this.len)throw Dn(this,8);return new SC(Cu(this.buf,this.pos+=4),Cu(this.buf,this.pos+=4))}Qe.prototype.float=function(){if(this.pos+4>this.len)throw Dn(this,4);var e=In.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Qe.prototype.double=function(){if(this.pos+8>this.len)throw Dn(this,4);var e=In.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Qe.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Dn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=In.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Qe.prototype.string=function(){var e=this.bytes();return oN.read(e,0,e.length)};Qe.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Dn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Dn(this);while(this.buf[this.pos++]&128);return this};Qe.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Qe._configure=function(n){om=n,Qe.create=CC(),om._configure();var e=In.Long?"toLong":"toNumber";In.merge(Qe.prototype,{int64:function(){return sm.call(this)[e](!1)},uint64:function(){return sm.call(this)[e](!0)},sint64:function(){return sm.call(this).zzDecode()[e](!1)},fixed64:function(){return bC.call(this)[e](!0)},sfixed64:function(){return bC.call(this)[e](!1)}})}});var IC=R((nj,AC)=>{"use strict";AC.exports=ji;var TC=wu();(ji.prototype=Object.create(TC.prototype)).constructor=ji;var EC=Kn();function ji(n){TC.call(this,n)}ji._configure=function(){EC.Buffer&&(ji.prototype._slice=EC.Buffer.prototype.slice)};ji.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};ji._configure()});var RC=R((rj,DC)=>{"use strict";DC.exports=Wa;var am=Kn();(Wa.prototype=Object.create(am.EventEmitter.prototype)).constructor=Wa;function Wa(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");am.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}Wa.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return am.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};Wa.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var lm=R(kC=>{"use strict";var aN=kC;aN.Service=RC()});var cm=R((sj,xC)=>{"use strict";xC.exports={}});var OC=R(NC=>{"use strict";var Ht=NC;Ht.build="minimal";Ht.Writer=Su();Ht.BufferWriter=vC();Ht.Reader=wu();Ht.BufferReader=IC();Ht.util=Kn();Ht.rpc=lm();Ht.roots=cm();Ht.configure=MC;function MC(){Ht.util._configure(),Ht.Writer._configure(Ht.BufferWriter),Ht.Reader._configure(Ht.BufferReader)}MC()});var FC=R((aj,PC)=>{"use strict";PC.exports=um;function um(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(um.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),f=0;f<d.length;)d[f]=arguments[++f];if(f=0,s=s.replace(/%([%dfijs])/g,function(w,A){var T=d[f++];switch(A){case"d":case"f":return String(Number(T));case"i":return String(Math.floor(T));case"j":return JSON.stringify(T);case"s":return String(T)}return"%"}),f!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}um.verbose=!1});var VC=R((lj,LC)=>{"use strict";LC.exports=Ha;var lN=Qp(),cN=Yp(),dm=cN("fs");function Ha(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&dm&&dm.readFile?dm.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Ha.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Ha.xhr(n,e,t):lN(Ha,this,n,e)}Ha.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var UC=R(qC=>{"use strict";var fm=qC,BC=fm.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},hm=fm.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=BC(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};fm.resolve=function(e,t,r){return r||(t=hm(t)),BC(t)?t:(r||(e=hm(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?hm(e+"/"+t):t)}});var ao=R((uj,jC)=>{"use strict";jC.exports=me;var Eu=Jr();((me.prototype=Object.create(Eu.prototype)).constructor=me).className="Namespace";var pm=Yr(),Tu=dt(),uN=Ki(),Wi,oo,Hi;me.fromJSON=function(e,t){return new me(e,t.options).addJSON(t.nested)};function zC(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}me.arrayToJSON=zC;me.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};me.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function me(n,e){Eu.call(this,n,e),this.nested=void 0,this._nestedArray=null}function GC(n){return n._nestedArray=null,n}Object.defineProperty(me.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=Tu.toArray(this.nested))}});me.prototype.toJSON=function(e){return Tu.toObject(["options",this.options,"nested",zC(this.nestedArray,e)])};me.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Wi.fromJSON:s.values!==void 0?Hi.fromJSON:s.methods!==void 0?oo.fromJSON:s.id!==void 0?pm.fromJSON:me.fromJSON)(r[i],s));return this};me.prototype.get=function(e){return this.nested&&this.nested[e]||null};me.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof Hi)return this.nested[e].values;throw Error("no such enum: "+e)};me.prototype.add=function(e){if(!(e instanceof pm&&e.extend!==void 0||e instanceof Wi||e instanceof uN||e instanceof Hi||e instanceof oo||e instanceof me))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof me&&e instanceof me&&!(t instanceof Wi||t instanceof oo)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,this instanceof Wi||this instanceof oo||this instanceof Hi||this instanceof pm||e._edition||(e._edition=e._defaultEdition),e.onAdd(this),GC(this)};me.prototype.remove=function(e){if(!(e instanceof Eu))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),GC(this)};me.prototype.define=function(e,t){if(Tu.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof me))throw Error("path conflicts with non-namespace objects")}else r.add(r=new me(i))}return t&&r.addJSON(t),r};me.prototype.resolveAll=function(){var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof me?e[t++].resolveAll():e[t++].resolve();return this};me.prototype._resolveFeaturesRecursive=function(e){return e=this._edition||e,Eu.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this};me.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),Tu.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof me&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof me&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};me.prototype.lookupType=function(e){var t=this.lookup(e,[Wi]);if(!t)throw Error("no such type: "+e);return t};me.prototype.lookupEnum=function(e){var t=this.lookup(e,[Hi]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};me.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Wi,Hi]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};me.prototype.lookupService=function(e){var t=this.lookup(e,[oo]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};me._configure=function(n,e,t){Wi=n,oo=e,Hi=t}});var Au=R((dj,WC)=>{"use strict";WC.exports=gr;var mm=Yr();((gr.prototype=Object.create(mm.prototype)).constructor=gr).className="MapField";var dN=$i(),Ka=dt();function gr(n,e,t,r,i,s){if(mm.call(this,n,e,r,void 0,void 0,i,s),!Ka.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}gr.fromJSON=function(e,t){return new gr(e,t.id,t.keyType,t.type,t.options,t.comment)};gr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ka.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};gr.prototype.resolve=function(){if(this.resolved)return this;if(dN.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return mm.prototype.resolve.call(this)};gr.d=function(e,t,r){return typeof r=="function"?r=Ka.decorateType(r).name:r&&typeof r=="object"&&(r=Ka.decorateEnum(r).name),function(s,o){Ka.decorateType(s.constructor).add(new gr(o,e,t,r))}}});var Iu=R((hj,HC)=>{"use strict";HC.exports=Qi;var gm=Jr();((Qi.prototype=Object.create(gm.prototype)).constructor=Qi).className="Method";var lo=dt();function Qi(n,e,t,r,i,s,o,a,l){if(lo.isObject(i)?(o=i,i=s=void 0):lo.isObject(s)&&(o=s,s=void 0),!(e===void 0||lo.isString(e)))throw TypeError("type must be a string");if(!lo.isString(t))throw TypeError("requestType must be a string");if(!lo.isString(r))throw TypeError("responseType must be a string");gm.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}Qi.fromJSON=function(e,t){return new Qi(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Qi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return lo.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Qi.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),gm.prototype.resolve.call(this))}});var Du=R((fj,$C)=>{"use strict";$C.exports=tn;var yr=ao();((tn.prototype=Object.create(yr.prototype)).constructor=tn).className="Service";var ym=Iu(),$a=dt(),hN=lm();function tn(n,e){yr.call(this,n,e),this.methods={},this._methodsArray=null}tn.fromJSON=function(e,t){var r=new tn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(ym.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r};tn.prototype.toJSON=function(e){var t=yr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return $a.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",yr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(tn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=$a.toArray(this.methods))}});function KC(n){return n._methodsArray=null,n}tn.prototype.get=function(e){return this.methods[e]||yr.prototype.get.call(this,e)};tn.prototype.resolveAll=function(){yr.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this};tn.prototype._resolveFeaturesRecursive=function(e){return e=this._edition||e,yr.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)}),this};tn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof ym?(this.methods[e.name]=e,e.parent=this,KC(this)):yr.prototype.add.call(this,e)};tn.prototype.remove=function(e){if(e instanceof ym){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,KC(this)}return yr.prototype.remove.call(this,e)};tn.prototype.create=function(e,t,r){for(var i=new hN.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=$a.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=$a.codegen(["r","c"],$a.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Ru=R((pj,QC)=>{"use strict";QC.exports=Qn;var fN=Kn();function Qn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Qn.create=function(e){return this.$type.create(e)};Qn.encode=function(e,t){return this.$type.encode(e,t)};Qn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Qn.decode=function(e){return this.$type.decode(e)};Qn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Qn.verify=function(e){return this.$type.verify(e)};Qn.fromObject=function(e){return this.$type.fromObject(e)};Qn.toObject=function(e,t){return this.$type.toObject(e,t)};Qn.prototype.toJSON=function(){return this.$type.toObject(this,fN.toJSONOptions)}});var vm=R((mj,JC)=>{"use strict";JC.exports=gN;var pN=Rn(),vr=$i(),YC=dt();function mN(n){return"missing required '"+n.name+"'"}function gN(n){for(var e=YC.codegen(["r","l","e"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof pN?"int32":r.type,s="m"+YC.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),vr.defaults[r.keyType]!==void 0?e("k=%j",vr.defaults[r.keyType]):e("k=null"),vr.defaults[i]!==void 0?e("value=%j",vr.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),vr.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),vr.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),vr.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),vr.basic[i]===void 0?e(r.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):vr.basic[i]===void 0?e(r.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",mN(o))}return e("return m")}});var Sm=R((gj,XC)=>{"use strict";XC.exports=_N;var yN=Rn(),_m=dt();function vn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function bm(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof yN){n("switch(%s){",r)("default:")("return%j",vn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",vn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",vn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",vn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",vn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",vn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",vn(e,"buffer"));break}return n}function vN(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",vn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",vn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",vn(e,"boolean key"));break}return n}function _N(n){var e=_m.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+_m.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",vn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),vN(e,s,"k[i]"),bm(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",vn(s,"array"))("for(var i=0;i<%s.length;++i){",o),bm(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=_m.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}bm(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var Em=R(ew=>{"use strict";var ZC=ew,Qa=Rn(),Yn=dt();function Cm(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Qa){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}ZC.fromObject=function(e){var t=e.fieldsArray,r=Yn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Yn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),Cm(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),Cm(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Qa||r("if(d%s!=null){",o),Cm(r,s,i,o),s.resolvedType instanceof Qa||r("}"))}return r("return m")};function wm(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Qa?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}ZC.toObject=function(e){var t=e.fieldsArray.slice().sort(Yn.compareFieldsById);if(!t.length)return Yn.codegen()("return {}");for(var r=Yn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Yn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Yn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Yn.safeProp(l.name);if(l.resolvedType instanceof Qa)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],f=e._fieldsArray.indexOf(l),c=Yn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),wm(r,l,f,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),wm(r,l,f,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),wm(r,l,f,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Yn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var Tm=R(tw=>{"use strict";var bN=tw,SN=Ru();bN[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof SN){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Mu=R((_j,rw)=>{"use strict";rw.exports=Re;var _n=ao();((Re.prototype=Object.create(_n.prototype)).constructor=Re).className="Type";var CN=Rn(),Dm=Ki(),ku=Yr(),wN=Au(),EN=Du(),Am=Ru(),Im=wu(),TN=Su(),Et=dt(),AN=Rm(),IN=vm(),DN=Sm(),nw=Em(),RN=Tm();function Re(n,e){_n.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(Re.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Et.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Et.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Re.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof Am||((n.prototype=new Am).constructor=n,Et.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Et.merge(n,Am,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Et.oneOfGetter(this._oneofsArray[t].oneof),set:Et.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});Re.generateConstructor=function(e){for(var t=Et.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Et.safeProp(i.name)):i.repeated&&t("this%s=[]",Et.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function xu(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}Re.fromJSON=function(e,t){var r=new Re(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?wN.fromJSON:ku.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(Dm.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?ku.fromJSON:o.fields!==void 0?Re.fromJSON:o.values!==void 0?CN.fromJSON:o.methods!==void 0?EN.fromJSON:_n.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};Re.prototype.toJSON=function(e){var t=_n.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Et.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",_n.arrayToJSON(this.oneofsArray,e),"fields",_n.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Re.prototype.resolveAll=function(){_n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this};Re.prototype._resolveFeaturesRecursive=function(e){return e=this._edition||e,_n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)}),this};Re.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};Re.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof ku&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),xu(this)}return e instanceof Dm?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),xu(this)):_n.prototype.add.call(this,e)};Re.prototype.remove=function(e){if(e instanceof ku&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),xu(this)}if(e instanceof Dm){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),xu(this)}return _n.prototype.remove.call(this,e)};Re.prototype.isReservedId=function(e){return _n.isReservedId(this.reserved,e)};Re.prototype.isReservedName=function(e){return _n.isReservedName(this.reserved,e)};Re.prototype.create=function(e){return new this.ctor(e)};Re.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=AN(this)({Writer:TN,types:t,util:Et}),this.decode=IN(this)({Reader:Im,types:t,util:Et}),this.verify=DN(this)({types:t,util:Et}),this.fromObject=nw.fromObject(this)({types:t,util:Et}),this.toObject=nw.toObject(this)({types:t,util:Et});var i=RN[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};Re.prototype.encode=function(e,t){return this.setup().encode(e,t)};Re.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};Re.prototype.decode=function(e,t){return this.setup().decode(e,t)};Re.prototype.decodeDelimited=function(e){return e instanceof Im||(e=Im.create(e)),this.decode(e,e.uint32())};Re.prototype.verify=function(e){return this.setup().verify(e)};Re.prototype.fromObject=function(e){return this.setup().fromObject(e)};Re.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};Re.d=function(e){return function(r){Et.decorateType(r,e)}}});var Pu=R((bj,lw)=>{"use strict";lw.exports=nn;var Ou=ao();((nn.prototype=Object.create(Ou.prototype)).constructor=nn).className="Root";var xm=Yr(),sw=Rn(),kN=Ki(),Xr=dt(),ow,km,Ya;function nn(n){Ou.call(this,"",n),this.deferred=[],this.files=[],this._edition="proto2"}nn.fromJSON=function(e,t){return t||(t=new nn),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()};nn.prototype.resolvePath=Xr.path.resolve;nn.prototype.fetch=Xr.fetch;function aw(){}nn.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Xr.asPromise(n,i,e,t);var s=r===aw;function o(v,w){if(r){if(s)throw v;var A=r;r=null,w&&w.resolveAll(),A(v,w)}}function a(v){var w=v.lastIndexOf("google/protobuf/");if(w>-1){var A=v.substring(w);if(A in Ya)return A}return null}function l(v,w){try{if(Xr.isString(w)&&w.charAt(0)==="{"&&(w=JSON.parse(w)),!Xr.isString(w))i.setOptions(w.options).addJSON(w.nested);else{km.filename=v;var A=km(w,i,t),T,P=0;if(A.imports)for(;P<A.imports.length;++P)(T=a(A.imports[P])||i.resolvePath(v,A.imports[P]))&&c(T);if(A.weakImports)for(P=0;P<A.weakImports.length;++P)(T=a(A.weakImports[P])||i.resolvePath(v,A.weakImports[P]))&&c(T,!0)}}catch(U){o(U)}!s&&!u&&o(null,i)}function c(v,w){if(v=a(v)||v,!(i.files.indexOf(v)>-1)){if(i.files.push(v),v in Ya){s?l(v,Ya[v]):(++u,setTimeout(function(){--u,l(v,Ya[v])}));return}if(s){var A;try{A=Xr.fs.readFileSync(v).toString("utf8")}catch(T){w||o(T);return}l(v,A)}else++u,i.fetch(v,function(T,P){if(--u,!!r){if(T){w?u||o(null,i):o(T);return}l(v,P)}})}}var u=0;Xr.isString(e)&&(e=[e]);for(var d=0,f;d<e.length;++d)(f=i.resolvePath("",e[d]))&&c(f);return i.resolveAll(),s||u||o(null,i),i};nn.prototype.loadSync=function(e,t){if(!Xr.isNode)throw Error("not supported");return this.load(e,t,aw)};nn.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Ou.prototype.resolveAll.call(this)};var Nu=/^[A-Z]/;function iw(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new xm(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}nn.prototype._handleAdd=function(e){if(e instanceof xm)e.extend!==void 0&&!e.extensionField&&(iw(this,e)||this.deferred.push(e));else if(e instanceof sw)Nu.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof kN)){if(e instanceof ow)for(var t=0;t<this.deferred.length;)iw(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Nu.test(e.name)&&(e.parent[e.name]=e)}};nn.prototype._handleRemove=function(e){if(e instanceof xm){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof sw)Nu.test(e.name)&&delete e.parent[e.name];else if(e instanceof Ou){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Nu.test(e.name)&&delete e.parent[e.name]}};nn._configure=function(n,e,t){ow=n,km=e,Ya=t}});var dt=R((Sj,uw)=>{"use strict";var Ye=uw.exports=Kn(),cw=cm(),Mm,Nm;Ye.codegen=FC();Ye.fetch=VC();Ye.path=UC();Ye.fs=Ye.inquire("fs");Ye.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Ye.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var xN=/\\/g,MN=/"/g;Ye.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Ye.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Ye.isReserved(e)?'["'+e.replace(xN,"\\\\").replace(MN,'\\"')+'"]':"."+e};Ye.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var NN=/_([a-z])/g;Ye.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(NN,function(t,r){return r.toUpperCase()})};Ye.compareFieldsById=function(e,t){return e.id-t.id};Ye.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Ye.decorateRoot.remove(e.$type),e.$type.name=t,Ye.decorateRoot.add(e.$type)),e.$type;Mm||(Mm=Mu());var r=new Mm(t||e.name);return Ye.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var ON=0;Ye.decorateEnum=function(e){if(e.$type)return e.$type;Nm||(Nm=Rn());var t=new Nm("Enum"+ON++,e);return Ye.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Ye.setProperty=function(e,t,r,i){function s(o,a,l){var c=a.shift();if(c==="__proto__"||c==="prototype")return o;if(a.length>0)o[c]=s(o[c]||{},a,l);else{var u=o[c];if(u&&i)return o;u&&(l=[].concat(u).concat(l)),o[c]=l}return o}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),s(e,t,r)};Object.defineProperty(Ye,"decorateRoot",{get:function(){return cw.decorated||(cw.decorated=new(Pu()))}})});var $i=R(dw=>{"use strict";var Ja=dw,PN=dt(),FN=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Xa(n,e){var t=0,r={};for(e|=0;t<n.length;)r[FN[t+e]]=n[t++];return r}Ja.basic=Xa([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Ja.defaults=Xa([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",PN.emptyArray,null]);Ja.long=Xa([0,0,0,1,1],7);Ja.mapKey=Xa([0,0,0,5,5,0,0,0,1,1,0,2],2);Ja.packed=Xa([1,5,0,0,0,5,5,0,0,0,1,1,0])});var Yr=R((wj,pw)=>{"use strict";pw.exports=ht;var el=Jr();((ht.prototype=Object.create(el.prototype)).constructor=ht).className="Field";var hw=Rn(),fw=$i(),tt=dt(),Za,LN=/^required|optional|repeated$/;ht.fromJSON=function(e,t){var r=new ht(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};function ht(n,e,t,r,i,s,o){if(tt.isObject(r)?(o=i,s=r,r=i=void 0):tt.isObject(i)&&(o=s,s=i,i=void 0),el.call(this,n,s),!tt.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!tt.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!LN.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!tt.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=tt.Long?fw.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=o}Object.defineProperty(ht.prototype,"required",{get:function(){return this._features.field_presence==="LEGACY_REQUIRED"}});Object.defineProperty(ht.prototype,"optional",{get:function(){return!this.required}});Object.defineProperty(ht.prototype,"delimited",{get:function(){return this.resolvedType instanceof Za&&this._features.message_encoding==="DELIMITED"}});Object.defineProperty(ht.prototype,"packed",{get:function(){return this._features.repeated_field_encoding==="PACKED"}});Object.defineProperty(ht.prototype,"hasPresence",{get:function(){return this.repeated||this.map?!1:this.partOf||this.declaringField||this.extensionField||this._features.field_presence!=="IMPLICIT"}});ht.prototype.setOption=function(e,t,r){return el.prototype.setOption.call(this,e,t,r)};ht.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return tt.toObject(["edition",this._editionToJSON(),"rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};ht.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=fw.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof Za?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof hw&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof hw)&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=tt.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;tt.base64.test(this.typeDefault)?tt.base64.decode(this.typeDefault,e=tt.newBuffer(tt.base64.length(this.typeDefault)),0):tt.utf8.write(this.typeDefault,e=tt.newBuffer(tt.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=tt.emptyObject:this.repeated?this.defaultValue=tt.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof Za&&(this.parent.ctor.prototype[this.name]=this.defaultValue),el.prototype.resolve.call(this)};ht.prototype._inferLegacyProtoFeatures=function(e){if(e!=="proto2"&&e!=="proto3")return{};var t={};return this.resolve(),this.rule==="required"&&(t.field_presence="LEGACY_REQUIRED"),this.resolvedType instanceof Za&&this.resolvedType.group&&(t.message_encoding="DELIMITED"),this.getOption("packed")===!0?t.repeated_field_encoding="PACKED":this.getOption("packed")===!1&&(t.repeated_field_encoding="EXPANDED"),t};ht.prototype._resolveFeatures=function(e){return el.prototype._resolveFeatures.call(this,this._edition||e)};ht.d=function(e,t,r,i){return typeof t=="function"?t=tt.decorateType(t).name:t&&typeof t=="object"&&(t=tt.decorateEnum(t).name),function(o,a){tt.decorateType(o.constructor).add(new ht(a,e,t,r,{default:i}))}};ht._configure=function(e){Za=e}});var Ki=R((Ej,yw)=>{"use strict";yw.exports=rn;var Lu=Jr();((rn.prototype=Object.create(Lu.prototype)).constructor=rn).className="OneOf";var mw=Yr(),Fu=dt();function rn(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Lu.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}rn.fromJSON=function(e,t){return new rn(e,t.oneof,t.options,t.comment)};rn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Fu.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function gw(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}rn.prototype.add=function(e){if(!(e instanceof mw))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,gw(this),this};rn.prototype.remove=function(e){if(!(e instanceof mw))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};rn.prototype.onAdd=function(e){Lu.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}gw(this)};rn.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Lu.prototype.onRemove.call(this,e)};Object.defineProperty(rn.prototype,"isProto3Optional",{get:function(){if(this.fieldsArray==null||this.fieldsArray.length!==1)return!1;var n=this.fieldsArray[0];return n.options!=null&&n.options.proto3_optional===!0}});rn.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Fu.decorateType(i.constructor).add(new rn(s,e)),Object.defineProperty(i,s,{get:Fu.oneOfGetter(e),set:Fu.oneOfSetter(e)})}}});var Jr=R((Tj,vw)=>{"use strict";vw.exports=gt;gt.className="ReflectionObject";var VN=Ki(),tl=dt(),Vu,BN={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},qN={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},UN={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function gt(n,e){if(!tl.isString(n))throw TypeError("name must be a string");if(e&&!tl.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this._edition=null,this._defaultEdition="proto2",this._features={},this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(gt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});gt.prototype.toJSON=function(){throw Error()};gt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Vu&&t._handleAdd(this)};gt.prototype.onRemove=function(e){var t=e.root;t instanceof Vu&&t._handleRemove(this),this.parent=null,this.resolved=!1};gt.prototype.resolve=function(){return this.resolved?this:(this instanceof Vu&&(this._resolveFeaturesRecursive(this._edition),this.resolved=!0),this)};gt.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)};gt.prototype._resolveFeatures=function(e){var t={};if(!e)throw new Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if(e==="proto2")t=Object.assign({},qN);else if(e==="proto3")t=Object.assign({},UN);else if(e==="2023")t=Object.assign({},BN);else throw new Error("Unknown edition: "+e);this._features=Object.assign(t,r||{});return}if(this.partOf instanceof VN){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(!this.declaringField)if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw new Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features)};gt.prototype._inferLegacyProtoFeatures=function(){return{}};gt.prototype.getOption=function(e){if(this.options)return this.options[e]};gt.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?tl.setProperty(this.options,e,t,r):(!r||this.options[e]===void 0)&&(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this};gt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];tl.setProperty(o,r,t)}else s={},s[e]=tl.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};gt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};gt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};gt.prototype._editionToJSON=function(){if(!(!this._edition||this._edition==="proto3"))return this._edition};gt._configure=function(n){Vu=n}});var Rn=R((Aj,bw)=>{"use strict";bw.exports=kn;var Om=Jr();((kn.prototype=Object.create(Om.prototype)).constructor=kn).className="Enum";var _w=ao(),Bu=dt();function kn(n,e,t,r,i,s){if(Om.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this._valuesFeatures={},this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}kn.prototype._resolveFeatures=function(e){return e=this._edition||e,Om.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(t=>{var r=Object.assign({},this._features);this._valuesFeatures[t]=Object.assign(r,this.valuesOptions&&this.valuesOptions[t]&&this.valuesOptions[t].features)}),this};kn.fromJSON=function(e,t){var r=new kn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r};kn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Bu.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};kn.prototype.add=function(e,t,r,i){if(!Bu.isString(e))throw TypeError("name must be a string");if(!Bu.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};kn.prototype.remove=function(e){if(!Bu.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};kn.prototype.isReservedId=function(e){return _w.isReservedId(this.reserved,e)};kn.prototype.isReservedName=function(e){return _w.isReservedName(this.reserved,e)}});var Rm=R((Ij,Cw)=>{"use strict";Cw.exports=GN;var zN=Rn(),Pm=$i(),Fm=dt();function Sw(n,e,t,r){return e.delimited?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function GN(n){for(var e=Fm.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(Fm.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof zN?"int32":s.type,l=Pm.basic[a];r="m"+Fm.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|Pm.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&Pm.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?Sw(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?Sw(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var Ew=R((Dj,ww)=>{"use strict";var he=ww.exports=OC();he.build="light";function jN(n,e,t){return typeof e=="function"?(t=e,e=new he.Root):e||(e=new he.Root),e.load(n,t)}he.load=jN;function WN(n,e){return e||(e=new he.Root),e.loadSync(n)}he.loadSync=WN;he.encoder=Rm();he.decoder=vm();he.verifier=Sm();he.converter=Em();he.ReflectionObject=Jr();he.Namespace=ao();he.Root=Pu();he.Enum=Rn();he.Type=Mu();he.Field=Yr();he.OneOf=Ki();he.MapField=Au();he.Service=Du();he.Method=Iu();he.Message=Ru();he.wrappers=Tm();he.types=$i();he.util=dt();he.ReflectionObject._configure(he.Root);he.Namespace._configure(he.Type,he.Service,he.Enum);he.Root._configure(he.Type);he.Field._configure(he.Type)});var Vm=R((Rj,Iw)=>{"use strict";Iw.exports=Aw;var Lm=/[\s{}=;:[\],'"()<>]/g,HN=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,KN=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,$N=/^ *[*/]+ */,QN=/^\s*\*?\/*/,YN=/\n/g,JN=/\s/,XN=/\\(.?)/g,ZN={0:"\0",r:"\r",n:`
`,t:"	"};function Tw(n){return n.replace(XN,function(e,t){switch(t){case"\\":case"":return t;default:return ZN[t]||""}})}Aw.unescape=Tw;function Aw(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(I){return Error("illegal "+I+" (line "+i+")")}function u(){var I=l==="'"?KN:HN;I.lastIndex=t-1;var j=I.exec(n);if(!j)throw c("string");return t=I.lastIndex,T(l),l=null,Tw(j[1])}function d(I){return n.charAt(I)}function f(I,j,J){var b={type:n.charAt(I++),lineEmpty:!1,leading:J},g;e?g=2:g=3;var y=I-g,_;do if(--y<0||(_=n.charAt(y))===`
`){b.lineEmpty=!0;break}while(_===" "||_==="	");for(var p=n.substring(I,j).split(YN),S=0;S<p.length;++S)p[S]=p[S].replace(e?QN:$N,"").trim();b.text=p.join(`
`).trim(),o[i]=b,s=i}function v(I){var j=w(I),J=n.substring(I,j),b=/^\s*\/\//.test(J);return b}function w(I){for(var j=I;j<r&&d(j)!==`
`;)j++;return j}function A(){if(a.length>0)return a.shift();if(l)return u();var I,j,J,b,g,y=t===0;do{if(t===r)return null;for(I=!1;JN.test(J=d(t));)if(J===`
`&&(y=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(b=t,g=!1,v(t-1)){g=!0;do if(t=w(t),t===r||(t++,!y))break;while(v(t))}else t=Math.min(r,w(t)+1);g&&(f(b,t,y),y=!0),i++,I=!0}else{for(g=d(b=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,g&&(f(b,t-1,y),y=!0),++i,I=!0}else if((J=d(t))==="*"){b=t+1,g=e||d(b)==="*";do{if(J===`
`&&++i,++t===r)throw c("comment");j=J,J=d(t)}while(j!=="*"||J!=="/");++t,g&&(f(b,t-2,y),y=!0),I=!0}else return"/"}}while(I);var _=t;Lm.lastIndex=0;var p=Lm.test(d(_++));if(!p)for(;_<r&&!Lm.test(d(_));)++_;var S=n.substring(t,t=_);return(S==='"'||S==="'")&&(l=S),S}function T(I){a.push(I)}function P(){if(!a.length){var I=A();if(I===null)return null;T(I)}return a[0]}function U(I,j){var J=P(),b=J===I;if(b)return A(),!0;if(!j)throw c("token '"+J+"', '"+I+"' expected");return!1}function L(I){var j=null,J;return I===void 0?(J=o[i-1],delete o[i-1],J&&(e||J.type==="*"||J.lineEmpty)&&(j=J.leading?J.text:null)):(s<I&&P(),J=o[I],delete o[I],J&&!J.lineEmpty&&(e||J.type==="/")&&(j=J.leading?null:J.text)),j}return Object.defineProperty({next:A,peek:P,push:T,skip:U,cmnt:L},"line",{get:function(){return i}})}});var Nw=R((kj,Mw)=>{"use strict";Mw.exports=_r;_r.filename=null;_r.defaults={keepCase:!1};var eO=Vm(),Dw=Pu(),Rw=Mu(),kw=Yr(),tO=Au(),xw=Ki(),nO=Rn(),rO=Du(),iO=Iu(),sO=Jr(),oO=$i(),Bm=dt(),aO=/^[1-9][0-9]*$/,lO=/^-?[1-9][0-9]*$/,cO=/^0[x][0-9a-fA-F]+$/,uO=/^-?0[x][0-9a-fA-F]+$/,dO=/^0[0-7]+$/,hO=/^-?0[0-7]+$/,fO=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Jn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Xn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function _r(n,e,t){e instanceof Dw||(t=e,e=new Dw),t||(t=_r.defaults);var r=t.preferTrailingComment||!1,i=eO(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,f,v,w="proto2",A=e,T=[],P={},U=t.keepCase?function(x){return x}:Bm.camelCase;function L(){T.forEach(x=>{x._edition=w,Object.keys(P).forEach(k=>{x.getOption(k)===void 0&&x.setOption(k,P[k],!0)})})}function I(x,k,N){var K=_r.filename;return N||(_r.filename=null),Error("illegal "+(k||"token")+" '"+x+"' ("+(K?K+", ":"")+"line "+i.line+")")}function j(){var x=[],k;do{if((k=s())!=='"'&&k!=="'")throw I(k);x.push(s()),l(k),k=a()}while(k==='"'||k==="'");return x.join("")}function J(x){var k=s();switch(k){case"'":case'"':return o(k),j();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return g(k,!0)}catch{if(x&&Xn.test(k))return k;throw I(k,"value")}}function b(x,k){var N,K;do if(k&&((N=a())==='"'||N==="'")){var H=j();if(x.push(H),w>=2023)throw I(H,"id")}else try{x.push([K=y(s()),l("to",!0)?y(s()):K])}catch(Pe){if(k&&Xn.test(N)&&w>=2023)x.push(N);else throw Pe}while(l(",",!0));var ae={options:void 0};ae.setOption=function(Pe,bt){this.options===void 0&&(this.options={}),this.options[Pe]=bt},F(ae,function(bt){if(bt==="option")ye(ae,bt),l(";");else throw I(bt)},function(){fr(ae)})}function g(x,k){var N=1;switch(x.charAt(0)==="-"&&(N=-1,x=x.substring(1)),x){case"inf":case"INF":case"Inf":return N*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(aO.test(x))return N*parseInt(x,10);if(cO.test(x))return N*parseInt(x,16);if(dO.test(x))return N*parseInt(x,8);if(fO.test(x))return N*parseFloat(x);throw I(x,"number",k)}function y(x,k){switch(x){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!k&&x.charAt(0)==="-")throw I(x,"id");if(lO.test(x))return parseInt(x,10);if(uO.test(x))return parseInt(x,16);if(hO.test(x))return parseInt(x,8);throw I(x,"id")}function _(){if(d!==void 0)throw I("package");if(d=s(),!Xn.test(d))throw I(d,"name");A=A.define(d),l(";")}function p(){var x=a(),k;switch(x){case"weak":k=v||(v=[]),s();break;case"public":s();default:k=f||(f=[]);break}x=j(),l(";"),k.push(x)}function S(){if(l("="),w=j(),w<2023)throw I(w,"syntax");l(";")}function h(){if(l("="),w=j(),!["2023"].includes(w))throw I(w,"edition");l(";")}function m(x,k){switch(k){case"option":return ye(x,k),l(";"),!0;case"message":return ue(x,k),!0;case"enum":return Dt(x,k),!0;case"service":return Q1(x,k),!0;case"extend":return J1(x,k),!0}return!1}function F(x,k,N){var K=i.line;if(x&&(typeof x.comment!="string"&&(x.comment=c()),x.filename=_r.filename),l("{",!0)){for(var H;(H=s())!=="}";)k(H);l(";",!0)}else N&&N(),l(";"),x&&(typeof x.comment!="string"||r)&&(x.comment=c(K)||x.comment)}function ue(x,k){if(!Jn.test(k=s()))throw I(k,"type name");var N=new Rw(k);F(N,function(H){if(!m(N,H))switch(H){case"map":He(N,H);break;case"required":if(w!=="proto2")throw I(H);case"repeated":ce(N,H);break;case"optional":if(w==="proto3")ce(N,"proto3_optional");else{if(w!=="proto2")throw I(H);ce(N,"optional")}break;case"oneof":_t(N,H);break;case"extensions":b(N.extensions||(N.extensions=[]));break;case"reserved":b(N.reserved||(N.reserved=[]),!0);break;default:if(w==="proto2"||!Xn.test(H))throw I(H);o(H),ce(N,"optional");break}}),x.add(N),x===A&&T.push(N)}function ce(x,k,N){var K=s();if(K==="group"){De(x,k);return}for(;K.endsWith(".")||a().startsWith(".");)K+=s();if(!Xn.test(K))throw I(K,"type");var H=s();if(!Jn.test(H))throw I(H,"name");H=U(H),l("=");var ae=new kw(H,y(s()),K,k,N);if(F(ae,function(xt){if(xt==="option")ye(ae,xt),l(";");else throw I(xt)},function(){fr(ae)}),k==="proto3_optional"){var Pe=new xw("_"+H);ae.setOption("proto3_optional",!0),Pe.add(ae),x.add(Pe)}else x.add(ae);x===A&&T.push(ae)}function De(x,k){if(w>=2023)throw I("group");var N=s();if(!Jn.test(N))throw I(N,"name");var K=Bm.lcFirst(N);N===K&&(N=Bm.ucFirst(N)),l("=");var H=y(s()),ae=new Rw(N);ae.group=!0;var Pe=new kw(K,H,N,k);Pe.filename=_r.filename,F(ae,function(xt){switch(xt){case"option":ye(ae,xt),l(";");break;case"required":case"repeated":ce(ae,xt);break;case"optional":w==="proto3"?ce(ae,"proto3_optional"):ce(ae,"optional");break;case"message":ue(ae,xt);break;case"enum":Dt(ae,xt);break;default:throw I(xt)}}),x.add(ae).add(Pe)}function He(x){l("<");var k=s();if(oO.mapKey[k]===void 0)throw I(k,"type");l(",");var N=s();if(!Xn.test(N))throw I(N,"type");l(">");var K=s();if(!Jn.test(K))throw I(K,"name");l("=");var H=new tO(U(K),y(s()),k,N);F(H,function(Pe){if(Pe==="option")ye(H,Pe),l(";");else throw I(Pe)},function(){fr(H)}),x.add(H)}function _t(x,k){if(!Jn.test(k=s()))throw I(k,"name");var N=new xw(U(k));F(N,function(H){H==="option"?(ye(N,H),l(";")):(o(H),ce(N,"optional"))}),x.add(N)}function Dt(x,k){if(!Jn.test(k=s()))throw I(k,"name");var N=new nO(k);F(N,function(H){switch(H){case"option":ye(N,H),l(";");break;case"reserved":b(N.reserved||(N.reserved=[]),!0),N.reserved===void 0&&(N.reserved=[]);break;default:lt(N,H)}}),x.add(N),x===A&&T.push(N)}function lt(x,k){if(!Jn.test(k))throw I(k,"name");l("=");var N=y(s(),!0),K={options:void 0};K.getOption=function(H){return this.options[H]},K.setOption=function(H,ae){sO.prototype.setOption.call(K,H,ae)},K.setParsedOption=function(){},F(K,function(ae){if(ae==="option")ye(K,ae),l(";");else throw I(ae)},function(){fr(K)}),x.add(k,N,K.comment,K.parsedOptions||K.options)}function ye(x,k){var N,K,H=!0;for(k==="option"&&(k=s());k!=="=";){if(k==="("){var ae=s();l(")"),k="("+ae+")"}if(H){if(H=!1,k.includes(".")&&!k.includes("(")){var Pe=k.split(".");N=Pe[0]+".",k=Pe[1];continue}N=k}else K=K?K+=k:k;k=s()}var bt=K?N.concat(K):N,xt=Rt(x,bt);K=K&&K[0]==="."?K.slice(1):K,N=N&&N[N.length-1]==="."?N.slice(0,-1):N,kt(x,N,xt,K)}function Rt(x,k){if(l("{",!0)){for(var N={};!l("}",!0);){if(!Jn.test(mt=s()))throw I(mt,"name");if(mt===null)throw I(mt,"end of input");var K,H=mt;if(l(":",!0),a()==="{")K=Rt(x,k+"."+mt);else if(a()==="["){K=[];var ae;if(l("[",!0)){do ae=J(!0),K.push(ae);while(l(",",!0));l("]"),typeof ae<"u"&&ze(x,k+"."+mt,ae)}}else K=J(!0),ze(x,k+"."+mt,K);var Pe=N[H];Pe&&(K=[].concat(Pe).concat(K)),N[H]=K,l(",",!0),l(";",!0)}return N}var bt=J(!0);return ze(x,k,bt),bt}function ze(x,k,N){if(A===x&&/^features\./.test(k)){P[k]=N;return}x.setOption&&x.setOption(k,N)}function kt(x,k,N,K){x.setParsedOption&&x.setParsedOption(k,N,K)}function fr(x){if(l("[",!0)){do ye(x,"option");while(l(",",!0));l("]")}return x}function Q1(x,k){if(!Jn.test(k=s()))throw I(k,"service name");var N=new rO(k);F(N,function(H){if(!m(N,H))if(H==="rpc")Y1(N,H);else throw I(H)}),x.add(N),x===A&&T.push(N)}function Y1(x,k){var N=c(),K=k;if(!Jn.test(k=s()))throw I(k,"name");var H=k,ae,Pe,bt,xt;if(l("("),l("stream",!0)&&(Pe=!0),!Xn.test(k=s())||(ae=k,l(")"),l("returns"),l("("),l("stream",!0)&&(xt=!0),!Xn.test(k=s())))throw I(k);bt=k,l(")");var wc=new iO(H,K,ae,bt,Pe,xt);wc.comment=N,F(wc,function(vf){if(vf==="option")ye(wc,vf),l(";");else throw I(vf)}),x.add(wc)}function J1(x,k){if(!Xn.test(k=s()))throw I(k,"reference");var N=k;F(null,function(H){switch(H){case"required":case"repeated":ce(x,H,N);break;case"optional":w==="proto3"?ce(x,"proto3_optional",N):ce(x,"optional",N);break;default:if(w==="proto2"||!Xn.test(H))throw I(H);o(H),ce(x,"optional",N);break}})}for(var mt;(mt=s())!==null;)switch(mt){case"package":if(!u)throw I(mt);_();break;case"import":if(!u)throw I(mt);p();break;case"syntax":if(!u)throw I(mt);S();break;case"edition":if(!u)throw I(mt);h();break;case"option":ye(A,mt),l(";",!0);break;default:if(m(A,mt)){u=!1;continue}throw I(mt)}return L(),_r.filename=null,{package:d,imports:f,weakImports:v,root:e}}});var Fw=R((xj,Pw)=>{"use strict";Pw.exports=xn;var pO=/\/|\./;function xn(n,e){pO.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),xn[n]=e}xn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var Ow;xn("duration",{Duration:Ow={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});xn("timestamp",{Timestamp:Ow});xn("empty",{Empty:{fields:{}}});xn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});xn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});xn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});xn.get=function(e){return xn[e]||null}});var Vw=R((Mj,Lw)=>{"use strict";var Zr=Lw.exports=Ew();Zr.build="full";Zr.tokenize=Vm();Zr.parse=Nw();Zr.common=Fw();Zr.Root._configure(Zr.Type,Zr.parse,Zr.common)});var qu=R((Nj,Bw)=>{"use strict";Bw.exports=Vw()});var qm=R((Oj,mO)=>{mO.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var jw=R((le,Gw)=>{"use strict";var Pt=qu();Gw.exports=le=Pt.descriptor=Pt.Root.fromJSON(qm()).lookup(".google.protobuf");var qw=Pt.Namespace,nl=Pt.Root,br=Pt.Enum,ei=Pt.Type,ti=Pt.Field,gO=Pt.MapField,Uu=Pt.OneOf,rl=Pt.Service,zu=Pt.Method;nl.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.FileDescriptorSet.decode(e));var t=new nl;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(ei.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(br.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(ti.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(rl.fromDescriptor(r.service[o]));var a=co(r.options,le.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};nl.prototype.toDescriptor=function(e){var t=le.FileDescriptorSet.create();return Uw(this,t.file,e),t};function Uw(n,e,t){var r=le.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof nl||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof ei?r.messageType.push(s.toDescriptor(t)):s instanceof br?r.enumType.push(s.toDescriptor()):s instanceof ti?r.extension.push(s.toDescriptor(t)):s instanceof rl?r.service.push(s.toDescriptor()):s instanceof qw&&Uw(s,e,t);r.options=uo(n.options,le.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var yO=0;ei.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=le.DescriptorProto.decode(e));var r=new ei(e.name.length?e.name:"Type"+yO++,co(e.options,le.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Uu.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=ti.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(ti.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(ei.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(br.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};ei.prototype.toDescriptor=function(e){var t=le.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof gO){var s=Um(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Um(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&zw(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(le.DescriptorProto.create({name:i.typeName,field:[le.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),le.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:le.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof ti?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ei?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof br&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(le.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(le.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=uo(this.options,le.MessageOptions),t};var vO=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;ti.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=le.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=wO(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new ti(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=co(e.options,le.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=vO.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return EO(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};ti.prototype.toDescriptor=function(e){var t=le.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Pt.util.ucFirst(this.name),t.label=3;else{switch(t.type=Um(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?zw(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=uo(this.options,le.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=le.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=le.FieldOptions.create())).packed=!0),t};var _O=0;br.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new br(e.name&&e.name.length?e.name:"Enum"+_O++,t,co(e.options,le.EnumOptions))};br.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(le.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return le.EnumDescriptorProto.create({name:this.name,value:e,options:uo(this.options,le.EnumOptions)})};var bO=0;Uu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=le.OneofDescriptorProto.decode(e)),new Uu(e.name&&e.name.length?e.name:"oneof"+bO++)};Uu.prototype.toDescriptor=function(){return le.OneofDescriptorProto.create({name:this.name})};var SO=0;rl.fromDescriptor=function(e){typeof e.length=="number"&&(e=le.ServiceDescriptorProto.decode(e));var t=new rl(e.name&&e.name.length?e.name:"Service"+SO++,co(e.options,le.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(zu.fromDescriptor(e.method[r]));return t};rl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return le.ServiceDescriptorProto.create({name:this.name,method:e,options:uo(this.options,le.ServiceOptions)})};var CO=0;zu.fromDescriptor=function(e){return typeof e.length=="number"&&(e=le.MethodDescriptorProto.decode(e)),new zu(e.name&&e.name.length?e.name:"Method"+CO++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,co(e.options,le.MethodOptions))};zu.prototype.toDescriptor=function(){return le.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:uo(this.options,le.MethodOptions)})};function wO(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function EO(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Um(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof br)return 14;if(e instanceof ei)return e.group?10:11;throw Error("illegal type: "+n)}function co(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof br&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(TO(s),o));return t.length?Pt.util.toObject(t):void 0}}function uo(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Pt.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Pt.util.toObject(t)):void 0}}function zw(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof nl)&&e instanceof qw)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function TO(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var Ww=R((Pj,AO)=>{AO.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var Hw=R((Fj,IO)=>{IO.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Kw=R((Lj,DO)=>{DO.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var Jw=R(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.addCommonProtos=ni.loadProtosWithOptionsSync=ni.loadProtosWithOptions=void 0;var $w=Ee("fs"),Qw=Ee("path"),ho=qu();function Yw(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(Qw.isAbsolute(i))return i;for(let s of e){let o=Qw.join(s,i);try{return $w.accessSync(o,$w.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function RO(n,e){return C(this,null,function*(){let t=new ho.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));Yw(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}ni.loadProtosWithOptions=RO;function kO(n,e){let t=new ho.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");Yw(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}ni.loadProtosWithOptionsSync=kO;function xO(){let n=Ww(),e=qm(),t=Hw(),r=Kw();ho.common("api",n.nested.google.nested.protobuf.nested),ho.common("descriptor",e.nested.google.nested.protobuf.nested),ho.common("source_context",t.nested.google.nested.protobuf.nested),ho.common("type",r.nested.google.nested.protobuf.nested)}ni.addCommonProtos=xO});var Xw=R((il,zm)=>{"use strict";(function(n,e){function t(r){return r.default||r}typeof define=="function"&&define.amd?define([],function(){var r={};return e(r),t(r)}):typeof il=="object"?(e(il),typeof zm=="object"&&(zm.exports=t(il))):function(){var r={};e(r),n.Long=t(r)}()})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:il,function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(h,m,F){this.low=h|0,this.high=m|0,this.unsigned=!!F}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(h){return(h&&h.__isLong__)===!0}function i(h){var m=Math.clz32(h&-h);return h?31-m:m}t.isLong=r;var s={},o={};function a(h,m){var F,ue,ce;return m?(h>>>=0,(ce=0<=h&&h<256)&&(ue=o[h],ue)?ue:(F=c(h,0,!0),ce&&(o[h]=F),F)):(h|=0,(ce=-128<=h&&h<128)&&(ue=s[h],ue)?ue:(F=c(h,h<0?-1:0,!1),ce&&(s[h]=F),F))}t.fromInt=a;function l(h,m){if(isNaN(h))return m?I:L;if(m){if(h<0)return I;if(h>=T)return y}else{if(h<=-P)return _;if(h+1>=P)return g}return h<0?l(-h,m).neg():c(h%A|0,h/A|0,m)}t.fromNumber=l;function c(h,m,F){return new t(h,m,F)}t.fromBits=c;var u=Math.pow;function d(h,m,F){if(h.length===0)throw Error("empty string");if(typeof m=="number"?(F=m,m=!1):m=!!m,h==="NaN"||h==="Infinity"||h==="+Infinity"||h==="-Infinity")return m?I:L;if(F=F||10,F<2||36<F)throw RangeError("radix");var ue;if((ue=h.indexOf("-"))>0)throw Error("interior hyphen");if(ue===0)return d(h.substring(1),m,F).neg();for(var ce=l(u(F,8)),De=L,He=0;He<h.length;He+=8){var _t=Math.min(8,h.length-He),Dt=parseInt(h.substring(He,He+_t),F);if(_t<8){var lt=l(u(F,_t));De=De.mul(lt).add(l(Dt))}else De=De.mul(ce),De=De.add(l(Dt))}return De.unsigned=m,De}t.fromString=d;function f(h,m){return typeof h=="number"?l(h,m):typeof h=="string"?d(h,m):c(h.low,h.high,typeof m=="boolean"?m:h.unsigned)}t.fromValue=f;var v=65536,w=1<<24,A=v*v,T=A*A,P=T/2,U=a(w),L=a(0);t.ZERO=L;var I=a(0,!0);t.UZERO=I;var j=a(1);t.ONE=j;var J=a(1,!0);t.UONE=J;var b=a(-1);t.NEG_ONE=b;var g=c(-1,2147483647,!1);t.MAX_VALUE=g;var y=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=y;var _=c(0,-2147483648,!1);t.MIN_VALUE=_;var p=t.prototype;p.toInt=function(){return this.unsigned?this.low>>>0:this.low},p.toNumber=function(){return this.unsigned?(this.high>>>0)*A+(this.low>>>0):this.high*A+(this.low>>>0)},p.toString=function(m){if(m=m||10,m<2||36<m)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_)){var F=l(m),ue=this.div(F),ce=ue.mul(F).sub(this);return ue.toString(m)+ce.toInt().toString(m)}else return"-"+this.neg().toString(m);for(var De=l(u(m,6),this.unsigned),He=this,_t="";;){var Dt=He.div(De),lt=He.sub(Dt.mul(De)).toInt()>>>0,ye=lt.toString(m);if(He=Dt,He.isZero())return ye+_t;for(;ye.length<6;)ye="0"+ye;_t=""+ye+_t}},p.getHighBits=function(){return this.high},p.getHighBitsUnsigned=function(){return this.high>>>0},p.getLowBits=function(){return this.low},p.getLowBitsUnsigned=function(){return this.low>>>0},p.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var m=this.high!=0?this.high:this.low,F=31;F>0&&!(m&1<<F);F--);return this.high!=0?F+33:F+1},p.isSafeInteger=function(){var m=this.high>>21;return m?this.unsigned?!1:m===-1&&!(this.low===0&&this.high===-2097152):!0},p.isZero=function(){return this.high===0&&this.low===0},p.eqz=p.isZero,p.isNegative=function(){return!this.unsigned&&this.high<0},p.isPositive=function(){return this.unsigned||this.high>=0},p.isOdd=function(){return(this.low&1)===1},p.isEven=function(){return(this.low&1)===0},p.equals=function(m){return r(m)||(m=f(m)),this.unsigned!==m.unsigned&&this.high>>>31===1&&m.high>>>31===1?!1:this.high===m.high&&this.low===m.low},p.eq=p.equals,p.notEquals=function(m){return!this.eq(m)},p.neq=p.notEquals,p.ne=p.notEquals,p.lessThan=function(m){return this.comp(m)<0},p.lt=p.lessThan,p.lessThanOrEqual=function(m){return this.comp(m)<=0},p.lte=p.lessThanOrEqual,p.le=p.lessThanOrEqual,p.greaterThan=function(m){return this.comp(m)>0},p.gt=p.greaterThan,p.greaterThanOrEqual=function(m){return this.comp(m)>=0},p.gte=p.greaterThanOrEqual,p.ge=p.greaterThanOrEqual,p.compare=function(m){if(r(m)||(m=f(m)),this.eq(m))return 0;var F=this.isNegative(),ue=m.isNegative();return F&&!ue?-1:!F&&ue?1:this.unsigned?m.high>>>0>this.high>>>0||m.high===this.high&&m.low>>>0>this.low>>>0?-1:1:this.sub(m).isNegative()?-1:1},p.comp=p.compare,p.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(j)},p.neg=p.negate,p.add=function(m){r(m)||(m=f(m));var F=this.high>>>16,ue=this.high&65535,ce=this.low>>>16,De=this.low&65535,He=m.high>>>16,_t=m.high&65535,Dt=m.low>>>16,lt=m.low&65535,ye=0,Rt=0,ze=0,kt=0;return kt+=De+lt,ze+=kt>>>16,kt&=65535,ze+=ce+Dt,Rt+=ze>>>16,ze&=65535,Rt+=ue+_t,ye+=Rt>>>16,Rt&=65535,ye+=F+He,ye&=65535,c(ze<<16|kt,ye<<16|Rt,this.unsigned)},p.subtract=function(m){return r(m)||(m=f(m)),this.add(m.neg())},p.sub=p.subtract,p.multiply=function(m){if(this.isZero())return this;if(r(m)||(m=f(m)),e){var F=e.mul(this.low,this.high,m.low,m.high);return c(F,e.get_high(),this.unsigned)}if(m.isZero())return this.unsigned?I:L;if(this.eq(_))return m.isOdd()?_:L;if(m.eq(_))return this.isOdd()?_:L;if(this.isNegative())return m.isNegative()?this.neg().mul(m.neg()):this.neg().mul(m).neg();if(m.isNegative())return this.mul(m.neg()).neg();if(this.lt(U)&&m.lt(U))return l(this.toNumber()*m.toNumber(),this.unsigned);var ue=this.high>>>16,ce=this.high&65535,De=this.low>>>16,He=this.low&65535,_t=m.high>>>16,Dt=m.high&65535,lt=m.low>>>16,ye=m.low&65535,Rt=0,ze=0,kt=0,fr=0;return fr+=He*ye,kt+=fr>>>16,fr&=65535,kt+=De*ye,ze+=kt>>>16,kt&=65535,kt+=He*lt,ze+=kt>>>16,kt&=65535,ze+=ce*ye,Rt+=ze>>>16,ze&=65535,ze+=De*lt,Rt+=ze>>>16,ze&=65535,ze+=He*Dt,Rt+=ze>>>16,ze&=65535,Rt+=ue*ye+ce*lt+De*Dt+He*_t,Rt&=65535,c(kt<<16|fr,Rt<<16|ze,this.unsigned)},p.mul=p.multiply,p.divide=function(m){if(r(m)||(m=f(m)),m.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&m.low===-1&&m.high===-1)return this;var F=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,m.low,m.high);return c(F,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?I:L;var ue,ce,De;if(this.unsigned){if(m.unsigned||(m=m.toUnsigned()),m.gt(this))return I;if(m.gt(this.shru(1)))return J;De=I}else{if(this.eq(_)){if(m.eq(j)||m.eq(b))return _;if(m.eq(_))return j;var He=this.shr(1);return ue=He.div(m).shl(1),ue.eq(L)?m.isNegative()?j:b:(ce=this.sub(m.mul(ue)),De=ue.add(ce.div(m)),De)}else if(m.eq(_))return this.unsigned?I:L;if(this.isNegative())return m.isNegative()?this.neg().div(m.neg()):this.neg().div(m).neg();if(m.isNegative())return this.div(m.neg()).neg();De=L}for(ce=this;ce.gte(m);){ue=Math.max(1,Math.floor(ce.toNumber()/m.toNumber()));for(var _t=Math.ceil(Math.log(ue)/Math.LN2),Dt=_t<=48?1:u(2,_t-48),lt=l(ue),ye=lt.mul(m);ye.isNegative()||ye.gt(ce);)ue-=Dt,lt=l(ue,this.unsigned),ye=lt.mul(m);lt.isZero()&&(lt=j),De=De.add(lt),ce=ce.sub(ye)}return De},p.div=p.divide,p.modulo=function(m){if(r(m)||(m=f(m)),e){var F=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,m.low,m.high);return c(F,e.get_high(),this.unsigned)}return this.sub(this.div(m).mul(m))},p.mod=p.modulo,p.rem=p.modulo,p.not=function(){return c(~this.low,~this.high,this.unsigned)},p.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},p.clz=p.countLeadingZeros,p.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},p.ctz=p.countTrailingZeros,p.and=function(m){return r(m)||(m=f(m)),c(this.low&m.low,this.high&m.high,this.unsigned)},p.or=function(m){return r(m)||(m=f(m)),c(this.low|m.low,this.high|m.high,this.unsigned)},p.xor=function(m){return r(m)||(m=f(m)),c(this.low^m.low,this.high^m.high,this.unsigned)},p.shiftLeft=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low<<m,this.high<<m|this.low>>>32-m,this.unsigned):c(0,this.low<<m-32,this.unsigned)},p.shl=p.shiftLeft,p.shiftRight=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>m,this.unsigned):c(this.high>>m-32,this.high>=0?0:-1,this.unsigned)},p.shr=p.shiftRight,p.shiftRightUnsigned=function(m){return r(m)&&(m=m.toInt()),(m&=63)===0?this:m<32?c(this.low>>>m|this.high<<32-m,this.high>>>m,this.unsigned):m===32?c(this.high,0,this.unsigned):c(this.high>>>m-32,0,this.unsigned)},p.shru=p.shiftRightUnsigned,p.shr_u=p.shiftRightUnsigned,p.rotateLeft=function(m){var F;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(F=32-m,c(this.low<<m|this.high>>>F,this.high<<m|this.low>>>F,this.unsigned)):(m-=32,F=32-m,c(this.high<<m|this.low>>>F,this.low<<m|this.high>>>F,this.unsigned))},p.rotl=p.rotateLeft,p.rotateRight=function(m){var F;return r(m)&&(m=m.toInt()),(m&=63)===0?this:m===32?c(this.high,this.low,this.unsigned):m<32?(F=32-m,c(this.high<<F|this.low>>>m,this.low<<F|this.high>>>m,this.unsigned)):(m-=32,F=32-m,c(this.low<<F|this.high>>>m,this.high<<F|this.low>>>m,this.unsigned))},p.rotr=p.rotateRight,p.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},p.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},p.toBytes=function(m){return m?this.toBytesLE():this.toBytesBE()},p.toBytesLE=function(){var m=this.high,F=this.low;return[F&255,F>>>8&255,F>>>16&255,F>>>24,m&255,m>>>8&255,m>>>16&255,m>>>24]},p.toBytesBE=function(){var m=this.high,F=this.low;return[m>>>24,m>>>16&255,m>>>8&255,m&255,F>>>24,F>>>16&255,F>>>8&255,F&255]},t.fromBytes=function(m,F,ue){return ue?t.fromBytesLE(m,F):t.fromBytesBE(m,F)},t.fromBytesLE=function(m,F){return new t(m[0]|m[1]<<8|m[2]<<16|m[3]<<24,m[4]|m[5]<<8|m[6]<<16|m[7]<<24,F)},t.fromBytesBE=function(m,F){return new t(m[4]<<24|m[5]<<16|m[6]<<8|m[7],m[0]<<24|m[1]<<16|m[2]<<8|m[3],F)},typeof BigInt=="function"&&(t.fromBigInt=function(m,F){var ue=Number(BigInt.asIntN(32,m)),ce=Number(BigInt.asIntN(32,m>>BigInt(32)));return c(ue,ce,F)},t.fromValue=function(m,F){return typeof m=="bigint"?t.fromBigInt(m,F):f(m,F)},p.toBigInt=function(){var m=BigInt(this.low>>>0),F=BigInt(this.unsigned?this.high>>>0:this.high);return F<<BigInt(32)|m});var S=n.default=t})});var Hm=R(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.loadFileDescriptorSetFromObject=ot.loadFileDescriptorSetFromBuffer=ot.fromJSON=ot.loadSync=ot.load=ot.IdempotencyLevel=ot.isAnyExtension=ot.Long=void 0;var MO=GS(),Zn=qu(),jm=jw(),Wm=Jw(),NO=Xw();ot.Long=NO;function OO(n){return"@type"in n&&typeof n["@type"]=="string"}ot.isAnyExtension=OO;var tE;(function(n){n.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",n.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",n.IDEMPOTENT="IDEMPOTENT"})(tE=ot.IdempotencyLevel||(ot.IdempotencyLevel={}));var nE={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function PO(n,e){return n===""?e:n+"."+e}function FO(n){return n instanceof Zn.Service||n instanceof Zn.Type||n instanceof Zn.Enum}function LO(n){return n instanceof Zn.Namespace||n instanceof Zn.Root}function rE(n,e){let t=PO(e,n.name);return FO(n)?[[t,n]]:LO(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>rE(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function Zw(n,e){return function(r){return n.toObject(n.decode(r),e)}}function eE(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function VO(n){return(n||[]).reduce((e,t)=>{for(let[r,i]of Object.entries(t))switch(r){case"uninterpreted_option":e.uninterpreted_option.push(t.uninterpreted_option);break;default:e[r]=i}return e},{deprecated:!1,idempotency_level:tE.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function BO(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:eE(i),requestDeserialize:Zw(i,t),responseSerialize:eE(s),responseDeserialize:Zw(s,t),originalName:MO(n.name),requestType:Gm(i,r),responseType:Gm(s,r),options:VO(n.parsedOptions)}}function qO(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=BO(s,e,t,r);return i}function Gm(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,nE),fileDescriptorProtos:e}}function UO(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,nE),fileDescriptorProtos:e}}function zO(n,e,t,r){if(n instanceof Zn.Service)return qO(n,e,t,r);if(n instanceof Zn.Type)return Gm(n,r);if(n instanceof Zn.Enum)return UO(n,r);throw new Error("Type mismatch in reflection object handling")}function Gu(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(jm.FileDescriptorProto.encode(s).finish()));for(let[s,o]of rE(n,""))t[s]=zO(o,s,e,i);return t}function iE(n,e){e=e||{};let t=Zn.Root.fromDescriptor(n);return t.resolveAll(),Gu(t,e)}function GO(n,e){return(0,Wm.loadProtosWithOptions)(n,e).then(t=>Gu(t,e))}ot.load=GO;function jO(n,e){let t=(0,Wm.loadProtosWithOptionsSync)(n,e);return Gu(t,e)}ot.loadSync=jO;function WO(n,e){e=e||{};let t=Zn.Root.fromJSON(n);return t.resolveAll(),Gu(t,e)}ot.fromJSON=WO;function HO(n,e){let t=jm.FileDescriptorSet.decode(n);return iE(t,e)}ot.loadFileDescriptorSetFromBuffer=HO;function KO(n,e){let t=jm.FileDescriptorSet.fromObject(n);return iE(t,e)}ot.loadFileDescriptorSetFromObject=KO;(0,Wm.addCommonProtos)()});var Yi=R(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.setup=Fe.getChannelzServiceDefinition=Fe.getChannelzHandlers=Fe.unregisterChannelzRef=Fe.registerChannelzSocket=Fe.registerChannelzServer=Fe.registerChannelzSubchannel=Fe.registerChannelzChannel=Fe.ChannelzCallTracker=Fe.ChannelzChildrenTracker=Fe.ChannelzTrace=void 0;var sE=Ee("net"),sl=fn(),al=we(),$O=Wn(),QO=du(),YO=jp();function Km(n){return{channel_id:n.id,name:n.name}}function Jm(n){return{subchannel_id:n.id,name:n.name}}function JO(n){return{server_id:n.id}}function Wu(n){return{socket_id:n.id,name:n.name}}var oE=32,$m=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=oE*2&&(this.events=this.events.slice(oE)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Sr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Sr(e.timestamp),channel_ref:e.childChannel?Km(e.childChannel):null,subchannel_ref:e.childSubchannel?Jm(e.childSubchannel):null}))}}};Fe.ChannelzTrace=$m;var Qm=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Fe.ChannelzChildrenTracker=Qm;var Ym=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Fe.ChannelzCallTracker=Ym;var XO=1;function Hu(){return XO++}var ol=[],Xm=[],ri=[],Zm=[];function ZO(n,e,t){let r=Hu(),i={id:r,name:n,kind:"channel"};return t&&(ol[r]={ref:i,getInfo:e}),i}Fe.registerChannelzChannel=ZO;function eP(n,e,t){let r=Hu(),i={id:r,name:n,kind:"subchannel"};return t&&(Xm[r]={ref:i,getInfo:e}),i}Fe.registerChannelzSubchannel=eP;function tP(n,e){let t=Hu(),r={id:t,kind:"server"};return e&&(ri[t]={ref:r,getInfo:n}),r}Fe.registerChannelzServer=tP;function nP(n,e,t){let r=Hu(),i={id:r,name:n,kind:"socket"};return t&&(Zm[r]={ref:i,getInfo:e}),i}Fe.registerChannelzSocket=nP;function rP(n){switch(n.kind){case"channel":delete ol[n.id];return;case"subchannel":delete Xm[n.id];return;case"server":delete ri[n.id];return;case"socket":delete Zm[n.id];return}}Fe.unregisterChannelzRef=rP;function iP(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function aE(n){if(n==="")return[];let e=n.split(":").map(r=>iP(r));return[].concat(...e)}function sP(n){if((0,sE.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,sE.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(aE(e)),s=Buffer.from(aE(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function cE(n){switch(n){case sl.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case sl.ConnectivityState.IDLE:return{state:"IDLE"};case sl.ConnectivityState.READY:return{state:"READY"};case sl.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case sl.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Sr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function uE(n){let e=n.getInfo();return{ref:Km(n.ref),data:{target:e.target,state:cE(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Sr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Km(t)),subchannel_ref:e.children.subchannels.map(t=>Jm(t))}}function oP(n,e){let t=Number.parseInt(n.request.channel_id),r=ol[t];if(r===void 0){e({code:al.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:uE(r)})}function aP(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<ol.length;i++){let s=ol[i];if(s!==void 0&&(r.push(uE(s)),r.length>=t))break}e(null,{channel:r,end:i>=ri.length})}function dE(n){let e=n.getInfo();return{ref:JO(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Sr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Wu(t))}}function lP(n,e){let t=Number.parseInt(n.request.server_id),r=ri[t];if(r===void 0){e({code:al.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:dE(r)})}function cP(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<ri.length;i++){let s=ri[i];if(s!==void 0&&(r.push(dE(s)),r.length>=t))break}e(null,{server:r,end:i>=ri.length})}function uP(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Xm[t];if(r===void 0){e({code:al.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:Jm(r.ref),data:{target:i.target,state:cE(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Sr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Wu(o))};e(null,{subchannel:s})}function lE(n){var e;return(0,$O.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=sP(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function dP(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=Zm[a];if(l===void 0){e({code:al.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Wu(l.ref),local:c.localAddress?lE(c.localAddress):null,remote:c.remoteAddress?lE(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Sr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Sr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Sr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Sr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function hP(n,e){let t=Number.parseInt(n.request.server_id),r=ri[t];if(r===void 0){e({code:al.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Wu(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function hE(){return{GetChannel:oP,GetTopChannels:aP,GetServer:lP,GetServers:cP,GetSubchannel:uP,GetSocket:dP,GetServerSockets:hP}}Fe.getChannelzHandlers=hE;var ju=null;function fE(){if(ju)return ju;let n=Hm().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return ju=(0,YO.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,ju}Fe.getChannelzServiceDefinition=fE;function fP(){(0,QO.registerAdminService)(fE,hE)}Fe.setup=fP});var pE=R($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});$u.Subchannel=void 0;var xe=fn(),pP=La(),eg=je(),Ku=we(),mP=en(),gP=Wn(),fo=Yi(),yP="subchannel",vP=~(1<<31),tg=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=xe.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new fo.ChannelzCallTracker,this.childrenTracker=new fo.ChannelzChildrenTracker,this.streamTracker=new fo.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new pP.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,gP.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new fo.ChannelzTrace,this.channelzRef=(0,fo.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){eg.trace(Ku.LogVerbosity.DEBUG,yP,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){eg.trace(Ku.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING):this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,vP);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([xe.ConnectivityState.READY],xe.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,eg.log(Ku.LogVerbosity.ERROR,`Connection to ${(0,mP.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([xe.ConnectivityState.CONNECTING],xe.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(xe.ConnectivityState[this.connectivityState]+" -> "+xe.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+xe.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case xe.ConnectivityState.READY:this.stopBackoff();break;case xe.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case xe.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case xe.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,fo.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.CONNECTING,xe.ConnectivityState.READY],xe.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Ku.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([xe.ConnectivityState.IDLE],xe.ConnectivityState.CONNECTING)||this.connectivityState===xe.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([xe.ConnectivityState.TRANSIENT_FAILURE],xe.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};$u.Subchannel=tg});var sg=R(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.setup=oi.DEFAULT_PORT=void 0;var mE=Gn(),yE=Ee("dns"),vE=Ee("util"),_P=yp(),ng=we(),rg=jt(),bP=je(),SP=we(),ii=en(),gE=Ee("net"),CP=La(),wP="dns_resolver";function si(n){bP.trace(SP.LogVerbosity.DEBUG,wP,n)}oi.DEFAULT_PORT=443;var EP=3e4,TP=vE.promisify(yE.resolveTxt),AP=vE.promisify(yE.lookup);function IP(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var ig=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,si("Resolver constructed for target "+(0,ii.uriToString)(e));let a=(0,ii.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,gE.isIPv4)(a.host)||(0,gE.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:oi.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:oi.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:ng.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ii.uriToString)(this.target)}`,metadata:new rg.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new CP.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:EP,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(si("Returning IP address for target "+(0,ii.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)si("Failed to parse DNS address "+(0,ii.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:ng.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ii.uriToString)(this.target)}`,metadata:new rg.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;si("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=AP(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=IP(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(si("Resolved addresses for target "+(0,ii.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(si("Resolution error for target "+(0,ii.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=TP(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,_P.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:ng.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new rg.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?si('resolution update delayed by "min time between resolutions" rate limit'):si("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function DP(){(0,mE.registerResolver)("dns",ig),(0,mE.registerDefaultScheme)("dns")}oi.setup=DP});var og=R(go=>{"use strict";Object.defineProperty(go,"__esModule",{value:!0});go.getProxiedConnection=go.mapProxyName=void 0;var ll=je(),po=we(),RP=Gn(),kP=Ee("http"),xP=Ee("tls"),MP=je(),_E=Wn(),mo=en(),NP=Ee("url"),OP=sg(),PP="proxy";function ai(n){MP.trace(po.LogVerbosity.DEBUG,PP,n)}function FP(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new NP.URL(n)}catch{return(0,ll.log)(po.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,ll.log)(po.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,ll.log)(po.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),ai("Proxy server "+o.address+" set by environment variable "+e),o}function LP(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(ai("No proxy server list set by environment variable "+e),n.split(",")):[]}function VP(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=FP();if(!i.address)return r;let s=(0,mo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of LP())if(l===o)return ai("Not using proxy for target in no_proxy list: "+(0,mo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,mo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}go.mapProxyName=VP;function BP(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,mo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,mo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:OP.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,_E.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,_E.subchannelAddressToString)(n);return ai("Using proxy "+u+" to connect to "+l.path),new Promise((d,f)=>{let v=kP.request(l);v.once("connect",(w,A,T)=>{var P;if(v.removeAllListeners(),A.removeAllListeners(),w.statusCode===200)if(ai("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let U=(0,RP.getDefaultAuthority)(s),L=(0,mo.splitHostPort)(U),I=(P=L?.host)!==null&&P!==void 0?P:U,j=xP.connect(Object.assign({host:I,servername:I,socket:A},t),()=>{ai("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:j,realTarget:s})});j.on("error",J=>{ai("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+J.message),f()})}else ai("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:A,realTarget:s});else(0,ll.log)(po.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+w.statusCode),f()}),v.once("error",w=>{v.removeAllListeners(),(0,ll.log)(po.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+w.message),f()}),v.end()})}go.getProxiedConnection=BP});var lg=R(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});Qu.StreamDecoder=void 0;var Cr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(Cr||{}),ag=class{constructor(e){this.maxReadMessageLength=e,this.readState=Cr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case Cr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=Cr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case Cr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.maxReadMessageLength!==-1&&this.readMessageSize>this.maxReadMessageLength)throw new Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=Cr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=Cr.NO_DATA,i.push(s)}}break;case Cr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=Cr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Qu.StreamDecoder=ag});var bE=R(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.Http2SubchannelCall=void 0;var wr=Ee("http2"),qP=Ee("os"),Ae=we(),li=jt(),UP=lg(),zP=je(),GP=we(),jP="subchannel_call";function WP(n){for(let[e,t]of Object.entries(qP.constants.errno))if(t===n)return e;return"Unknown system error "+n}var cg=class{constructor(e,t,r,i,s){var o;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=Ae.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let a=(o=i.getOptions()["grpc.max_receive_message_length"])!==null&&o!==void 0?o:Ae.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new UP.StreamDecoder(a),e.on("response",(l,c)=>{let u="";for(let d of Object.keys(l))u+="		"+d+": "+l[d]+`
`;switch(this.trace(`Received server headers:
`+u),l[":status"]){case 400:this.mappedStatusCode=Ae.Status.INTERNAL;break;case 401:this.mappedStatusCode=Ae.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=Ae.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=Ae.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=Ae.Status.UNAVAILABLE;break;default:this.mappedStatusCode=Ae.Status.UNKNOWN}if(c&wr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(l);else{let d;try{d=li.Metadata.fromHttp2Headers(l)}catch(f){this.endCall({code:Ae.Status.UNKNOWN,details:f.message,metadata:new li.Metadata});return}this.listener.onReceiveMetadata(d)}}),e.on("trailers",l=>{this.handleTrailers(l)}),e.on("data",l=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+l.length);let c;try{c=this.decoder.write(l)}catch(u){this.cancelWithStatus(Ae.Status.RESOURCE_EXHAUSTED,u.message);return}for(let u of c)this.trace("parsed message of length "+u.length),this.callEventTracker.addMessageReceived(),this.tryPush(u)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var l;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((l=this.finalStatus)===null||l===void 0?void 0:l.code)===Ae.Status.OK)return;let c,u="";switch(e.rstCode){case wr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;c=Ae.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`;break;case wr.constants.NGHTTP2_REFUSED_STREAM:c=Ae.Status.UNAVAILABLE,u="Stream refused by server";break;case wr.constants.NGHTTP2_CANCEL:c=Ae.Status.CANCELLED,u="Call cancelled";break;case wr.constants.NGHTTP2_ENHANCE_YOUR_CALM:c=Ae.Status.RESOURCE_EXHAUSTED,u="Bandwidth exhausted or memory limit exceeded";break;case wr.constants.NGHTTP2_INADEQUATE_SECURITY:c=Ae.Status.PERMISSION_DENIED,u="Protocol not secure enough";break;case wr.constants.NGHTTP2_INTERNAL_ERROR:c=Ae.Status.INTERNAL,this.internalError===null?u=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(c=Ae.Status.UNAVAILABLE,u=this.internalError.message):u=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:c=Ae.Status.INTERNAL,u=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:c,details:u,metadata:new li.Metadata,rstCode:e.rstCode})})}),e.on("error",l=>{l.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+l.message+" code="+l.code+" errno="+WP(l.errno)+" syscall="+l.syscall),this.internalError=l),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:Ae.Status.UNAVAILABLE,details:"Connection dropped",metadata:new li.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){zP.trace(GP.LogVerbosity.DEBUG,jP,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===Ae.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==Ae.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=li.Metadata.fromHttp2Headers(e)}catch{r=new li.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===Ae.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in Ae.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===Ae.Status.OK?t=wr.constants.NGHTTP2_NO_ERROR:t=wr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new li.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==Ae.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=Ae.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=Ae.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:Ae.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new li.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};Yu.Http2SubchannelCall=cg});var ug=R(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});Ju.getNextCallNumber=void 0;var HP=0;function KP(){return HP++}Ju.getNextCallNumber=KP});var wE=R(Zu=>{"use strict";Object.defineProperty(Zu,"__esModule",{value:!0});Zu.Http2SubchannelConnector=void 0;var mg=Ee("http2"),SE=Ee("tls"),dg=Yi(),cl=we(),$P=og(),vo=je(),CE=Gn(),Xu=Wn(),yo=en(),QP=Ee("net"),YP=bE(),JP=ug(),hg="transport",XP="transport_flowctrl",ZP=Zf().version,{HTTP2_HEADER_AUTHORITY:eF,HTTP2_HEADER_CONTENT_TYPE:tF,HTTP2_HEADER_METHOD:nF,HTTP2_HEADER_PATH:rF,HTTP2_HEADER_TE:iF,HTTP2_HEADER_USER_AGENT:sF}=mg.constants,oF=2e4,aF=Buffer.from("too_many_pings","ascii"),fg=class{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=oF,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new dg.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Xu.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,dg.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${ZP}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===mg.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(aF)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),vo.isTracerEnabled(hg)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Xu.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Xu.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),f=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:f&&"raw"in f?f.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){vo.trace(cl.LogVerbosity.DEBUG,hg,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){vo.trace(cl.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){vo.trace(cl.LogVerbosity.DEBUG,XP,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){vo.trace(cl.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[eF]=t,o[sF]=this.userAgent,o[tF]="application/grpc",o[nF]="POST",o[rF]=r,o[iF]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new YP.Http2SubchannelCall(a,l,i,this,(0,JP.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,dg.unregisterChannelzRef)(this.channelzRef)}},pg=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){vo.trace(cl.LogVerbosity.DEBUG,hg,(0,yo.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,yo.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,yo.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Xu.subchannelAddressToString)(e)));let d=(0,CE.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),f=t._getConnectionOptions()||{};f.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?f.maxSessionMemory=r["grpc-node.max_session_memory"]:f.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in f){if(v="https://",r["grpc.ssl_target_name_override"]){let T=r["grpc.ssl_target_name_override"];f.checkServerIdentity=(P,U)=>(0,SE.checkServerIdentity)(T,U),f.servername=T}else{let T=(c=(l=(0,yo.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";f.servername=T}i.socket&&(f.createConnection=(T,P)=>i.socket)}else f.createConnection=(T,P)=>i.socket?i.socket:QP.connect(e);f=Object.assign(Object.assign(Object.assign({},f),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let w=mg.connect(v+d,f);this.session=w;let A="Failed to connect";w.unref(),w.once("connect",()=>{w.removeAllListeners(),s(new fg(w,e,r,u)),this.session=null}),w.once("close",()=>{this.session=null,setImmediate(()=>{o(`${A} (${new Date().toISOString()})`)})}),w.once("error",T=>{A=T.message,this.trace("connection failed with error "+A)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,SE.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,CE.getDefaultAuthority)((i=(0,yo.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,yo.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,$P.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Zu.Http2SubchannelConnector=pg});var EE=R(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.getSubchannelPool=_o.SubchannelPool=void 0;var lF=dS(),cF=pE(),uF=Wn(),dF=en(),hF=wE(),fF=1e4,ul=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},fF),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,dF.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,uF.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,lF.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new cF.Subchannel(e,t,r,i,new hF.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};_o.SubchannelPool=ul;var pF=new ul;function mF(n){return n?pF:new ul}_o.getSubchannelPool=mF});var yg=R(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.FilterStackFactory=bo.FilterStack=void 0;var ed=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};bo.FilterStack=ed;var gg=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new ed(this.factories.map(e=>e.createFilter()))}};bo.FilterStackFactory=gg});var vg=R(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.CompressionAlgorithms=void 0;var TE=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(TE||(td.CompressionAlgorithms=TE={}))});var bg=R(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});nd.BaseFilter=void 0;var _g=class{sendMetadata(e){return C(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return C(this,null,function*(){return e})}receiveMessage(e){return C(this,null,function*(){return e})}receiveTrailers(e){return e}};nd.BaseFilter=_g});var DE=R(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.CompressionFilterFactory=Co.CompressionFilter=void 0;var rd=Ee("zlib"),IE=vg(),id=we(),gF=bg(),yF=je(),vF=n=>typeof n=="number"&&typeof IE.CompressionAlgorithms[n]=="string",So=class{writeMessage(e,t){return C(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return C(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Ji=class extends So{compressMessage(e){return C(this,null,function*(){return e})}writeMessage(e,t){return C(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},Sg=class extends So{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{rd.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=rd.createInflate();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:id.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},Cg=class extends So{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{rd.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,s=[],o=rd.createGunzip();o.on("data",a=>{s.push(a),i+=a.byteLength,this.maxRecvMessageLength!==-1&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:id.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(s))}),o.write(e),o.end()})}},wg=class extends So{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function AE(n,e){switch(n){case"identity":return new Ji;case"deflate":return new Sg(e);case"gzip":return new Cg(e);default:return new wg(n)}}var sd=class extends gF.BaseFilter{constructor(e,t){var r,i;super(),this.sharedFilterConfig=t,this.sendCompression=new Ji,this.receiveCompression=new Ji,this.currentCompressionAlgorithm="identity";let s=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=(r=e["grpc.max_receive_message_length"])!==null&&r!==void 0?r:id.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,s!==void 0)if(vF(s)){let o=IE.CompressionAlgorithms[s],a=(i=t.serverSupportedEncodingHeader)===null||i===void 0?void 0:i.split(",");(!a||a.includes(o))&&(this.currentCompressionAlgorithm=o,this.sendCompression=AE(this.currentCompressionAlgorithm,-1))}else yF.log(id.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${s}`)}sendMetadata(e){return C(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=AE(i,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Ji,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return C(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Ji?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return C(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Co.CompressionFilter=sd;var Eg=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new sd(this.options,this.sharedFilterConfig)}};Co.CompressionFilterFactory=Eg});var od=R(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.deadlineToString=er.getRelativeTimeout=er.getDeadlineTimeoutString=er.minDeadline=void 0;function _F(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}er.minDeadline=_F;var bF=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function SF(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of bF){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}er.getDeadlineTimeoutString=SF;var CF=2147483647;function wF(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>CF?1/0:r}er.getRelativeTimeout=wF;function EF(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}er.deadlineToString=EF});var ld=R(ad=>{"use strict";Object.defineProperty(ad,"__esModule",{value:!0});ad.restrictControlPlaneStatusCode=void 0;var tr=we(),TF=[tr.Status.OK,tr.Status.INVALID_ARGUMENT,tr.Status.NOT_FOUND,tr.Status.ALREADY_EXISTS,tr.Status.FAILED_PRECONDITION,tr.Status.ABORTED,tr.Status.OUT_OF_RANGE,tr.Status.DATA_LOSS];function AF(n,e){return TF.includes(n)?{code:tr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${tr.Status[n]} ${e}`}:{code:n,details:e}}ad.restrictControlPlaneStatusCode=AF});var kE=R(dd=>{"use strict";Object.defineProperty(dd,"__esModule",{value:!0});dd.LoadBalancingCall=void 0;var RE=fn(),cd=we(),IF=od(),ud=jt(),dl=Hr(),DF=en(),RF=je(),Tg=ld(),kF=Ee("http2"),xF="load_balancing_call",Ag=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let f=(c=(l=(0,DF.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${f}/${d}`}trace(e){RF.trace(cd.LogVerbosity.DEBUG,xF,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+dl.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case dl.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:cd.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new ud.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==RE.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+RE.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,IF.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:f=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(f)},onReceiveMessage:f=>{this.trace("Received message"),this.listener.onReceiveMessage(f)},onReceiveStatus:f=>{this.trace("Received status"),f.rstCode===kF.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(f,"REFUSED"):this.outputStatus(f,"PROCESSED")}})}catch(f){this.trace("Failed to start call on picked subchannel "+i+" with error "+f.message),this.outputStatus({code:cd.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+f.message,metadata:new ud.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,Tg.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:cd.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new ud.Metadata},"PROCESSED")});break;case dl.PickResultType.DROP:let{code:s,details:o}=(0,Tg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case dl.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,Tg.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case dl.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ud.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};dd.LoadBalancingCall=Ag});var ME=R(fd=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});fd.ResolvingCall=void 0;var wo=we(),hd=od(),xE=jt(),MF=je(),NF=ld(),OF="resolving_call",Ig=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&wo.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(wo.Status.CANCELLED,"Cancelled by parent call")}),r.flags&wo.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,hd.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){MF.trace(wo.LogVerbosity.DEBUG,OF,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,hd.deadlineToString)(this.deadline));let e=(0,hd.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(wo.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==wo.Status.OK){let{code:r,details:i}=(0,NF.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new xE.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,hd.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new xE.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};fd.ResolvingCall=Ig});var NE=R(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.RetryingCall=ci.MessageBufferTracker=ci.RetryThrottler=void 0;var pd=we(),PF=jt(),FF=je(),LF="retrying_call",Rg=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ci.RetryThrottler=Rg;var kg=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};ci.MessageBufferTracker=kg;var Dg="grpc-previous-rpc-attempts",xg=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){FF.trace(pd.LogVerbosity.DEBUG,LF,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new PF.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(pd.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===pd.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===pd.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(Dg,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(Dg,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(Dg,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ci.RetryingCall=xg});var gd=R(md=>{"use strict";Object.defineProperty(md,"__esModule",{value:!0});md.BaseSubchannelWrapper=void 0;var Mg=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};md.BaseSubchannelWrapper=Mg});var FE=R(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.InternalChannel=void 0;var VF=nu(),BF=uS(),qF=EE(),OE=Hr(),hl=we(),UF=yg(),zF=DE(),PE=Gn(),Ng=je(),GF=og(),yd=en(),nr=fn(),fl=Yi(),jF=kE(),WF=od(),HF=ME(),Og=ug(),KF=ld(),Pg=NE(),$F=gd(),QF=2147483647,YF=1e3,JF=30*60*1e3,vd=new Map,XF=1<<24,ZF=1<<20,Fg=class extends $F.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Lg=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=nr.ConnectivityState.IDLE,this.currentPicker=new OE.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new fl.ChannelzCallTracker,this.childrenTracker=new fl.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof VF.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let f=(0,yd.parseUri)(e);if(f===null)throw new Error(`Could not parse target name "${e}"`);let v=(0,PE.mapUriDefaultScheme)(f);if(v===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},QF),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new fl.ChannelzTrace,this.channelzRef=(0,fl.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,PE.getDefaultAuthority)(v);let w=(0,GF.mapProxyName)(v,r);this.target=w.target,this.options=Object.assign({},this.options,w.extraOptions),this.subchannelPool=(0,qF.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Pg.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:XF,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:ZF),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:JF,YF);let A={createSubchannel:(P,U)=>{let L=this.subchannelPool.getOrCreateSubchannel(this.target,P,Object.assign({},this.options,U),this.credentials);L.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",L.getChannelzRef());let I=new Fg(L,this);return this.wrappedSubchannels.add(I),I},updateState:(P,U)=>{this.currentPicker=U;let L=this.pickQueue.slice();this.pickQueue=[],L.length>0&&this.callRefTimerUnref();for(let I of L)I.doPick();this.updateState(P)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:P=>{this.channelzEnabled&&this.childrenTracker.refChild(P)},removeChannelzChild:P=>{this.channelzEnabled&&this.childrenTracker.unrefChild(P)}};this.resolvingLoadBalancer=new BF.ResolvingLoadBalancer(this.target,A,r,(P,U)=>{P.retryThrottling?vd.set(this.getTarget(),new Pg.RetryThrottler(P.retryThrottling.maxTokens,P.retryThrottling.tokenRatio,vd.get(this.getTarget()))):vd.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=U,this.currentResolutionError=null,process.nextTick(()=>{let L=this.configSelectionQueue;this.configSelectionQueue=[],L.length>0&&this.callRefTimerUnref();for(let I of L)I.getConfig()})},P=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+P.code+' and details "'+P.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,KF.restrictControlPlaneStatusCode)(P.code,P.details)),{metadata:P.metadata}));let U=this.configSelectionQueue;this.configSelectionQueue=[],U.length>0&&this.callRefTimerUnref();for(let L of U)L.reportResolverError(P)}),this.filterStackFactory=new UF.FilterStackFactory([new zF.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let T=new Error;(0,Ng.trace)(hl.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=T.stack)===null||d===void 0?void 0:d.substring(T.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Ng.trace)(t??hl.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,yd.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Ng.trace)(hl.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,yd.uriToString)(this.target)+" "+nr.ConnectivityState[this.connectivityState]+" -> "+nr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+nr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==nr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(nr.ConnectivityState.IDLE),this.currentPicker=new OE.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==nr.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===hl.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,Og.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new jF.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,Og.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Pg.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,vd.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,Og.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,WF.deadlineToString)(t));let a={deadline:t,flags:s??hl.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new HF.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(nr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,fl.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,yd.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===nr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===nr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};_d.InternalChannel=Lg});var zp=R(bd=>{"use strict";Object.defineProperty(bd,"__esModule",{value:!0});bd.ChannelImplementation=void 0;var eL=nu(),tL=FE(),Vg=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof eL.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new tL.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};bd.ChannelImplementation=Vg});var WE=R(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.Http2ServerCallStream=bn.ServerDuplexStreamImpl=bn.ServerWritableStreamImpl=bn.ServerReadableStreamImpl=bn.ServerUnaryCallImpl=void 0;var zE=Ee("events"),Eo=Ee("http2"),Ug=Ee("stream"),LE=Ee("zlib"),Ne=we(),zg=jt(),nL=lg(),GE=je(),ml=Yc(),jE="server_call";function pl(n){GE.trace(Ne.LogVerbosity.DEBUG,jE,n)}var rL="grpc-accept-encoding",iL="grpc-encoding",VE="grpc-message",BE="grpc-status",qE="grpc-timeout",sL=/(\d{1,8})\s*([HMSmun])/,oL={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},aL={[rL]:"identity,deflate,gzip",[iL]:"identity"},UE={[Eo.constants.HTTP2_HEADER_STATUS]:Eo.constants.HTTP_STATUS_OK,[Eo.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},lL={waitForTrailers:!0},Bg=class extends zE.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};bn.ServerUnaryCallImpl=Bg;var Sd=class extends Ug.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};bn.ServerReadableStreamImpl=Sd;var gl=class extends Ug.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new zg.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,ml.getErrorMessage)(i),code:Ne.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Ne.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};bn.ServerWritableStreamImpl=gl;var To=class extends Ug.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new zg.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};bn.ServerDuplexStreamImpl=To;To.prototype._read=Sd.prototype._read;To.prototype._write=gl.prototype._write;To.prototype._final=gl.prototype._final;var qg=class extends zE.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Ne.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Ne.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;pl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Ne.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if(t==="identity")return r;if(t==="deflate"||t==="gzip"){let i;return t==="deflate"?i=LE.createInflate():i=LE.createGunzip(),new Promise((s,o)=>{let a=0,l=[];i.on("data",c=>{l.push(c),a+=c.byteLength,this.maxReceiveMessageSize!==-1&&a>this.maxReceiveMessageSize&&(i.destroy(),o({code:Ne.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),i.on("end",()=>{s(Buffer.concat(l))}),i.write(r),i.end()})}else return Promise.reject({code:Ne.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},UE),aL),t);this.stream.respond(r,lL)}receiveMetadata(e){let t=zg.Metadata.fromHttp2Headers(e);GE.isTracerEnabled(jE)&&pl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(qE);if(r.length>0){let i=r[0].toString().match(sL);if(i===null){let a=new Error("Invalid deadline");return a.code=Ne.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*oL[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(cL,s,this),t.remove(qE)}return t.remove(Eo.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Eo.constants.HTTP2_HEADER_TE),t.remove(Eo.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Ne.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Ne.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Ne.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let f=Buffer.concat(a,s),w=f.readUInt8(0)===1?e:"identity",A=o.getDecompressedMessage(f,w);if(Buffer.isBuffer(A)){t(o.deserializeMessageWithInternalError(A));return}A.then(T=>t(o.deserializeMessageWithInternalError(T)),T=>r(T.code?T:{code:Ne.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return C(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,ml.getErrorMessage)(t),code:Ne.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return C(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Ne.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,ml.getErrorMessage)(s),code:Ne.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Ne.Status.OK),!this.checkCancelled())if(pl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Ne.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[BE]:e.code,[VE]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[BE]:e.code,[VE]:encodeURI(e.details)},UE),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Ne.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Ne.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new nL.StreamDecoder(this.maxReceiveMessageSize),i=!1,s=!1,o=!1,a=()=>C(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>C(this,null,function*(){let c;try{c=r.write(l)}catch(u){this.sendError({code:Ne.Status.RESOURCE_EXHAUSTED,details:u.message});return}s=!0,this.stream.pause();for(let u of c){this.emit("receiveMessage");let f=u.readUInt8(0)===1?t:"identity",v;try{v=yield this.getDecompressedMessage(u,f)}catch(w){this.sendError(w);return}if(!v)return;yield this.pushOrBufferMessage(e,v)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>C(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return C(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return C(this,null,function*(){if(t===null){pl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}pl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,ml.getErrorCode)(r);(i===null||i<Ne.Status.OK||i>Ne.Status.UNAUTHENTICATED)&&(i=Ne.Status.INTERNAL),e.emit("error",{details:(0,ml.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};bn.Http2ServerCallStream=qg;function cL(n){let e=new Error("Deadline exceeded");e.code=Ne.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Wg=R(Cd=>{"use strict";Object.defineProperty(Cd,"__esModule",{value:!0});Cd.ServerCredentials=void 0;var HE=hp(),yl=class{static createInsecure(){return new Gg}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new jg({ca:e||(0,HE.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:HE.CIPHER_SUITES})}};Cd.ServerCredentials=yl;var Gg=class extends yl{_isSecure(){return!1}_getSettings(){return null}},jg=class extends yl{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var QE=R(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});Td.Server=void 0;var ui=Ee("http2"),Er=we(),Xi=WE(),uL=Wg(),KE=Gn(),wd=je(),Mn=Wn(),dL=en(),Kt=Yi(),Ed=~(1<<31),hL=~(1<<31),fL=2e4,{HTTP2_HEADER_PATH:$E}=ui.constants,pL="server";function mL(){}function Hg(n){return{code:Er.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function gL(n,e){let t=Hg(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Kg=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new Kt.ChannelzTrace,this.callTracker=new Kt.ChannelzCallTracker,this.listenerChildrenTracker=new Kt.ChannelzChildrenTracker,this.sessionChildrenTracker=new Kt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Kt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:Ed,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:Ed,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:hL,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:fL,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Mn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Mn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,f=d.getCipher(),v=d.getCertificate(),w=d.getPeerCertificate();c={cipherSuiteStandardName:(t=f.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:f.standardName?null:f.name,localCertificate:v&&"raw"in v?v.raw:null,remoteCertificate:w&&"raw"in w?w.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){wd.trace(Er.LogVerbosity.DEBUG,pL,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=gL(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof uL.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,dL.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,KE.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(v,w)=>{process.nextTick(()=>r(v,w))},l=()=>{let v;if(t._isSecure()){let w=Object.assign(o,t._getSettings());w.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,v=ui.createSecureServer(w),v.on("secureConnection",A=>{A.on("error",T=>{this.trace("An incoming TLS connection closed with error: "+T.message)})})}else v=ui.createServer(o);return v.setTimeout(0,mL),this._setupHandlers(v),v},c=(v,w,A)=>v.length===0?Promise.resolve({port:w,count:A}):Promise.all(v.map(T=>{this.trace("Attempting to bind "+(0,Mn.subchannelAddressToString)(T));let P;(0,Mn.isTcpSubchannelAddress)(T)?P={host:T.host,port:w}:P=T;let U=l();return new Promise((L,I)=>{let j=J=>{this.trace("Failed to bind "+(0,Mn.subchannelAddressToString)(T)+" with error "+J.message),L(J)};U.once("error",j),U.listen(P,()=>{if(this.shutdown){U.close(),L(new Error("bindAsync failed because server is shutdown"));return}let J=U.address(),b;typeof J=="string"?b={path:J}:b={host:J.address,port:J.port};let g=(0,Kt.registerChannelzSocket)((0,Mn.subchannelAddressToString)(b),()=>({localAddress:b,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(g),this.http2ServerList.push({server:U,channelzRef:g}),this.trace("Successfully bound "+(0,Mn.subchannelAddressToString)(b)),L("port"in b?b.port:w),U.removeListener("error",j)})})})).then(T=>{let P=0;for(let U of T)if(typeof U=="number"&&(P+=1,U!==w))throw new Error("Invalid state: multiple port numbers added from single address");return{port:w,count:P+A}}),u=v=>{if(v.length===0)return Promise.resolve({port:0,count:0});let w=v[0],A=l();return new Promise((T,P)=>{let U=L=>{this.trace("Failed to bind "+(0,Mn.subchannelAddressToString)(w)+" with error "+L.message),T(u(v.slice(1)))};A.once("error",U),A.listen(w,()=>{if(this.shutdown){A.close(),T({port:0,count:0});return}let L=A.address(),I={host:L.address,port:L.port},j=(0,Kt.registerChannelzSocket)((0,Mn.subchannelAddressToString)(I),()=>({localAddress:I,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(j),this.http2ServerList.push({server:A,channelzRef:j}),this.trace("Successfully bound "+(0,Mn.subchannelAddressToString)(I)),T(c(v.slice(1),L.port,1)),A.removeListener("error",U)})})},d={onSuccessfulResolution:(v,w,A)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),v.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let T;(0,Mn.isTcpSubchannelAddress)(v[0])?v[0].port===0?T=u(v):T=c(v,v[0].port,0):T=c(v,1,0),T.then(P=>{if(P.count===0){let U=`No address added out of total ${v.length} resolved`;wd.log(Er.LogVerbosity.ERROR,U),a(new Error(U),0)}else P.count<v.length&&wd.log(Er.LogVerbosity.INFO,`WARNING Only ${P.count} addresses added out of total ${v.length} resolved`),a(null,P.port)},P=>{let U=`No address added out of total ${v.length} resolved`;wd.log(Er.LogVerbosity.ERROR,U),a(new Error(U),0)})},onError:v=>{a(new Error(v.details),0)}};(0,KE.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,Kt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(ui.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,Kt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,Kt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,Kt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[ui.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[ui.constants.HTTP2_HEADER_STATUS]:ui.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Xi.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Er.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[$E],s=this._retrieveHandler(i);if(!s){this._respondWithError(Hg(i),e,r);return}let o=new Xi.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Er.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Er.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[$E],i=this._retrieveHandler(r);if(!i){this._respondWithError(Hg(r),e,null);return}let s=new Xi.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Er.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")yL(e,t,s,o);else if(a==="clientStream")vL(e,t,s,o);else if(a==="serverStream")_L(e,t,s,o);else if(a==="bidi")bL(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,Kt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),f={ref:d,streamTracker:new Kt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,f);let v=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+v),this.sessionChildrenTracker.refChild(d));let w=null,A=null,T=!1;if(this.maxConnectionAgeMs!==Ed){let U=this.maxConnectionAgeMs/10,L=Math.random()*U*2-U;w=(l=(a=setTimeout(()=>{var I,j;T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+v);try{s.goaway(ui.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==Ed&&(A=(j=(I=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||j===void 0?void 0:j.call(I))},this.maxConnectionAgeMs+L)).unref)===null||l===void 0?void 0:l.call(a)}let P=(u=(c=setInterval(()=>{var U,L;let I=(L=(U=setTimeout(()=>{T=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+v),s.close()},this.keepaliveTimeoutMs)).unref)===null||L===void 0?void 0:L.call(U);try{s.ping((j,J,b)=>{clearTimeout(I)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(T||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+v),this.sessionChildrenTracker.unrefChild(d),(0,Kt.unregisterChannelzRef)(d)),w&&clearTimeout(w),A&&clearTimeout(A),P&&clearTimeout(P),this.sessions.delete(s)})})}};Td.Server=Kg;function yL(n,e,t,r){return C(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Xi.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function vL(n,e,t,r){let i=new Xi.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function _L(n,e,t,r){return C(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Xi.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function bL(n,e,t,r){let i=new Xi.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var YE=R(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});Ad.StatusBuilder=void 0;var $g=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Ad.StatusBuilder=$g});var Qg=R(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.isDuration=di.durationToMs=di.msToDuration=void 0;function SL(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}di.msToDuration=SL;function CL(n){return n.seconds*1e3+n.nanos/1e6|0}di.durationToMs=CL;function wL(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}di.isDuration=wL});var ry=R(hi=>{"use strict";var Yg;Object.defineProperty(hi,"__esModule",{value:!0});hi.setup=hi.OutlierDetectionLoadBalancer=hi.OutlierDetectionLoadBalancingConfig=void 0;var Dd=fn(),XE=we(),Zi=Qg(),ZE=iy(),eT=zr(),EL=cu(),TL=Hr(),JE=Wn(),AL=gd(),IL=je(),DL="outlier_detection";function ft(n){IL.trace(XE.LogVerbosity.DEBUG,DL,n)}var ny="outlier_detection",RL=((Yg=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Yg!==void 0?Yg:"true")==="true",kL={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},xL={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function Ao(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Jg(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,Zi.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Id(n,e,t){let r=t?`${t}.${e}`:e;if(Ao(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var vl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},kL),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},xL),o):null}getLoadBalancerName(){return ny}toJsonObject(){return{interval:(0,Zi.msToDuration)(this.intervalMs),base_ejection_time:(0,Zi.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,Zi.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Jg(e,"interval"),Jg(e,"base_ejection_time"),Jg(e,"max_ejection_time"),Id(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");Ao(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Id(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),Ao(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),Ao(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Id(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Id(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),Ao(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),Ao(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,Zi.durationToMs)(e.interval):null,e.base_ejection_time?(0,Zi.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,Zi.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(eT.validateLoadBalancingConfig))}};hi.OutlierDetectionLoadBalancingConfig=vl;var Zg=class extends AL.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Dd.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Dd.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Dd.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Xg(){return{success:0,failure:0}}var ey=class{constructor(){this.activeBucket=Xg(),this.inactiveBucket=Xg()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Xg()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},ty=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===TL.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===XE.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Rd=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new EL.ChildLoadBalancerHandler((0,ZE.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,JE.subchannelAddressToString)(t)),o=new Zg(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Dd.ConnectivityState.READY?e.updateState(t,new ty(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;ft("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,f]of this.addressMap){let v=f.counter.getLastSuccesses(),w=f.counter.getLastFailures();ft("Stats for "+d+": successes="+v+" failures="+w+" targetRequestVolume="+r),v+w>=r&&(i+=1,s.push(v/(v+w)))}if(ft("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,f)=>d+f)/s.length,a=0;for(let d of s){let f=d-o;a+=f*f}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);ft("stdev="+c+" ejectionThreshold="+u);for(let[d,f]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let v=f.counter.getLastSuccesses(),w=f.counter.getLastFailures();if(v+w<r)continue;let A=v/(v+w);if(ft("Checking candidate "+d+" successRate="+A),A<u){let T=Math.random()*100;ft("Candidate "+d+" randomNumber="+T+" enforcement_percentage="+t.enforcement_percentage),T<t.enforcement_percentage&&(ft("Ejecting candidate "+d),this.eject(f,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;ft("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(ft("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;ft("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(ft("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(ft("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(ft("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof vl))return;let i=new Set;for(let o of e)i.add((0,JE.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(ft("Adding map entry for "+o),this.addressMap.set(o,{counter:new ey,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(ft("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,eT.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){ft("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else ft("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{ft("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return ny}};hi.OutlierDetectionLoadBalancer=Rd;function ML(){RL&&(0,ZE.registerLoadBalancerType)(ny,Rd,vl)}hi.setup=ML});var iy=R(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.OutlierDetectionLoadBalancingConfig=ie.BaseSubchannelWrapper=ie.registerAdminService=ie.FilterStackFactory=ie.BaseFilter=ie.PickResultType=ie.QueuePicker=ie.UnavailablePicker=ie.ChildLoadBalancerHandler=ie.subchannelAddressToString=ie.validateLoadBalancingConfig=ie.getFirstUsableConfig=ie.registerLoadBalancerType=ie.createChildChannelControlHelper=ie.BackoffTimeout=ie.durationToMs=ie.uriToString=ie.createResolver=ie.registerResolver=ie.log=ie.trace=void 0;var tT=je();Object.defineProperty(ie,"trace",{enumerable:!0,get:function(){return tT.trace}});Object.defineProperty(ie,"log",{enumerable:!0,get:function(){return tT.log}});var nT=Gn();Object.defineProperty(ie,"registerResolver",{enumerable:!0,get:function(){return nT.registerResolver}});Object.defineProperty(ie,"createResolver",{enumerable:!0,get:function(){return nT.createResolver}});var NL=en();Object.defineProperty(ie,"uriToString",{enumerable:!0,get:function(){return NL.uriToString}});var OL=Qg();Object.defineProperty(ie,"durationToMs",{enumerable:!0,get:function(){return OL.durationToMs}});var PL=La();Object.defineProperty(ie,"BackoffTimeout",{enumerable:!0,get:function(){return PL.BackoffTimeout}});var kd=zr();Object.defineProperty(ie,"createChildChannelControlHelper",{enumerable:!0,get:function(){return kd.createChildChannelControlHelper}});Object.defineProperty(ie,"registerLoadBalancerType",{enumerable:!0,get:function(){return kd.registerLoadBalancerType}});Object.defineProperty(ie,"getFirstUsableConfig",{enumerable:!0,get:function(){return kd.getFirstUsableConfig}});Object.defineProperty(ie,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return kd.validateLoadBalancingConfig}});var FL=Wn();Object.defineProperty(ie,"subchannelAddressToString",{enumerable:!0,get:function(){return FL.subchannelAddressToString}});var LL=cu();Object.defineProperty(ie,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return LL.ChildLoadBalancerHandler}});var sy=Hr();Object.defineProperty(ie,"UnavailablePicker",{enumerable:!0,get:function(){return sy.UnavailablePicker}});Object.defineProperty(ie,"QueuePicker",{enumerable:!0,get:function(){return sy.QueuePicker}});Object.defineProperty(ie,"PickResultType",{enumerable:!0,get:function(){return sy.PickResultType}});var VL=bg();Object.defineProperty(ie,"BaseFilter",{enumerable:!0,get:function(){return VL.BaseFilter}});var BL=yg();Object.defineProperty(ie,"FilterStackFactory",{enumerable:!0,get:function(){return BL.FilterStackFactory}});var qL=du();Object.defineProperty(ie,"registerAdminService",{enumerable:!0,get:function(){return qL.registerAdminService}});var UL=gd();Object.defineProperty(ie,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return UL.BaseSubchannelWrapper}});var zL=ry();Object.defineProperty(ie,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return zL.OutlierDetectionLoadBalancingConfig}})});var rT=R(xd=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});xd.setup=void 0;var GL=Gn(),oy=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function jL(){(0,GL.registerResolver)("unix",oy)}xd.setup=jL});var lT=R(Od=>{"use strict";Object.defineProperty(Od,"__esModule",{value:!0});Od.setup=void 0;var iT=Ee("net"),Md=we(),ay=jt(),sT=Gn(),oT=en(),WL=je(),HL="ip_resolver";function aT(n){WL.trace(Md.LogVerbosity.DEBUG,HL,n)}var ly="ipv4",cy="ipv6",KL=443,Nd=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,aT("Resolver constructed for target "+(0,oT.uriToString)(e));let s=[];if(!(e.scheme===ly||e.scheme===cy)){this.error={code:Md.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new ay.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,oT.splitHostPort)(a);if(l===null){this.error={code:Md.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new ay.Metadata};return}if(e.scheme===ly&&!(0,iT.isIPv4)(l.host)||e.scheme===cy&&!(0,iT.isIPv6)(l.host)){this.error={code:Md.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new ay.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:KL})}this.addresses=s,aT("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function $L(){(0,sT.registerResolver)(ly,Nd),(0,sT.registerResolver)(cy,Nd)}Od.setup=$L});var dT=R(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.setup=rr.PickFirstLoadBalancer=rr.shuffled=rr.PickFirstLoadBalancingConfig=void 0;var cT=zr(),Tt=fn(),Pd=Hr(),QL=je(),YL=we(),JL="pick_first";function uy(n){QL.trace(YL.LogVerbosity.DEBUG,JL,n)}var _l="pick_first",XL=250,bl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return _l}toJsonObject(){return{[_l]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};rr.PickFirstLoadBalancingConfig=bl;var dy=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Pd.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function uT(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}rr.shuffled=uT;var Fd=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Tt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Tt.ConnectivityState.READY,new dy(this.currentPick)):this.children.length===0?this.updateState(Tt.ConnectivityState.IDLE,new Pd.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Tt.ConnectivityState.TRANSIENT_FAILURE,new Pd.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Tt.ConnectivityState.CONNECTING,new Pd.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Tt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Tt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Tt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Tt.ConnectivityState.IDLE||i===Tt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Tt.ConnectivityState.IDLE&&(uy("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},XL)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(uy("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){uy(Tt.ConnectivityState[this.currentState]+" -> "+Tt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Tt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Tt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof bl&&(t.getShuffleAddressList()&&(e=uT(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Tt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return _l}};rr.PickFirstLoadBalancer=Fd;function ZL(){(0,cT.registerLoadBalancerType)(_l,Fd,bl),(0,cT.registerDefaultLoadBalancerType)(_l)}rr.setup=ZL});var fT=R(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.setup=Io.RoundRobinLoadBalancer=void 0;var e2=zr(),At=fn(),Ld=Hr(),t2=Wn(),n2=je(),r2=we(),i2="round_robin";function hT(n){n2.trace(r2.LogVerbosity.DEBUG,i2,n)}var Vd="round_robin",hy=class n{getLoadBalancerName(){return Vd}constructor(){}toJsonObject(){return{[Vd]:{}}}static createFromJson(e){return new n}},fy=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Ld.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Bd=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=At.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===At.ConnectivityState.TRANSIENT_FAILURE||i===At.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(At.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===At.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(At.ConnectivityState.READY,new fy(e,t))}else this.countSubchannelsWithState(At.ConnectivityState.CONNECTING)>0?this.updateState(At.ConnectivityState.CONNECTING,new Ld.QueuePicker(this)):this.countSubchannelsWithState(At.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(At.ConnectivityState.TRANSIENT_FAILURE,new Ld.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(At.ConnectivityState.IDLE,new Ld.QueuePicker(this))}updateState(e,t){hT(At.ConnectivityState[this.currentState]+" -> "+At.ConnectivityState[e]),e===At.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),hT("Connect to address list "+e.map(r=>(0,t2.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===At.ConnectivityState.IDLE||i===At.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Vd}};Io.RoundRobinLoadBalancer=Bd;function s2(){(0,e2.registerLoadBalancerType)(Vd,Bd,hy)}Io.setup=s2});var yT=R(W=>{"use strict";Object.defineProperty(W,"__esModule",{value:!0});W.experimental=W.addAdminServicesToServer=W.getChannelzHandlers=W.getChannelzServiceDefinition=W.InterceptorConfigurationError=W.InterceptingCall=W.RequesterBuilder=W.ListenerBuilder=W.StatusBuilder=W.getClientChannel=W.ServerCredentials=W.Server=W.setLogVerbosity=W.setLogger=W.load=W.loadObject=W.CallCredentials=W.ChannelCredentials=W.waitForClientReady=W.closeClient=W.Channel=W.makeGenericClientConstructor=W.makeClientConstructor=W.loadPackageDefinition=W.Client=W.compressionAlgorithms=W.propagate=W.connectivityState=W.status=W.logVerbosity=W.Metadata=W.credentials=void 0;var qd=up();Object.defineProperty(W,"CallCredentials",{enumerable:!0,get:function(){return qd.CallCredentials}});var o2=zp();Object.defineProperty(W,"Channel",{enumerable:!0,get:function(){return o2.ChannelImplementation}});var a2=vg();Object.defineProperty(W,"compressionAlgorithms",{enumerable:!0,get:function(){return a2.CompressionAlgorithms}});var l2=fn();Object.defineProperty(W,"connectivityState",{enumerable:!0,get:function(){return l2.ConnectivityState}});var Ud=nu();Object.defineProperty(W,"ChannelCredentials",{enumerable:!0,get:function(){return Ud.ChannelCredentials}});var pT=Up();Object.defineProperty(W,"Client",{enumerable:!0,get:function(){return pT.Client}});var py=we();Object.defineProperty(W,"logVerbosity",{enumerable:!0,get:function(){return py.LogVerbosity}});Object.defineProperty(W,"status",{enumerable:!0,get:function(){return py.Status}});Object.defineProperty(W,"propagate",{enumerable:!0,get:function(){return py.Propagate}});var mT=je(),my=jp();Object.defineProperty(W,"loadPackageDefinition",{enumerable:!0,get:function(){return my.loadPackageDefinition}});Object.defineProperty(W,"makeClientConstructor",{enumerable:!0,get:function(){return my.makeClientConstructor}});Object.defineProperty(W,"makeGenericClientConstructor",{enumerable:!0,get:function(){return my.makeClientConstructor}});var c2=jt();Object.defineProperty(W,"Metadata",{enumerable:!0,get:function(){return c2.Metadata}});var u2=QE();Object.defineProperty(W,"Server",{enumerable:!0,get:function(){return u2.Server}});var d2=Wg();Object.defineProperty(W,"ServerCredentials",{enumerable:!0,get:function(){return d2.ServerCredentials}});var h2=YE();Object.defineProperty(W,"StatusBuilder",{enumerable:!0,get:function(){return h2.StatusBuilder}});W.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:Ud.ChannelCredentials.createInsecure,createSsl:Ud.ChannelCredentials.createSsl,createFromSecureContext:Ud.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:qd.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:qd.CallCredentials.createFromGoogleCredential,createEmpty:qd.CallCredentials.createEmpty};var f2=n=>n.close();W.closeClient=f2;var p2=(n,e,t)=>n.waitForReady(e,t);W.waitForClientReady=p2;var m2=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.loadObject=m2;var g2=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};W.load=g2;var y2=n=>{mT.setLogger(n)};W.setLogger=y2;var v2=n=>{mT.setLoggerVerbosity(n)};W.setLogVerbosity=v2;var _2=n=>pT.Client.prototype.getChannel.call(n);W.getClientChannel=_2;var zd=Vp();Object.defineProperty(W,"ListenerBuilder",{enumerable:!0,get:function(){return zd.ListenerBuilder}});Object.defineProperty(W,"RequesterBuilder",{enumerable:!0,get:function(){return zd.RequesterBuilder}});Object.defineProperty(W,"InterceptingCall",{enumerable:!0,get:function(){return zd.InterceptingCall}});Object.defineProperty(W,"InterceptorConfigurationError",{enumerable:!0,get:function(){return zd.InterceptorConfigurationError}});var gT=Yi();Object.defineProperty(W,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return gT.getChannelzServiceDefinition}});Object.defineProperty(W,"getChannelzHandlers",{enumerable:!0,get:function(){return gT.getChannelzHandlers}});var b2=du();Object.defineProperty(W,"addAdminServicesToServer",{enumerable:!0,get:function(){return b2.addAdminServicesToServer}});var S2=iy();W.experimental=S2;var C2=sg(),w2=rT(),E2=lT(),T2=dT(),A2=fT(),I2=ry(),D2=Yi();C2.setup(),w2.setup(),E2.setup(),T2.setup(),A2.setup(),I2.setup(),D2.setup()});var mb=(()=>{class n{constructor(t,r){this._renderer=t,this._elementRef=r,this.onChange=i=>{},this.onTouched=()=>{}}setProperty(t,r){this._renderer.setProperty(this._elementRef.nativeElement,t,r)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}static{this.\u0275fac=function(r){return new(r||n)(_e(wf),_e(Cf))}}static{this.\u0275dir=pr({type:n})}}return n})(),X1=(()=>{class n extends mb{static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=W0(n)))(i||n)}})()}static{this.\u0275dir=pr({type:n,features:[Vi]})}}return n})(),gb=new $e("");var Z1={provide:gb,useExisting:kc(()=>Ct),multi:!0};function eR(){let n=If()?If().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var tR=new $e(""),Ct=(()=>{class n extends mb{constructor(t,r,i){super(t,r),this._compositionMode=i,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!eR())}writeValue(t){let r=t??"";this.setProperty("value",r)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}static{this.\u0275fac=function(r){return new(r||n)(_e(wf),_e(Cf),_e(tR,8))}}static{this.\u0275dir=pr({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,i){r&1&&Te("input",function(o){return i._handleInput(o.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(o){return i._compositionEnd(o.target.value)})},features:[Mc([Z1]),Vi]})}}return n})();var yb=new $e(""),vb=new $e("");function _b(n){return n!=null}function bb(n){return $0(n)?qn(n):n}function Sb(n){let e={};return n.forEach(t=>{e=t!=null?ne(ne({},e),t):e}),Object.keys(e).length===0?null:e}function Cb(n,e){return e.map(t=>t(n))}function nR(n){return!n.validate}function wb(n){return n.map(e=>nR(e)?e:t=>e.validate(t))}function rR(n){if(!n)return null;let e=n.filter(_b);return e.length==0?null:function(t){return Sb(Cb(t,e))}}function Nf(n){return n!=null?rR(wb(n)):null}function iR(n){if(!n)return null;let e=n.filter(_b);return e.length==0?null:function(t){let r=Cb(t,e).map(bb);return V0(r).pipe(ve(Sb))}}function Of(n){return n!=null?iR(wb(n)):null}function lb(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function sR(n){return n._rawValidators}function oR(n){return n._rawAsyncValidators}function Mf(n){return n?Array.isArray(n)?n:[n]:[]}function Lc(n,e){return Array.isArray(n)?n.includes(e):n===e}function cb(n,e){let t=Mf(e);return Mf(n).forEach(i=>{Lc(t,i)||t.push(i)}),t}function ub(n,e){return Mf(e).filter(t=>!Lc(n,t))}var Vc=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Nf(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Of(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Bs=class extends Vc{get formDirective(){return null}get path(){return null}},Na=class extends Vc{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Bc=class{constructor(e){this._cd=e}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},aR={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},h9=Yt(ne({},aR),{"[class.ng-submitted]":"isSubmitted"}),qt=(()=>{class n extends Bc{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(_e(Na,2))}}static{this.\u0275dir=pr({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,i){r&2&&Ef("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[Vi]})}}return n})(),Ut=(()=>{class n extends Bc{constructor(t){super(t)}static{this.\u0275fac=function(r){return new(r||n)(_e(Bs,10))}}static{this.\u0275dir=pr({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,i){r&2&&Ef("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[Vi]})}}return n})();var Da="VALID",Fc="INVALID",Ls="PENDING",Ra="DISABLED",qs=class{},qc=class extends qs{constructor(e,t){super(),this.value=e,this.source=t}},xa=class extends qs{constructor(e,t){super(),this.pristine=e,this.source=t}},Ma=class extends qs{constructor(e,t){super(),this.touched=e,this.source=t}},Vs=class extends qs{constructor(e,t){super(),this.status=e,this.source=t}};function Eb(n){return(Gc(n)?n.validators:n)||null}function lR(n){return Array.isArray(n)?Nf(n):n||null}function Tb(n,e){return(Gc(e)?e.asyncValidators:n)||null}function cR(n){return Array.isArray(n)?Of(n):n||null}function Gc(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function uR(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Rc(1e3,"");if(!r[t])throw new Rc(1001,"")}function dR(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Rc(1002,"")})}var Uc=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=Ta(()=>this.statusReactive()),this.statusReactive=Ea(void 0),this._pristine=Ta(()=>this.pristineReactive()),this.pristineReactive=Ea(!0),this._touched=Ta(()=>this.touchedReactive()),this.touchedReactive=Ea(!1),this._events=new Ec,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get status(){return Fr(this.statusReactive)}set status(e){Fr(()=>this.statusReactive.set(e))}get valid(){return this.status===Da}get invalid(){return this.status===Fc}get pending(){return this.status==Ls}get disabled(){return this.status===Ra}get enabled(){return this.status!==Ra}get pristine(){return Fr(this.pristineReactive)}set pristine(e){Fr(()=>this.pristineReactive.set(e))}get dirty(){return!this.pristine}get touched(){return Fr(this.touchedReactive)}set touched(e){Fr(()=>this.touchedReactive.set(e))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(cb(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(cb(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ub(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ub(e,this._rawAsyncValidators))}hasValidator(e){return Lc(this._rawValidators,e)}hasAsyncValidator(e){return Lc(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){let t=this.touched===!1;this.touched=!0;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsTouched(Yt(ne({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new Ma(!0,r))}markAllAsTouched(e={}){this.markAsTouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:this}),this._forEachChild(t=>t.markAllAsTouched(e))}markAsUntouched(e={}){let t=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:e.emitEvent,sourceControl:r})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,r),t&&e.emitEvent!==!1&&this._events.next(new Ma(!1,r))}markAsDirty(e={}){let t=this.pristine===!0;this.pristine=!1;let r=e.sourceControl??this;this._parent&&!e.onlySelf&&this._parent.markAsDirty(Yt(ne({},e),{sourceControl:r})),t&&e.emitEvent!==!1&&this._events.next(new xa(!1,r))}markAsPristine(e={}){let t=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=e.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:e.emitEvent})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e,r),t&&e.emitEvent!==!1&&this._events.next(new xa(!0,r))}markAsPending(e={}){this.status=Ls;let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new Vs(this.status,t)),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.markAsPending(Yt(ne({},e),{sourceControl:t}))}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ra,this.errors=null,this._forEachChild(i=>{i.disable(Yt(ne({},e),{onlySelf:!0}))}),this._updateValue();let r=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new qc(this.value,r)),this._events.next(new Vs(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Yt(ne({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Da,this._forEachChild(r=>{r.enable(Yt(ne({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Yt(ne({},e),{skipPristineCheck:t}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e,t){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine({},t),this._parent._updateTouched({},t))}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Da||this.status===Ls)&&this._runAsyncValidator(r,e.emitEvent)}let t=e.sourceControl??this;e.emitEvent!==!1&&(this._events.next(new qc(this.value,t)),this._events.next(new Vs(this.status,t)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(Yt(ne({},e),{sourceControl:t}))}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ra:Da}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e,t){if(this.asyncValidator){this.status=Ls,this._hasOwnPendingAsyncValidator={emitEvent:t!==!1};let r=bb(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:t,shouldHaveEmitted:e})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let e=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,e}return!1}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1,this,t.shouldHaveEmitted)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e,t,r){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),(e||r)&&this._events.next(new Vs(this.status,t)),this._parent&&this._parent._updateControlsErrors(e,t,r)}_initObservables(){this.valueChanges=new wa,this.statusChanges=new wa}_calculateStatus(){return this._allControlsDisabled()?Ra:this.errors?Fc:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ls)?Ls:this._anyControlsHaveStatus(Fc)?Fc:Da}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e,t){let r=!this._anyControlsDirty(),i=this.pristine!==r;this.pristine=r,this._parent&&!e.onlySelf&&this._parent._updatePristine(e,t),i&&this._events.next(new xa(this.pristine,t))}_updateTouched(e={},t){this.touched=this._anyControlsTouched(),this._events.next(new Ma(this.touched,t)),this._parent&&!e.onlySelf&&this._parent._updateTouched(e,t)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Gc(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=lR(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=cR(this._rawAsyncValidators)}},zc=class extends Uc{constructor(e,t,r){super(Eb(t),Tb(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){dR(this,!0,e),Object.keys(e).forEach(r=>{uR(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t,this),this._updateTouched(t,this),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Pf=new $e("CallSetDisabledState",{providedIn:"root",factory:()=>Ff}),Ff="always";function hR(n,e){return[...e.path,n]}function Ab(n,e,t=Ff){Ib(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),pR(n,e),gR(n,e),mR(n,e),fR(n,e)}function db(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function fR(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Ib(n,e){let t=sR(n);e.validator!==null?n.setValidators(lb(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=oR(n);e.asyncValidator!==null?n.setAsyncValidators(lb(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();db(e._rawValidators,i),db(e._rawAsyncValidators,i)}function pR(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Db(n,e)})}function mR(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Db(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Db(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function gR(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function yR(n,e){n==null,Ib(n,e)}function vR(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function _R(n){return Object.getPrototypeOf(n.constructor)===X1}function bR(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function SR(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Ct?t=s:_R(s)?r=s:i=s}),i||r||t||null}var CR={provide:Bs,useExisting:kc(()=>Mt)},ka=Promise.resolve(),Mt=(()=>{class n extends Bs{get submitted(){return Fr(this.submittedReactive)}constructor(t,r,i){super(),this.callSetDisabledState=i,this._submitted=Ta(()=>this.submittedReactive()),this.submittedReactive=Ea(!1),this._directives=new Set,this.ngSubmit=new wa,this.form=new zc({},Nf(t),Of(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){ka.then(()=>{let r=this._findContainer(t.path);t.control=r.registerControl(t.name,t.control),Ab(t.control,t,this.callSetDisabledState),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){ka.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){ka.then(()=>{let r=this._findContainer(t.path),i=new zc({});yR(i,t),r.registerControl(t.name,i),i.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){ka.then(()=>{let r=this._findContainer(t.path);r&&r.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,r){ka.then(()=>{this.form.get(t.path).setValue(r)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submittedReactive.set(!0),bR(this.form,this._directives),this.ngSubmit.emit(t),t?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(t=void 0){this.form.reset(t),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}static{this.\u0275fac=function(r){return new(r||n)(_e(yb,10),_e(vb,10),_e(Pf,8))}}static{this.\u0275dir=pr({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,i){r&1&&Te("submit",function(o){return i.onSubmit(o)})("reset",function(){return i.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Mc([CR]),Vi]})}}return n})();function hb(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function fb(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var wR=class extends Uc{constructor(e=null,t,r){super(Eb(t),Tb(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Gc(t)&&(t.nonNullable||t.initialValueIsDefault)&&(fb(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){hb(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){hb(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){fb(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var ER={provide:Na,useExisting:kc(()=>Nt)},pb=Promise.resolve(),Nt=(()=>{class n extends Na{constructor(t,r,i,s,o,a){super(),this._changeDetectorRef=o,this.callSetDisabledState=a,this.control=new wR,this._registered=!1,this.name="",this.update=new wa,this._parent=t,this._setValidators(r),this._setAsyncValidators(i),this.valueAccessor=SR(this,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){let r=t.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),vR(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Ab(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(t){pb.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){let r=t.isDisabled.currentValue,i=r!==0&&Y0(r);pb.then(()=>{i&&!this.control.disabled?this.control.disable():!i&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?hR(t,this._parent):[t]}static{this.\u0275fac=function(r){return new(r||n)(_e(Bs,9),_e(yb,10),_e(vb,10),_e(gb,10),_e(Q0,8),_e(Pf,8))}}static{this.\u0275dir=pr({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Mc([ER]),Vi,j0]})}}return n})(),zt=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275dir=pr({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return n})();var TR=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Xt({type:n})}static{this.\u0275inj=Jt({})}}return n})();var Rb=(()=>{class n{static withConfig(t){return{ngModule:n,providers:[{provide:Pf,useValue:t.callSetDisabledState??Ff}]}}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Xt({type:n})}static{this.\u0275inj=Jt({imports:[TR]})}}return n})();var AR="firebase",IR="10.14.1";Lr(AR,IR,"app");var Oa=new Tf("ANGULARFIRE2_VERSION");var DR=(n,e)=>{let t=e?[e]:ab(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Ui=class{constructor(){return DR(RR)}},RR="app-check";function Lf(){}var jc=class{zone;delegate;constructor(e,t=L0){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Vf=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Lf,{},Lf,Lf)),t.pipe(z0({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Wc=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new jc(Zone.current)),this.insideAngular=t.run(()=>new jc(Zone.current,Tc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ee(Pr))};static \u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function kR(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Gt(n){return xR(kR())(n)}function xR(n){return function(t){return t=t.lift(new Vf(n.ngZone)),t.pipe(Os(n.outsideAngular),Fi(n.insideAngular))}}var MR="firebase",NR="10.14.1";Zt.registerVersion(MR,NR,"app-compat");var OR=["ngOnDestroy"],Mb=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(OR.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var Hc=class{constructor(e){return e}},Us=new $e("angularfire2.app.options"),zs=new $e("angularfire2.app.name");function Pa(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Zt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Zt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;PR("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Hc(o)}var PR=(n,...e)=>{Af()&&typeof console<"u"&&console[n](...e)},FR={provide:Hc,useFactory:Pa,deps:[Us,Pr,[new G0,zs]]},Nb=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Us,useValue:t},{provide:zs,useValue:r}]}}constructor(t){Zt.registerVersion("angularfire",Oa.full,"core"),Zt.registerVersion("angularfire",Oa.full,"app-compat"),Zt.registerVersion("angular",K0.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ee(Ps))};static \u0275mod=Xt({type:n});static \u0275inj=Jt({providers:[FR]})}return n})();function Kc(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return LR(i,o)||(xb("error",`${e} was already initialized on the ${t} Firebase App with different settings.${VR?" You may need to reload as Firebase is not HMR aware.":""}`),xb("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function LR(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var VR=typeof module<"u"&&!!module.hot,xb=(n,...e)=>{Af()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Ob={production:!1,firebase:{apiKey:"AIzaSyAVzI84vuYu86I_Wn8wyaHVvFp9FeNf44E",authDomain:"my-cv-89f56.firebaseapp.com",projectId:"my-cv-89f56",storageBucket:"my-cv-89f56.firebasestorage.app",messagingSenderId:"381713347725",appId:"1:381713347725:web:5c31d03e91ed104bd49ec4"}};var $c=class{constructor(){this.name="",this.goalLife="",this.photoUrl="",this.email="",this.phoneNumber="",this.location="",this.socialNetwork=""}};var UR=new Map,zR={activated:!1,tokenObservers:[]},GR={initialized:!1,enabled:!1};function En(n){return UR.get(n)||Object.assign({},zR)}function Bb(){return GR}var jR="https://content-firebaseappcheck.googleapis.com/v1";var WR="exchangeDebugToken",Pb={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},z9=24*60*60*1e3;var qf=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return C(this,null,function*(){this.stop();try{this.pending=new Rf,this.pending.promise.catch(t=>{}),yield HR(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new Rf,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function HR(n){return new Promise(e=>{setTimeout(e,n)})}var KR={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Vr=new sb("appCheck","AppCheck",KR);function qb(n){if(!En(n).activated)throw Vr.create("use-before-activation",{appName:n.name})}function Ub(r,i){return C(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let v=yield o.getHeartbeatsHeader();v&&(s["X-Firebase-Client"]=v)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(v){throw Vr.create("fetch-network-error",{originalErrorMessage:v?.message})}if(l.status!==200)throw Vr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(v){throw Vr.create("fetch-parse-error",{originalErrorMessage:v?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Vr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,f=Date.now();return{token:c.token,expireTimeMillis:f+d,issuedAtTimeMillis:f}})}function zb(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${jR}/projects/${t}/apps/${r}:${WR}?key=${i}`,body:{debug_token:e}}}var $R="firebase-app-check-database",QR=1,Uf="firebase-app-check-store";var Qc=null;function YR(){return Qc||(Qc=new Promise((n,e)=>{try{let t=indexedDB.open($R,QR);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Vr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Uf,{keyPath:"compositeKey"})}}}catch(t){e(Vr.create("storage-open",{originalErrorMessage:t?.message}))}}),Qc)}function JR(n,e){return XR(ZR(n),e)}function XR(n,e){return C(this,null,function*(){let r=(yield YR()).transaction(Uf,"readwrite"),s=r.objectStore(Uf).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(Vr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function ZR(n){return`${n.options.appId}-${n.name}`}var zf=new Pc("@firebase/app-check");function Bf(n,e){return Oc()?JR(n,e).catch(t=>{zf.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Gb(){return Bb().enabled}function jb(){return C(this,null,function*(){let n=Bb();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var ek={error:"UNKNOWN_ERROR"};function tk(n){return nb.encodeString(JSON.stringify(n),!1)}function Gf(n,e=!1){return C(this,null,function*(){let t=n.app;qb(t);let r=En(t),i=r.token,s;if(i&&!Fa(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(Fa(l)?i=l:yield Bf(t,void 0))}if(!e&&i&&Fa(i))return{token:i.token};let o=!1;if(Gb()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Ub(zb(t,yield jb()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Bf(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield En(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?zf.warn(l.message):zf.error(l),s=l}let a;return i?s?Fa(i)?a={token:i.token,internalError:s}:a=Lb(s):(a={token:i.token},r.token=i,yield Bf(t,i)):a=Lb(s),o&&sk(t,a),a})}function nk(n){return C(this,null,function*(){let e=n.app;qb(e);let{provider:t}=En(e);if(Gb()){let r=yield jb(),{token:i}=yield Ub(zb(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function rk(n,e,t,r){let{app:i}=n,s=En(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&Fa(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Fb(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Fb(n))}function Wb(n,e){let t=En(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Fb(n){let{app:e}=n,t=En(e),r=t.tokenRefresher;r||(r=ik(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function ik(n){let{app:e}=n;return new qf(()=>C(this,null,function*(){let t=En(e),r;if(t.token?r=yield Gf(n,!0):r=yield Gf(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=En(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Pb.RETRIAL_MIN_WAIT,Pb.RETRIAL_MAX_WAIT)}function sk(n,e){let t=En(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function Fa(n){return n.expireTimeMillis-Date.now()>0}function Lb(n){return{token:tk(ek),error:n}}var jf=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=En(this.app);for(let t of e)Wb(this.app,t.next);return Promise.resolve()}};function ok(n,e){return new jf(n,e)}function ak(n){return{getToken:e=>Gf(n,e),getLimitedUseToken:()=>nk(n),addTokenListener:e=>rk(n,"INTERNAL",e),removeTokenListener:e=>Wb(n.app,e)}}var lk="@firebase/app-check",ck="0.8.8";var uk="app-check",Vb="app-check-internal";function dk(){Ia(new Bi(uk,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return ok(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Vb).initialize()})),Ia(new Bi(Vb,n=>{let e=n.getProvider("app-check").getImmediate();return ak(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Lr(lk,ck)}dk();var hk=["localhost","0.0.0.0","127.0.0.1"],eG=typeof window<"u"&&hk.includes(window.location.hostname);var Wf=new $e("angularfire2.auth.use-emulator"),Hf=new $e("angularfire2.auth.settings"),Kf=new $e("angularfire2.auth.tenant-id"),$f=new $e("angularfire2.auth.langugage-code"),Qf=new $e("angularfire2.auth.use-device-language"),Yf=new $e("angularfire.auth.persistence"),Jf=(n,e,t,r,i,s,o,a)=>Kc(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),Kb=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,f,v){let w=new Ec,A=Or(void 0).pipe(Fi(o.outsideAngular),Li(()=>s.runOutsideAngular(()=>import("./chunk-QKSRMW26.mjs"))),ve(()=>Pa(t,s,r)),ve(T=>Jf(T,s,a,c,u,d,l,f)),bf({bufferSize:1,refCount:!1}));if(Nc(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Or(null);else{A.pipe(U0()).subscribe();let T=A.pipe(Li(L=>L.getRedirectResult().then(I=>I,()=>null)),Gt,bf({bufferSize:1,refCount:!1})),P=A.pipe(Li(L=>new Ns(I=>({unsubscribe:s.runOutsideAngular(()=>L.onAuthStateChanged(j=>I.next(j),j=>I.error(j),()=>I.complete()))})))),U=A.pipe(Li(L=>new Ns(I=>({unsubscribe:s.runOutsideAngular(()=>L.onIdTokenChanged(j=>I.next(j),j=>I.error(j),()=>I.complete()))}))));this.authState=T.pipe(Sf(P),Os(o.outsideAngular),Fi(o.insideAngular)),this.user=T.pipe(Sf(U),Os(o.outsideAngular),Fi(o.insideAngular)),this.idToken=this.user.pipe(Li(L=>L?qn(L.getIdToken()):Or(null))),this.idTokenResult=this.user.pipe(Li(L=>L?qn(L.getIdTokenResult()):Or(null))),this.credential=B0(T,w,this.authState.pipe(Ca(L=>!L))).pipe(ve(L=>L?.user?L:null),Os(o.outsideAngular),Fi(o.insideAngular))}return Mb(this,A,s,{spy:{apply:(T,P,U)=>{(T.startsWith("signIn")||T.startsWith("createUser"))&&U.then(L=>w.next(L))}}})}static \u0275fac=function(r){return new(r||n)(ee(Us),ee(zs,8),ee(Ps),ee(Pr),ee(Wc),ee(Wf,8),ee(Hf,8),ee(Kf,8),ee($f,8),ee(Qf,8),ee(Yf,8),ee(Ui,8))};static \u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();import{inspect as R2,TextEncoder as k2,TextDecoder as x2}from"util";import{randomBytes as M2}from"crypto";var $b=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Qb={};var Br,Xf;(function(){var n;function e(b,g){function y(){}y.prototype=g.prototype,b.D=g.prototype,b.prototype=new y,b.prototype.constructor=b,b.C=function(_,p,S){for(var h=Array(arguments.length-2),m=2;m<arguments.length;m++)h[m-2]=arguments[m];return g.prototype[p].apply(_,h)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(b,g,y){y||(y=0);var _=Array(16);if(typeof g=="string")for(var p=0;16>p;++p)_[p]=g.charCodeAt(y++)|g.charCodeAt(y++)<<8|g.charCodeAt(y++)<<16|g.charCodeAt(y++)<<24;else for(p=0;16>p;++p)_[p]=g[y++]|g[y++]<<8|g[y++]<<16|g[y++]<<24;g=b.g[0],y=b.g[1],p=b.g[2];var S=b.g[3],h=g+(S^y&(p^S))+_[0]+3614090360&4294967295;g=y+(h<<7&4294967295|h>>>25),h=S+(p^g&(y^p))+_[1]+3905402710&4294967295,S=g+(h<<12&4294967295|h>>>20),h=p+(y^S&(g^y))+_[2]+606105819&4294967295,p=S+(h<<17&4294967295|h>>>15),h=y+(g^p&(S^g))+_[3]+3250441966&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(S^y&(p^S))+_[4]+4118548399&4294967295,g=y+(h<<7&4294967295|h>>>25),h=S+(p^g&(y^p))+_[5]+1200080426&4294967295,S=g+(h<<12&4294967295|h>>>20),h=p+(y^S&(g^y))+_[6]+2821735955&4294967295,p=S+(h<<17&4294967295|h>>>15),h=y+(g^p&(S^g))+_[7]+4249261313&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(S^y&(p^S))+_[8]+1770035416&4294967295,g=y+(h<<7&4294967295|h>>>25),h=S+(p^g&(y^p))+_[9]+2336552879&4294967295,S=g+(h<<12&4294967295|h>>>20),h=p+(y^S&(g^y))+_[10]+4294925233&4294967295,p=S+(h<<17&4294967295|h>>>15),h=y+(g^p&(S^g))+_[11]+2304563134&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(S^y&(p^S))+_[12]+1804603682&4294967295,g=y+(h<<7&4294967295|h>>>25),h=S+(p^g&(y^p))+_[13]+4254626195&4294967295,S=g+(h<<12&4294967295|h>>>20),h=p+(y^S&(g^y))+_[14]+2792965006&4294967295,p=S+(h<<17&4294967295|h>>>15),h=y+(g^p&(S^g))+_[15]+1236535329&4294967295,y=p+(h<<22&4294967295|h>>>10),h=g+(p^S&(y^p))+_[1]+4129170786&4294967295,g=y+(h<<5&4294967295|h>>>27),h=S+(y^p&(g^y))+_[6]+3225465664&4294967295,S=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(S^g))+_[11]+643717713&4294967295,p=S+(h<<14&4294967295|h>>>18),h=y+(S^g&(p^S))+_[0]+3921069994&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^S&(y^p))+_[5]+3593408605&4294967295,g=y+(h<<5&4294967295|h>>>27),h=S+(y^p&(g^y))+_[10]+38016083&4294967295,S=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(S^g))+_[15]+3634488961&4294967295,p=S+(h<<14&4294967295|h>>>18),h=y+(S^g&(p^S))+_[4]+3889429448&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^S&(y^p))+_[9]+568446438&4294967295,g=y+(h<<5&4294967295|h>>>27),h=S+(y^p&(g^y))+_[14]+3275163606&4294967295,S=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(S^g))+_[3]+4107603335&4294967295,p=S+(h<<14&4294967295|h>>>18),h=y+(S^g&(p^S))+_[8]+1163531501&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(p^S&(y^p))+_[13]+2850285829&4294967295,g=y+(h<<5&4294967295|h>>>27),h=S+(y^p&(g^y))+_[2]+4243563512&4294967295,S=g+(h<<9&4294967295|h>>>23),h=p+(g^y&(S^g))+_[7]+1735328473&4294967295,p=S+(h<<14&4294967295|h>>>18),h=y+(S^g&(p^S))+_[12]+2368359562&4294967295,y=p+(h<<20&4294967295|h>>>12),h=g+(y^p^S)+_[5]+4294588738&4294967295,g=y+(h<<4&4294967295|h>>>28),h=S+(g^y^p)+_[8]+2272392833&4294967295,S=g+(h<<11&4294967295|h>>>21),h=p+(S^g^y)+_[11]+1839030562&4294967295,p=S+(h<<16&4294967295|h>>>16),h=y+(p^S^g)+_[14]+4259657740&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^S)+_[1]+2763975236&4294967295,g=y+(h<<4&4294967295|h>>>28),h=S+(g^y^p)+_[4]+1272893353&4294967295,S=g+(h<<11&4294967295|h>>>21),h=p+(S^g^y)+_[7]+4139469664&4294967295,p=S+(h<<16&4294967295|h>>>16),h=y+(p^S^g)+_[10]+3200236656&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^S)+_[13]+681279174&4294967295,g=y+(h<<4&4294967295|h>>>28),h=S+(g^y^p)+_[0]+3936430074&4294967295,S=g+(h<<11&4294967295|h>>>21),h=p+(S^g^y)+_[3]+3572445317&4294967295,p=S+(h<<16&4294967295|h>>>16),h=y+(p^S^g)+_[6]+76029189&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(y^p^S)+_[9]+3654602809&4294967295,g=y+(h<<4&4294967295|h>>>28),h=S+(g^y^p)+_[12]+3873151461&4294967295,S=g+(h<<11&4294967295|h>>>21),h=p+(S^g^y)+_[15]+530742520&4294967295,p=S+(h<<16&4294967295|h>>>16),h=y+(p^S^g)+_[2]+3299628645&4294967295,y=p+(h<<23&4294967295|h>>>9),h=g+(p^(y|~S))+_[0]+4096336452&4294967295,g=y+(h<<6&4294967295|h>>>26),h=S+(y^(g|~p))+_[7]+1126891415&4294967295,S=g+(h<<10&4294967295|h>>>22),h=p+(g^(S|~y))+_[14]+2878612391&4294967295,p=S+(h<<15&4294967295|h>>>17),h=y+(S^(p|~g))+_[5]+4237533241&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~S))+_[12]+1700485571&4294967295,g=y+(h<<6&4294967295|h>>>26),h=S+(y^(g|~p))+_[3]+2399980690&4294967295,S=g+(h<<10&4294967295|h>>>22),h=p+(g^(S|~y))+_[10]+4293915773&4294967295,p=S+(h<<15&4294967295|h>>>17),h=y+(S^(p|~g))+_[1]+2240044497&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~S))+_[8]+1873313359&4294967295,g=y+(h<<6&4294967295|h>>>26),h=S+(y^(g|~p))+_[15]+4264355552&4294967295,S=g+(h<<10&4294967295|h>>>22),h=p+(g^(S|~y))+_[6]+2734768916&4294967295,p=S+(h<<15&4294967295|h>>>17),h=y+(S^(p|~g))+_[13]+1309151649&4294967295,y=p+(h<<21&4294967295|h>>>11),h=g+(p^(y|~S))+_[4]+4149444226&4294967295,g=y+(h<<6&4294967295|h>>>26),h=S+(y^(g|~p))+_[11]+3174756917&4294967295,S=g+(h<<10&4294967295|h>>>22),h=p+(g^(S|~y))+_[2]+718787259&4294967295,p=S+(h<<15&4294967295|h>>>17),h=y+(S^(p|~g))+_[9]+3951481745&4294967295,b.g[0]=b.g[0]+g&4294967295,b.g[1]=b.g[1]+(p+(h<<21&4294967295|h>>>11))&4294967295,b.g[2]=b.g[2]+p&4294967295,b.g[3]=b.g[3]+S&4294967295}r.prototype.u=function(b,g){g===void 0&&(g=b.length);for(var y=g-this.blockSize,_=this.B,p=this.h,S=0;S<g;){if(p==0)for(;S<=y;)i(this,b,S),S+=this.blockSize;if(typeof b=="string"){for(;S<g;)if(_[p++]=b.charCodeAt(S++),p==this.blockSize){i(this,_),p=0;break}}else for(;S<g;)if(_[p++]=b[S++],p==this.blockSize){i(this,_),p=0;break}}this.h=p,this.o+=g},r.prototype.v=function(){var b=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);b[0]=128;for(var g=1;g<b.length-8;++g)b[g]=0;var y=8*this.o;for(g=b.length-8;g<b.length;++g)b[g]=y&255,y/=256;for(this.u(b),b=Array(16),g=y=0;4>g;++g)for(var _=0;32>_;_+=8)b[y++]=this.g[g]>>>_&255;return b};function s(b,g){var y=a;return Object.prototype.hasOwnProperty.call(y,b)?y[b]:y[b]=g(b)}function o(b,g){this.h=g;for(var y=[],_=!0,p=b.length-1;0<=p;p--){var S=b[p]|0;_&&S==g||(y[p]=S,_=!1)}this.g=y}var a={};function l(b){return-128<=b&&128>b?s(b,function(g){return new o([g|0],0>g?-1:0)}):new o([b|0],0>b?-1:0)}function c(b){if(isNaN(b)||!isFinite(b))return d;if(0>b)return T(c(-b));for(var g=[],y=1,_=0;b>=y;_++)g[_]=b/y|0,y*=4294967296;return new o(g,0)}function u(b,g){if(b.length==0)throw Error("number format error: empty string");if(g=g||10,2>g||36<g)throw Error("radix out of range: "+g);if(b.charAt(0)=="-")return T(u(b.substring(1),g));if(0<=b.indexOf("-"))throw Error('number format error: interior "-" character');for(var y=c(Math.pow(g,8)),_=d,p=0;p<b.length;p+=8){var S=Math.min(8,b.length-p),h=parseInt(b.substring(p,p+S),g);8>S?(S=c(Math.pow(g,S)),_=_.j(S).add(c(h))):(_=_.j(y),_=_.add(c(h)))}return _}var d=l(0),f=l(1),v=l(16777216);n=o.prototype,n.m=function(){if(A(this))return-T(this).m();for(var b=0,g=1,y=0;y<this.g.length;y++){var _=this.i(y);b+=(0<=_?_:4294967296+_)*g,g*=4294967296}return b},n.toString=function(b){if(b=b||10,2>b||36<b)throw Error("radix out of range: "+b);if(w(this))return"0";if(A(this))return"-"+T(this).toString(b);for(var g=c(Math.pow(b,6)),y=this,_="";;){var p=I(y,g).g;y=P(y,p.j(g));var S=((0<y.g.length?y.g[0]:y.h)>>>0).toString(b);if(y=p,w(y))return S+_;for(;6>S.length;)S="0"+S;_=S+_}},n.i=function(b){return 0>b?0:b<this.g.length?this.g[b]:this.h};function w(b){if(b.h!=0)return!1;for(var g=0;g<b.g.length;g++)if(b.g[g]!=0)return!1;return!0}function A(b){return b.h==-1}n.l=function(b){return b=P(this,b),A(b)?-1:w(b)?0:1};function T(b){for(var g=b.g.length,y=[],_=0;_<g;_++)y[_]=~b.g[_];return new o(y,~b.h).add(f)}n.abs=function(){return A(this)?T(this):this},n.add=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0,p=0;p<=g;p++){var S=_+(this.i(p)&65535)+(b.i(p)&65535),h=(S>>>16)+(this.i(p)>>>16)+(b.i(p)>>>16);_=h>>>16,S&=65535,h&=65535,y[p]=h<<16|S}return new o(y,y[y.length-1]&-2147483648?-1:0)};function P(b,g){return b.add(T(g))}n.j=function(b){if(w(this)||w(b))return d;if(A(this))return A(b)?T(this).j(T(b)):T(T(this).j(b));if(A(b))return T(this.j(T(b)));if(0>this.l(v)&&0>b.l(v))return c(this.m()*b.m());for(var g=this.g.length+b.g.length,y=[],_=0;_<2*g;_++)y[_]=0;for(_=0;_<this.g.length;_++)for(var p=0;p<b.g.length;p++){var S=this.i(_)>>>16,h=this.i(_)&65535,m=b.i(p)>>>16,F=b.i(p)&65535;y[2*_+2*p]+=h*F,U(y,2*_+2*p),y[2*_+2*p+1]+=S*F,U(y,2*_+2*p+1),y[2*_+2*p+1]+=h*m,U(y,2*_+2*p+1),y[2*_+2*p+2]+=S*m,U(y,2*_+2*p+2)}for(_=0;_<g;_++)y[_]=y[2*_+1]<<16|y[2*_];for(_=g;_<2*g;_++)y[_]=0;return new o(y,0)};function U(b,g){for(;(b[g]&65535)!=b[g];)b[g+1]+=b[g]>>>16,b[g]&=65535,g++}function L(b,g){this.g=b,this.h=g}function I(b,g){if(w(g))throw Error("division by zero");if(w(b))return new L(d,d);if(A(b))return g=I(T(b),g),new L(T(g.g),T(g.h));if(A(g))return g=I(b,T(g)),new L(T(g.g),g.h);if(30<b.g.length){if(A(b)||A(g))throw Error("slowDivide_ only works with positive integers.");for(var y=f,_=g;0>=_.l(b);)y=j(y),_=j(_);var p=J(y,1),S=J(_,1);for(_=J(_,2),y=J(y,2);!w(_);){var h=S.add(_);0>=h.l(b)&&(p=p.add(y),S=h),_=J(_,1),y=J(y,1)}return g=P(b,p.j(g)),new L(p,g)}for(p=d;0<=b.l(g);){for(y=Math.max(1,Math.floor(b.m()/g.m())),_=Math.ceil(Math.log(y)/Math.LN2),_=48>=_?1:Math.pow(2,_-48),S=c(y),h=S.j(g);A(h)||0<h.l(b);)y-=_,S=c(y),h=S.j(g);w(S)&&(S=f),p=p.add(S),b=P(b,h)}return new L(p,b)}n.A=function(b){return I(this,b).h},n.and=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)&b.i(_);return new o(y,this.h&b.h)},n.or=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)|b.i(_);return new o(y,this.h|b.h)},n.xor=function(b){for(var g=Math.max(this.g.length,b.g.length),y=[],_=0;_<g;_++)y[_]=this.i(_)^b.i(_);return new o(y,this.h^b.h)};function j(b){for(var g=b.g.length+1,y=[],_=0;_<g;_++)y[_]=b.i(_)<<1|b.i(_-1)>>>31;return new o(y,b.h)}function J(b,g){var y=g>>5;g%=32;for(var _=b.g.length-y,p=[],S=0;S<_;S++)p[S]=0<g?b.i(S+y)>>>g|b.i(S+y+1)<<32-g:b.i(S+y);return new o(p,b.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Xf=Qb.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,Br=Qb.Integer=o}).apply(typeof $b<"u"?$b:typeof self<"u"?self:typeof window<"u"?window:{});var cs=F0(yT(),1),RA=F0(Hm(),1);var vT="@firebase/firestore",_T="4.7.3";var st=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};st.UNAUTHENTICATED=new st(null);st.GOOGLE_CREDENTIALS=new st("google-credentials-uid");st.FIRST_PARTY=new st("first-party-uid");st.MOCK_USER=new st("mock-user");var N2="10.14.0";var la=N2;function O2(n){la=n}function P2(n){return R2(n,{depth:100})}var bi=new Pc("@firebase/firestore");function Po(){return bi.logLevel}function kA(n){bi.setLogLevel(n)}function O(n,...e){if(bi.logLevel<=zn.DEBUG){let t=e.map(I_);bi.debug(`Firestore (${la}): ${n}`,...t)}}function Be(n,...e){if(bi.logLevel<=zn.ERROR){let t=e.map(I_);bi.error(`Firestore (${la}): ${n}`,...t)}}function On(n,...e){if(bi.logLevel<=zn.WARN){let t=e.map(I_);bi.warn(`Firestore (${la}): ${n}`,...t)}}function I_(n){if(typeof n=="string")return n;try{return P2(n)}catch{return n}}function G(n="Unexpected state"){let e=`FIRESTORE (${la}) INTERNAL ASSERTION FAILED: `+n;throw Be(e),new Error(e)}function $(n,e){n||G()}function xA(n,e){n||G()}function q(n,e){return n}var D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},M=class extends ib{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var rt=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Xd=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Iy=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(st.UNAUTHENTICATED))}shutdown(){}},Dy=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Ry=class{constructor(e){this.authProvider=e,this.currentUser=st.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){$(this.tokenListener===void 0);let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new rt;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new rt,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>C(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{O("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),o())};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(O("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new rt)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(O("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($(typeof r.accessToken=="string"),new Xd(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return $(e===null||typeof e=="string"),new st(e)}},ky=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=st.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},xy=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new ky(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(st.FIRST_PARTY))}shutdown(){}invalidateToken(){}},My=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Ny=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){$(this.tokenListener===void 0);let r=s=>{s.error!=null&&O("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,O("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{O("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):O("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?($(typeof t.token=="string"),this.latestAppCheckToken=t.token,new My(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}};function F2(n){if(!n)return new Iy;switch(n.type){case"firstParty":return new xy(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new M(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function L2(n){return M2(n)}var Zd=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=L2(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function se(n,e){return n<e?-1:n>e?1:0}function us(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function MA(n){return n+"\0"}var bT=-62135596800,ST=1e6,qe=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new M(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new M(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<bT)throw new M(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new M(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*ST);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/ST}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-bT,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var Y=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new qe(0,0))}static max(){return new n(new qe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var CT="__name__",eh=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&G(),r===void 0?r=e.length-t:r>e.length-t&&G(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},fe=class n extends eh{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new M(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},V2=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Xe=class n extends eh{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return V2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===CT}static keyField(){return new n([CT])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new M(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new M(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new M(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new M(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var B=class n{constructor(e){this.path=e}static fromPath(e){return new n(fe.fromString(e))}static fromName(e){return new n(fe.fromString(e).popFirst(5))}static empty(){return new n(fe.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&fe.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return fe.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new fe(e.slice()))}};var jo=-1,B2=0,Oy=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function D_(n){return n.fields.find(e=>e.kind===2)}function ds(n){return n.fields.filter(e=>e.kind!==2)}function q2(n){let e=ds(n);return e.length===0?0:e[e.length-1].kind}function U2(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Uo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Nl=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(B2,Cn.min())}};function NA(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=Y.fromTimestamp(r===1e9?new qe(t+1,0):new qe(t,r));return new Cn(i,B.empty(),e)}function OA(n){return new Cn(n.readTime,n.key,jo)}var Cn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(Y.min(),B.empty(),jo)}static max(){return new n(Y.max(),B.empty(),jo)}};function R_(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=B.comparator(n.documentKey,e.documentKey),t!==0)?t:se(n.largestBatchId,e.largestBatchId)}var PA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",th=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function xi(n){return C(this,null,function*(){if(n.code===D.FAILED_PRECONDITION&&n.message===PA)O("LocalStore","Unexpectedly lost primary lease");else throw n})}var E=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var sn="SimpleDb",z2=3,nh=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new rt,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new ls(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=k_(r.target.error);this.completionDeferred.reject(new ls(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new ls(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(O(sn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new Fy(t)}},Si=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(Aa())===12.2&&Be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return O(sn,"Removing database:",e),ts(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Oc())return!1;if(n.isMockPersistence())return!0;let e=Aa(),t=n.getIOSVersion(e),r=0<t&&t<10,i=FA(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return C(this,null,function*(){return this.db||(O(sn,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new ls(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new M(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new M(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new ls(e,o))},i.onupgradeneeded=s=>{O(sn,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{O(sn,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return C(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=nh.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),E.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<z2;if(O(sn,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function FA(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var Py=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ts(this.dbCursor.delete())}},ls=class extends M{constructor(e,t){super(D.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Mi(n){return n.name==="IndexedDbTransactionError"}var Fy=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(O(sn,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(O(sn,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ts(r)}add(e){O(sn,"ADD",this.store.name,e,e);let t=this.store.add(e);return ts(t)}get(e){let t=this.store.get(e);return ts(t).next(r=>(r===void 0&&(r=null),O(sn,"GET",this.store.name,e,r),r))}delete(e){O(sn,"DELETE",this.store.name,e);let t=this.store.delete(e);return ts(t)}count(){O(sn,"COUNT",this.store.name);let e=this.store.count();return ts(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new E((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new E((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){O(sn,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new E((r,i)=>{t.onerror=s=>{let o=k_(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new E((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new Py(a),c=t(a.primaryKey,a.value,l);if(c instanceof E){let u=c.catch(d=>(l.done(),E.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>E.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function ts(n){return new E((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=k_(r.target.error);t(i)}})}var wT=!1;function k_(n){let e=Si.getIOSVersion(Aa());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new M("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return wT||(wT=!0,setTimeout(()=>{throw r},0)),r}}return n}var Il="IndexBackfiller",G2=15*1e3,j2=60*1e3,W2=50,Ly=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(G2)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){O(Il,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>C(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();O(Il,`Documents written: ${t}`)}catch(t){Mi(t)?O(Il,"Ignoring IndexedDB error during index backfill: ",t):yield xi(t)}yield this.schedule(j2)}))}},Vy=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return C(this,arguments,function*(e=W2){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return E.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return O(Il,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(O(Il,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=OA(s);R_(o,r)>0&&(r=o)}),new Cn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var on=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),zo="",By="",LA="",VA="";function Lt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=ET(e)),e=H2(n.get(t),e);return ET(e)}function H2(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=zo+LA;break;case zo:t+=zo+VA;break;default:t+=s}}return t}function ET(n){return n+zo+By}function sr(n){let e=n.length;if($(e>=2),e===2)return $(n.charAt(0)===zo&&n.charAt(1)===By),fe.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(zo,s);switch((o<0||o>t)&&G(),n.charAt(o+1)){case By:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case LA:i+=n.substring(s,o),i+="\0";break;case VA:i+=n.substring(s,o+1);break;default:G()}s=o+2}return new fe(r)}var ns="remoteDocuments";var rc="owner",Do="owner",ic="mutationQueues",K2="userId",Nn="mutations",BA="batchId",os="userMutationsIndex",qA=["userId","batchId"];function $2(n){return[n]}function Kd(n,e){return[n,Lt(e)]}function UA(n,e,t){return[n,Lt(e),t]}var Q2={},ca="documentMutations",Wh="remoteDocumentsV14",Y2=["prefixPath","collectionGroup","readTime","documentId"],$d="documentKeyIndex",J2=["prefixPath","collectionGroup","documentId"],zA="collectionGroupIndex",X2=["collectionGroup","readTime","prefixPath","documentId"],sc="remoteDocumentGlobal",qy="remoteDocumentGlobalKey",ua="targets",Z2="targetId",GA="queryTargetsIndex",eV=["canonicalId","targetId"],da="targetDocuments",tV=["targetId","path"],x_="documentTargetsIndex",nV=["path","targetId"],rh="targetGlobalKey",Es="targetGlobal",Ol="collectionParents",rV=["collectionId","parent"],Wo="clientMetadata",iV="clientId",Hh="bundles",sV="bundleId",Kh="namedQueries",oV="name",M_="indexConfiguration",aV="indexId",Uy="collectionGroupIndex",lV="collectionGroup",$h="indexState",cV=["indexId","uid"],jA="sequenceNumberIndex",uV=["uid","sequenceNumber"],Qh="indexEntries",dV=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],WA="documentKeyIndex",hV=["indexId","uid","orderedDocumentKey"],Yh="documentOverlays",fV=["userId","collectionPath","documentId"],zy="collectionPathOverlayIndex",pV=["userId","collectionPath","largestBatchId"],HA="collectionGroupOverlayIndex",mV=["userId","collectionGroup","largestBatchId"],N_="globals",gV="name",yV=[ic,Nn,ca,ns,ua,rc,Es,da],vV=yV,_V=[...vV,Wo],bV=[..._V,sc],SV=[...bV,Ol],KA=[...SV,Hh,Kh],CV=[...KA,Yh],$A=[ic,Nn,ca,Wh,ua,rc,Es,da,Wo,sc,Ol,Hh,Kh,Yh],QA=$A,O_=[...QA,M_,$h,Qh],wV=O_,EV=[...O_,N_];function TV(n){if(n===17)return EV;if(n===16)return wV;if(n===15)return O_;if(n===14)return QA;if(n===13)return $A;if(n===12)return CV;if(n===11)return KA;G()}var Pl=class extends th{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function at(n,e){let t=q(n);return Si.getStore(t.simpleDbTransaction,e)}function TT(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ts(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function YA(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Oe=class n{constructor(e,t){this.comparator=e,this.root=t||Dl.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Dl.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Dl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bo(this.root,e,this.comparator,!0)}},Bo=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Dl=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw G();let t=this.left.check();if(t!==this.right.check())throw G();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),Gy=class{constructor(){this.size=0}get key(){throw G()}get value(){throw G()}get color(){throw G()}get left(){throw G()}get right(){throw G()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Dl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Dl.EMPTY=new Gy;var ke=class n{constructor(e){this.comparator=e,this.data=new Oe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ih(this.data.getIterator())}getIteratorFrom(e){return new ih(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ih=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function AV(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=Ro(s),l=Ro(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=Ro(o)):u?(i(a),a=Ro(s)):(a=Ro(s),l=Ro(o))}}function Ro(n){return n.hasNext()?n.getNext():void 0}var an=class n{constructor(e){this.fields=e,e.sort(Xe.comparator)}static empty(){return new n([])}unionWith(e){let t=new ke(Xe.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return us(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function IV(n){return Buffer.from(n,"base64").toString("binary")}function DV(n){return Buffer.from(n,"binary").toString("base64")}function JA(){return!0}var Ze=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=IV(e);return new n(t)}static fromUint8Array(e){let t=RV(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return DV(this.binaryString)}toUint8Array(){return kV(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Ze.EMPTY_BYTE_STRING=new Ze("");function RV(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function kV(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var xV=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ar(n){if($(!!n),typeof n=="string"){let e=0,t=xV.exec(n);if($(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Le(n.seconds),t=Le(n.nanos);return{seconds:e,nanos:t}}}function Le(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ci(n){return typeof n=="string"?Ze.fromBase64String(n):Ze.fromUint8Array(n)}var XA="server_timestamp",ZA="__type__",eI="__previous_value__",tI="__local_write_time__";function Jh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[ZA])===null||t===void 0?void 0:t.stringValue)===XA}function MV(n,e){let t={fields:{[ZA]:{stringValue:XA},[tI]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Jh(e)&&(e=P_(e)),e&&(t.fields[eI]=e),{mapValue:t}}function P_(n){let e=n.mapValue.fields[eI];return Jh(e)?P_(e):e}function Fl(n){let e=Ar(n.mapValue.fields[tI].timestampValue);return new qe(e.seconds,e.nanos)}var jy=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},AT="(default)",wi=class n{constructor(e,t){this.projectId=e,this.database=t||AT}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===AT}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function NV(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new M(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wi(n.options.projectId,e)}var _i=-1;function oc(n){return n==null}function Ll(n){return n===0&&1/n===-1/0}function nI(n){return typeof n=="number"&&Number.isInteger(n)&&!Ll(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var F_="__type__",rI="__max__",yi={mapValue:{fields:{__type__:{stringValue:rI}}}},L_="__vector__",Ho="value",Qd={nullValue:"NULL_VALUE"};function hs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Jh(n)?4:sI(n)?9007199254740991:Xh(n)?10:11:G()}function Pn(n,e){if(n===e)return!0;let t=hs(n),r=hs(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Fl(n).isEqual(Fl(e));case 3:return OV(n,e);case 5:return n.stringValue===e.stringValue;case 6:return FV(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return PV(n,e);case 2:return LV(n,e);case 9:return us(n.arrayValue.values||[],e.arrayValue.values||[],Pn);case 10:case 11:return VV(n,e);case 9007199254740991:return!0;default:return G()}}function OV(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Ar(n.timestampValue),r=Ar(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function PV(n,e){return Le(n.geoPointValue.latitude)===Le(e.geoPointValue.latitude)&&Le(n.geoPointValue.longitude)===Le(e.geoPointValue.longitude)}function FV(n,e){return Ci(n.bytesValue).isEqual(Ci(e.bytesValue))}function LV(n,e){if("integerValue"in n&&"integerValue"in e)return Le(n.integerValue)===Le(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Le(n.doubleValue),r=Le(e.doubleValue);return t===r?Ll(t)===Ll(r):isNaN(t)&&isNaN(r)}return!1}function VV(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(TT(t)!==TT(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Pn(t[i],r[i])))return!1;return!0}function Vl(n,e){return(n.values||[]).find(t=>Pn(t,e))!==void 0}function Ei(n,e){if(n===e)return 0;let t=hs(n),r=hs(e);if(t!==r)return se(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(n.booleanValue,e.booleanValue);case 2:return BV(n,e);case 3:return IT(n.timestampValue,e.timestampValue);case 4:return IT(Fl(n),Fl(e));case 5:return se(n.stringValue,e.stringValue);case 6:return zV(n.bytesValue,e.bytesValue);case 7:return qV(n.referenceValue,e.referenceValue);case 8:return UV(n.geoPointValue,e.geoPointValue);case 9:return iI(n.arrayValue,e.arrayValue);case 10:return GV(n.mapValue,e.mapValue);case 11:return jV(n.mapValue,e.mapValue);default:throw G()}}function BV(n,e){let t=Le(n.integerValue||n.doubleValue),r=Le(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function IT(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return se(n,e);let t=Ar(n),r=Ar(e),i=se(t.seconds,r.seconds);return i!==0?i:se(t.nanos,r.nanos)}function qV(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=se(t[i],r[i]);if(s!==0)return s}return se(t.length,r.length)}function UV(n,e){let t=se(Le(n.latitude),Le(e.latitude));return t!==0?t:se(Le(n.longitude),Le(e.longitude))}function zV(n,e){let t=Ci(n),r=Ci(e);return t.compareTo(r)}function iI(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Ei(t[i],r[i]);if(s)return s}return se(t.length,r.length)}function GV(n,e){var t,r,i,s;let o=n.fields||{},a=e.fields||{},l=(t=o[Ho])===null||t===void 0?void 0:t.arrayValue,c=(r=a[Ho])===null||r===void 0?void 0:r.arrayValue,u=se(((i=l?.values)===null||i===void 0?void 0:i.length)||0,((s=c?.values)===null||s===void 0?void 0:s.length)||0);return u!==0?u:iI(l,c)}function jV(n,e){if(n===yi.mapValue&&e===yi.mapValue)return 0;if(n===yi.mapValue)return 1;if(e===yi.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=se(r[o],s[o]);if(a!==0)return a;let l=Ei(t[r[o]],i[s[o]]);if(l!==0)return l}return se(r.length,s.length)}function Ko(n){return V_(n)}function V_(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?HV(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?WV(n.bytesValue):"referenceValue"in n?$V(n.referenceValue):"geoPointValue"in n?KV(n.geoPointValue):"arrayValue"in n?YV(n.arrayValue):"mapValue"in n?QV(n.mapValue):G()}function WV(n){return Ci(n).toBase64()}function HV(n){let e=Ar(n);return`time(${e.seconds},${e.nanos})`}function KV(n){return`geo(${n.latitude},${n.longitude})`}function $V(n){return B.fromName(n).toString()}function QV(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${V_(n.fields[i])}`;return t+"}"}function YV(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=V_(r);return e+"]"}function fs(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Wy(n){return!!n&&"integerValue"in n}function JV(n){return!!n&&"doubleValue"in n}function XV(n){return Wy(n)||JV(n)}function Bl(n){return!!n&&"arrayValue"in n}function DT(n){return!!n&&"nullValue"in n}function RT(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Yd(n){return!!n&&"mapValue"in n}function Xh(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[F_])===null||t===void 0?void 0:t.stringValue)===L_}function Rl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ts(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Rl(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Rl(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function sI(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===rI}var oI={mapValue:{fields:{[F_]:{stringValue:L_},[Ho]:{arrayValue:{}}}}};function ZV(n){return"nullValue"in n?Qd:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?fs(wi.empty(),B.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Xh(n)?oI:{mapValue:{}}:G()}function eB(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?fs(wi.empty(),B.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?oI:"mapValue"in n?Xh(n)?{mapValue:{}}:yi:G()}function kT(n,e){let t=Ei(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function xT(n,e){let t=Ei(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var It=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Yd(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Rl(t)}setAll(e){let t=Xe.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Rl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Yd(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Pn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Yd(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ts(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Rl(this.value))}};function aI(n){let e=[];return Ts(n.fields,(t,r)=>{let i=new Xe([t]);if(Yd(r)){let o=aI(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new an(e)}var it=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,Y.min(),Y.min(),Y.min(),It.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,Y.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,Y.min(),Y.min(),It.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,Y.min(),Y.min(),It.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(Y.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=It.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=It.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Y.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function tB(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Ei(r,i):G()}var cr=class{constructor(e,t){this.position=e,this.inclusive=t}};function lI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=B.comparator(B.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Ei(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function nB(n,e,t){let r=lI(n,e,t);return n.inclusive?r>=0:r>0}function rB(n,e,t){let r=lI(n,e,t);return n.inclusive?r<=0:r<0}function MT(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Pn(r,i))return!1}return!0}var ps=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function iB(n){return n.field.canonicalString()+n.dir}function sB(n){return`${n.field.canonicalString()} (${n.dir})`}function oB(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var sh=class{},de=class n extends sh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new $y(e,t,r):t==="array-contains"?new Jy(e,r):t==="in"?new oh(e,r):t==="not-in"?new Xy(e,r):t==="array-contains-any"?new Zy(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Qy(e,r):new Yy(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ei(t,this.value)):t!==null&&hs(this.value)===hs(t)&&this.matchesComparison(Ei(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return G()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},Ie=class n extends sh{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return $o(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function $o(n){return n.op==="and"}function Hy(n){return n.op==="or"}function B_(n){return cI(n)&&$o(n)}function cI(n){for(let e of n.filters)if(e instanceof Ie)return!1;return!0}function Ky(n){if(n instanceof de)return n.field.canonicalString()+n.op.toString()+Ko(n.value);if(B_(n))return n.filters.map(e=>Ky(e)).join(",");{let e=n.filters.map(t=>Ky(t)).join(",");return`${n.op}(${e})`}}function uI(n,e){if(n instanceof de)return aB(n,e);if(n instanceof Ie)return lB(n,e);G()}function aB(n,e){return e instanceof de&&n.op===e.op&&n.field.isEqual(e.field)&&Pn(n.value,e.value)}function lB(n,e){return e instanceof Ie&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&uI(i,e.filters[s]),!0):!1}function dI(n,e){let t=n.filters.concat(e);return Ie.create(t,n.op)}function hI(n){return n instanceof de?uB(n):n instanceof Ie?cB(n):"Filter"}function cB(n){return n.op.toString()+" {"+n.getFilters().map(hI).join(" ,")+"}"}function uB(n){return`${n.field.canonicalString()} ${n.op} ${Ko(n.value)}`}var $y=class extends de{constructor(e,t,r){super(e,t,r),this.key=B.fromName(r.referenceValue)}matches(e){let t=B.comparator(e.key,this.key);return this.matchesComparison(t)}},Qy=class extends de{constructor(e,t){super(e,"in",t),this.keys=fI("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Yy=class extends de{constructor(e,t){super(e,"not-in",t),this.keys=fI("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function fI(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>B.fromName(r.referenceValue))}var Jy=class extends de{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Bl(t)&&Vl(t.arrayValue,this.value)}},oh=class extends de{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Vl(this.value.arrayValue,t)}},Xy=class extends de{constructor(e,t){super(e,"not-in",t)}matches(e){if(Vl(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Vl(this.value.arrayValue,t)}},Zy=class extends de{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!Bl(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>Vl(this.value.arrayValue,r))}};var ev=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function tv(n,e=null,t=[],r=[],i=null,s=null,o=null){return new ev(n,e,t,r,i,s,o)}function ms(n){let e=q(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ky(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>iB(r)).join(","),oc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ko(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ko(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function dB(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>hI(t)).join(", ")}]`),oc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>sB(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ko(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ko(t)).join(",")),`Target(${e})`}function ac(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!oB(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!uI(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!MT(n.startAt,e.startAt)?!1:MT(n.endAt,e.endAt)}function ah(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Zh(n,e){return n.filters.filter(t=>t instanceof de&&t.field.isEqual(e))}function hB(n,e){let t=D_(e);if(t===void 0)return null;for(let r of Zh(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function fB(n,e){let t=new Map;for(let r of ds(e))for(let i of Zh(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function pB(n,e){let t=[],r=!0;for(let i of ds(e)){let s=i.kind===0?pI(n,i.fieldPath,n.startAt):mI(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new cr(t,r)}function mB(n,e){let t=[],r=!0;for(let i of ds(e)){let s=i.kind===0?mI(n,i.fieldPath,n.endAt):pI(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new cr(t,r)}function pI(n,e,t){let r=Qd,i=!0;for(let s of Zh(n,e)){let o=Qd,a=!0;switch(s.op){case"<":case"<=":o=ZV(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Qd;break}kT({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];kT({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function mI(n,e,t){let r=yi,i=!0;for(let s of Zh(n,e)){let o=yi,a=!0;switch(s.op){case">=":case">":o=eB(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=yi;break}xT({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];xT({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function gB(n){let e=new ke(Xe.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function yB(n){return n.limit!==null}var Fn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function gI(n,e,t,r,i,s,o,a){return new Fn(n,e,t,r,i,s,o,a)}function ha(n){return new Fn(n)}function vB(n,e){return new Fn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function NT(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function _B(n){let e=new ke(Xe.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function bB(n){return new Fn(fe.emptyPath(),n)}function SB(n){return B.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function q_(n){return n.collectionGroup!==null}function Qo(n){let e=q(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";_B(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new ps(s,r))}),t.has(Xe.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new ps(Xe.keyField(),r))}return e.memoizedNormalizedOrderBy}function Vt(n){let e=q(n);return e.memoizedTarget||(e.memoizedTarget=CB(e,Qo(n))),e.memoizedTarget}function CB(n,e){if(n.limitType==="F")return tv(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new ps(i.field,s)});let t=n.endAt?new cr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new cr(n.startAt.position,n.startAt.inclusive):null;return tv(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function U_(n,e){let t=n.filters.concat([e]);return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function wB(n,e){let t=n.explicitOrderBy.concat([e]);return new Fn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function lh(n,e,t){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function EB(n,e){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function TB(n,e){return new Fn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function lc(n,e){return ac(Vt(n),Vt(e))&&n.limitType===e.limitType}function yI(n){return`${ms(Vt(n))}|lt:${n.limitType}`}function Fo(n){return`Query(target=${dB(Vt(n))}; limitType=${n.limitType})`}function cc(n,e){return e.isFoundDocument()&&AB(n,e)&&IB(n,e)&&DB(n,e)&&RB(n,e)}function AB(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):B.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function IB(n,e){for(let t of Qo(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function DB(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function RB(n,e){return!(n.startAt&&!rB(n.startAt,Qo(n),e)||n.endAt&&!nB(n.endAt,Qo(n),e))}function vI(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function _I(n){return(e,t)=>{let r=!1;for(let i of Qo(n)){let s=kB(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function kB(n,e,t){let r=n.field.isKeyField()?B.comparator(e.key,t.key):tB(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return G()}}var ur=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ts(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return YA(this.inner)}size(){return this.innerSize}};var xB=new Oe(B.comparator);function $t(){return xB}var bI=new Oe(B.comparator);function Tl(...n){let e=bI;for(let t of n)e=e.insert(t.key,t);return e}function MB(){return ql()}function SI(n){let e=bI;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function or(){return ql()}function CI(){return ql()}function ql(){return new ur(n=>n.toString(),(n,e)=>n.isEqual(e))}var NB=new Oe(B.comparator);function OB(){return NB}var PB=new ke(B.comparator);function oe(...n){let e=PB;for(let t of n)e=e.add(t);return e}var FB=new ke(se);function z_(){return FB}function G_(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ll(e)?"-0":e}}function wI(n){return{integerValue:""+n}}function EI(n,e){return nI(e)?wI(e):G_(n,e)}var Yo=class{constructor(){this._=void 0}};function LB(n,e,t){return n instanceof Ti?MV(t,e):n instanceof Ir?AI(n,e):n instanceof Dr?II(n,e):qB(n,e)}function VB(n,e,t){return n instanceof Ir?AI(n,e):n instanceof Dr?II(n,e):t}function TI(n,e){return n instanceof Ai?XV(e)?e:{integerValue:0}:null}function BB(n,e){return n instanceof Ir&&e instanceof Ir||n instanceof Dr&&e instanceof Dr?us(n.elements,e.elements,Pn):n instanceof Ai&&e instanceof Ai?Pn(n.operand,e.operand):n instanceof Ti&&e instanceof Ti}var Ti=class extends Yo{},Ir=class extends Yo{constructor(e){super(),this.elements=e}};function AI(n,e){let t=DI(e);for(let r of n.elements)t.some(i=>Pn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Dr=class extends Yo{constructor(e){super(),this.elements=e}};function II(n,e){let t=DI(e);for(let r of n.elements)t=t.filter(i=>!Pn(i,r));return{arrayValue:{values:t}}}var Ai=class extends Yo{constructor(e,t){super(),this.serializer=e,this.operand=t}};function qB(n,e){let t=TI(n,e),r=OT(t)+OT(n.operand);return Wy(t)&&Wy(n.operand)?wI(r):G_(n.serializer,r)}function OT(n){return Le(n.integerValue||n.doubleValue)}function DI(n){return Bl(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var gs=class{constructor(e,t){this.field=e,this.transform=t}};function UB(n,e){return n.field.isEqual(e.field)&&BB(n.transform,e.transform)}function zB(n,e){return n===void 0&&e===void 0?!0:n&&e?us(n,e,(t,r)=>UB(t,r)):!1}var nv=class{constructor(e,t){this.version=e,this.transformResults=t}},We=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ef(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var Jo=class{};function RI(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Di(n.key,We.none()):new Ii(n.key,n.data,We.none());{let t=n.data,r=It.empty(),i=new ke(Xe.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ln(n.key,r,new an(i.toArray()),We.none())}}function GB(n,e,t){n instanceof Ii?WB(n,e,t):n instanceof Ln?KB(n,e,t):QB(n,e,t)}function kl(n,e,t,r){return n instanceof Ii?HB(n,e,t,r):n instanceof Ln?$B(n,e,t,r):YB(n,e,t)}function jB(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=TI(r.transform,i||null);s!=null&&(t===null&&(t=It.empty()),t.set(r.field,s))}return t||null}function PT(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!zB(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Ii=class extends Jo{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function WB(n,e,t){let r=n.value.clone(),i=xI(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function HB(n,e,t,r){if(!ef(n.precondition,e))return t;let i=n.value.clone(),s=MI(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var Ln=class extends Jo{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function KB(n,e,t){if(!ef(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=xI(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(kI(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function $B(n,e,t,r){if(!ef(n.precondition,e))return t;let i=MI(n.fieldTransforms,r,e),s=e.data;return s.setAll(kI(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function kI(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function xI(n,e,t){let r=new Map;$(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,VB(o,a,t[i]))}return r}function MI(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,LB(s,o,e))}return r}var Di=class extends Jo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function QB(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function YB(n,e,t){return ef(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var Ul=class extends Jo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var zl=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];GB(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=kl(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=kl(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=CI();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=RI(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(Y.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oe())}isEqual(e){return this.batchId===e.batchId&&us(this.mutations,e.mutations,(t,r)=>PT(t,r))&&us(this.baseMutations,e.baseMutations,(t,r)=>PT(t,r))}},rv=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){$(e.mutations.length===r.length);let i=OB(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Gl=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var iv=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var pt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(pt||{});function NI(n){switch(n){case D.OK:return G();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return G()}}function JB(n){return NI(n)&&n!==D.ABORTED}function Jd(n){if(n===void 0)return Be("GRPC error has no .code"),D.UNKNOWN;switch(n){case pt.OK:return D.OK;case pt.CANCELLED:return D.CANCELLED;case pt.UNKNOWN:return D.UNKNOWN;case pt.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case pt.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case pt.INTERNAL:return D.INTERNAL;case pt.UNAVAILABLE:return D.UNAVAILABLE;case pt.UNAUTHENTICATED:return D.UNAUTHENTICATED;case pt.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case pt.NOT_FOUND:return D.NOT_FOUND;case pt.ALREADY_EXISTS:return D.ALREADY_EXISTS;case pt.PERMISSION_DENIED:return D.PERMISSION_DENIED;case pt.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case pt.ABORTED:return D.ABORTED;case pt.OUT_OF_RANGE:return D.OUT_OF_RANGE;case pt.UNIMPLEMENTED:return D.UNIMPLEMENTED;case pt.DATA_LOSS:return D.DATA_LOSS;default:return G()}}var sv=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var gy=null;function OI(){return new k2}function XB(){return new x2("utf-8")}var ZB=new Br([4294967295,4294967295],0);function FT(n){let e=OI().encode(n),t=new Xf;return t.update(e),new Uint8Array(t.digest())}function LT(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Br([t,r],0),a=new Br([i,s],0);return[o,a]}var ov=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new as(`Invalid padding: ${t}`);if(r<0)throw new as(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new as(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new as(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Br.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Br.fromNumber(r)));return i.compare(ZB)===1&&(i=new Br([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=FT(e),[r,i]=LT(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=FT(e),[r,i]=LT(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},as=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var jl=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Wl.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(Y.min(),i,new Oe(se),$t(),oe())}},Wl=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,oe(),oe(),oe())}};var Go=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},ch=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},uh=class{constructor(e,t,r=Ze.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},dh=class{constructor(){this.pendingResponses=0,this.documentChanges=BT(),this._resumeToken=Ze.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=oe(),t=oe(),r=oe();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:G()}}),new Wl(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=BT()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,$(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},eq="WatchChangeAggregator",av=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=$t(),this.pendingDocumentTargetMapping=VT(),this.pendingTargetResets=new Oe(se)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:G()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(ah(s))if(r===0){let o=new B(s.path);this.removeDocumentFromTarget(t,o,it.newNoDocument(o,Y.min()))}else $(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}gy?.notifyOnExistenceFilterMismatch(tq(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ci(r).toUint8Array()}catch(l){if(l instanceof sv)return On("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new ov(o,i,s)}catch(l){return l instanceof as?On("BloomFilter error: ",l):On("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&ah(a.target)){let l=new B(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,it.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=oe();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new jl(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=$t(),this.pendingDocumentTargetMapping=VT(),this.pendingTargetResets=new Oe(se),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new dh,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ke(se),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||O(eq,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new dh),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function VT(){return new Oe(B.comparator)}function BT(){return new Oe(B.comparator)}function tq(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},f=e.unchangedNames;return f&&(d.bloomFilter={applied:i===0,hashCount:(s=f?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=f?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=f?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:v=>{var w;return(w=r?.mightContain(v))!==null&&w!==void 0?w:!1}}),d}var nq=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),rq=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),iq=(()=>{let n={};return n.and="AND",n.or="OR",n})();var lv=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function sq(n){let e=n.code===void 0?D.UNKNOWN:Jd(n.code);return new M(e,n.message||"")}function cv(n,e){return n.useProto3Json||oc(e)?e:{value:e}}function oq(n){let e;return typeof n=="object"?e=n.value:e=n,oc(e)?null:e}function Xo(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function aq(n){let e=Ar(n);return new qe(e.seconds,e.nanos)}function PI(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function lq(n,e){return n.useProto3Json?($(e===void 0||typeof e=="string"),Ze.fromBase64String(e||"")):($(e===void 0||e instanceof Buffer||e instanceof Uint8Array),Ze.fromUint8Array(e||new Uint8Array))}function cq(n,e){return Xo(n,e.toTimestamp())}function Je(n){return $(!!n),Y.fromTimestamp(aq(n))}function j_(n,e){return uv(n,e).canonicalString()}function uv(n,e){let t=uq(n).child("documents");return e===void 0?t:t.child(e)}function FI(n){let e=fe.fromString(n);return $(HI(e)),e}function Hl(n,e){return j_(n.databaseId,e.path)}function ar(n,e){let t=FI(e);if(t.get(1)!==n.databaseId.projectId)throw new M(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new M(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new B(BI(t))}function LI(n,e){return j_(n.databaseId,e)}function VI(n){let e=FI(n);return e.length===4?fe.emptyPath():BI(e)}function dv(n){return new fe(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function uq(n){return new fe(["projects",n.projectId,"databases",n.database])}function BI(n){return $(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function qT(n,e,t){return{name:Hl(n,e),fields:t.value.mapValue.fields}}function dq(n,e){return{name:Hl(n,e.key),fields:e.data.value.mapValue.fields,updateTime:Xo(n,e.version.toTimestamp()),createTime:Xo(n,e.createTime.toTimestamp())}}function qI(n,e,t){let r=ar(n,e.name),i=Je(e.updateTime),s=e.createTime?Je(e.createTime):Y.min(),o=new It({mapValue:{fields:e.fields}}),a=it.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function hq(n,e){$(!!e.found),e.found.name,e.found.updateTime;let t=ar(n,e.found.name),r=Je(e.found.updateTime),i=e.found.createTime?Je(e.found.createTime):Y.min(),s=new It({mapValue:{fields:e.found.fields}});return it.newFoundDocument(t,r,i,s)}function fq(n,e){$(!!e.missing),$(!!e.readTime);let t=ar(n,e.missing),r=Je(e.readTime);return it.newNoDocument(t,r)}function pq(n,e){return"found"in e?hq(n,e):"missing"in e?fq(n,e):G()}function mq(n,e){let t;if("targetChange"in e){e.targetChange;let r=gq(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=lq(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&sq(o);t=new uh(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=ar(n,r.document.name),s=Je(r.document.updateTime),o=r.document.createTime?Je(r.document.createTime):Y.min(),a=new It({mapValue:{fields:r.document.fields}}),l=it.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Go(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=ar(n,r.document),s=r.readTime?Je(r.readTime):Y.min(),o=it.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Go([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=ar(n,r.document),s=r.removedTargetIds||[];t=new Go([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new iv(i,s),a=r.targetId;t=new ch(a,o)}else return G();return t}function gq(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:G()}function yq(n){if(!("targetChange"in n))return Y.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Y.min():Je(e.readTime)}function Kl(n,e){let t;if(e instanceof Ii)t={update:qT(n,e.key,e.value)};else if(e instanceof Di)t={delete:Hl(n,e.key)};else if(e instanceof Ln)t={update:qT(n,e.key,e.data),updateMask:Yq(e.fieldMask)};else if(e instanceof Ul)t={verify:Hl(n,e.key)};else return G();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>Cq(n,r))),e.precondition.isNone||(t.currentDocument=vq(n,e.precondition)),t}function hv(n,e){let t=e.currentDocument?_q(e.currentDocument):We.none(),r=e.updateTransforms?e.updateTransforms.map(i=>wq(n,i)):[];if(e.update){e.update.name;let i=ar(n,e.update.name),s=new It({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=Jq(e.updateMask);return new Ln(i,s,o,t,r)}else return new Ii(i,s,t,r)}else if(e.delete){let i=ar(n,e.delete);return new Di(i,t)}else if(e.verify){let i=ar(n,e.verify);return new Ul(i,t)}else return G()}function vq(n,e){return e.updateTime!==void 0?{updateTime:cq(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:G()}function _q(n){return n.updateTime!==void 0?We.updateTime(Je(n.updateTime)):n.exists!==void 0?We.exists(n.exists):We.none()}function bq(n,e){let t=n.updateTime?Je(n.updateTime):Je(e);return t.isEqual(Y.min())&&(t=Je(e)),new nv(t,n.transformResults||[])}function Sq(n,e){return n&&n.length>0?($(e!==void 0),n.map(t=>bq(t,e))):[]}function Cq(n,e){let t=e.transform;if(t instanceof Ti)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Ir)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Dr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Ai)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw G()}function wq(n,e){let t=null;if("setToServerValue"in e)$(e.setToServerValue==="REQUEST_TIME"),t=new Ti;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Ir(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Dr(i)}else"increment"in e?t=new Ai(n,e.increment):G();let r=Xe.fromServerFormat(e.fieldPath);return new gs(r,t)}function UI(n,e){return{documents:[LI(n,e.path)]}}function Eq(n){let e=n.documents.length;$(e===1);let t=n.documents[0];return Vt(ha(VI(t)))}function zI(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=LI(n,i);let s=Rq(e.filters);s&&(t.structuredQuery.where=s);let o=xq(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=cv(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=Nq(e.startAt)),e.endAt&&(t.structuredQuery.endAt=Oq(e.endAt)),{queryTarget:t,parent:i}}function GI(n){let e=VI(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){$(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=kq(t.where));let o=[];t.orderBy&&(o=Mq(t.orderBy));let a=null;t.limit&&(a=oq(t.limit));let l=null;t.startAt&&(l=Pq(t.startAt));let c=null;return t.endAt&&(c=Fq(t.endAt)),gI(e,i,o,s,a,"F",l,c)}function Tq(n){return Vt(GI(n))}function Aq(n,e){let t=Iq(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Iq(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return G()}}function Dq(n,e){let t,r=e.target;if(ah(r)?t={documents:UI(n,r)}:t={query:zI(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=PI(n,e.resumeToken);let i=cv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(Y.min())>0){t.readTime=Xo(n,e.snapshotVersion.toTimestamp());let i=cv(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function Rq(n){if(n.length!==0)return WI(Ie.create(n,"and"))}function kq(n){let e=jI(n);return e instanceof Ie&&B_(e)?e.getFilters():[e]}function jI(n){return n.unaryFilter!==void 0?Kq(n):n.fieldFilter!==void 0?$q(n):n.compositeFilter!==void 0?Qq(n):G()}function xq(n){if(n.length!==0)return n.map(e=>Gq(e))}function Mq(n){return n.map(e=>jq(e))}function Nq(n){return{before:n.inclusive,values:n.position}}function Oq(n){return{before:!n.inclusive,values:n.position}}function Pq(n){let e=!!n.before,t=n.values||[];return new cr(t,e)}function Fq(n){let e=!n.before,t=n.values||[];return new cr(t,e)}function Lq(n){return nq[n]}function Vq(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function Bq(n){return rq[n]}function qq(n){return iq[n]}function Uq(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function zq(n){switch(n){case"AND":return"and";case"OR":return"or";default:return G()}}function Lo(n){return{fieldPath:n.canonicalString()}}function qo(n){return Xe.fromServerFormat(n.fieldPath)}function Gq(n){return{field:Lo(n.field),direction:Lq(n.dir)}}function jq(n){return new ps(qo(n.field),Vq(n.direction))}function WI(n){return n instanceof de?Hq(n):n instanceof Ie?Wq(n):G()}function Wq(n){let e=n.getFilters().map(t=>WI(t));return e.length===1?e[0]:{compositeFilter:{op:qq(n.op),filters:e}}}function Hq(n){if(n.op==="=="){if(RT(n.value))return{unaryFilter:{field:Lo(n.field),op:"IS_NAN"}};if(DT(n.value))return{unaryFilter:{field:Lo(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(RT(n.value))return{unaryFilter:{field:Lo(n.field),op:"IS_NOT_NAN"}};if(DT(n.value))return{unaryFilter:{field:Lo(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Lo(n.field),op:Bq(n.op),value:n.value}}}function Kq(n){switch(n.unaryFilter.op){case"IS_NAN":let e=qo(n.unaryFilter.field);return de.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=qo(n.unaryFilter.field);return de.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=qo(n.unaryFilter.field);return de.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=qo(n.unaryFilter.field);return de.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return G();default:return G()}}function $q(n){return de.create(qo(n.fieldFilter.field),Uq(n.fieldFilter.op),n.fieldFilter.value)}function Qq(n){return Ie.create(n.compositeFilter.filters.map(e=>jI(e)),zq(n.compositeFilter.op))}function Yq(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Jq(n){let e=n.fieldPaths||[];return new an(e.map(t=>Xe.fromServerFormat(t)))}function HI(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Zo=class n{constructor(e,t,r,i,s=Y.min(),o=Y.min(),a=Ze.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var hh=class{constructor(e){this.remoteSerializer=e}};function Xq(n,e){let t;if(e.document)t=qI(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=B.fromSegments(e.noDocument.path),i=vs(e.noDocument.readTime);t=it.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=B.fromSegments(e.unknownDocument.path),i=vs(e.unknownDocument.version);t=it.newUnknownDocument(r,i)}else return G();return e.readTime&&t.setReadTime(Zq(e.readTime)),t}function UT(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:tf(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=dq(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:ys(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:ys(e.version)};else return G();return r}function tf(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Zq(n){let e=new qe(n[0],n[1]);return Y.fromTimestamp(e)}function ys(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function vs(n){let e=new qe(n.seconds,n.nanoseconds);return Y.fromTimestamp(e)}function e3(n,e,t){let r=t.baseMutations.map(s=>Kl(n.remoteSerializer,s)),i=t.mutations.map(s=>Kl(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function rs(n,e){let t=(e.baseMutations||[]).map(s=>hv(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>hv(n.remoteSerializer,s)),i=qe.fromMillis(e.localWriteTimeMs);return new zl(e.batchId,i,t,r)}function Al(n){let e=vs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?vs(n.lastLimboFreeSnapshotVersion):Y.min(),r;return t3(n.query)?r=Eq(n.query):r=Tq(n.query),new Zo(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Ze.fromBase64String(n.resumeToken))}function KI(n,e){let t=ys(e.snapshotVersion),r=ys(e.lastLimboFreeSnapshotVersion),i;ah(e.target)?i=UI(n.remoteSerializer,e.target):i=zI(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ms(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function t3(n){return n.documents!==void 0}function n3(n){return{id:n.bundleId,createTime:vs(n.createTime),version:n.version}}function r3(n){return{bundleId:n.id,createTime:ys(Je(n.createTime)),version:n.version}}function i3(n){return{name:n.name,query:W_(n.bundledQuery),readTime:vs(n.readTime)}}function s3(n){return{name:n.name,readTime:ys(Je(n.readTime)),bundledQuery:n.bundledQuery}}function W_(n){let e=GI({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?lh(e,e.limit,"L"):e}function o3(n){return{name:n.name,query:W_(n.bundledQuery),readTime:Je(n.readTime)}}function a3(n){return{id:n.id,version:n.version,createTime:Je(n.createTime)}}function yy(n,e){return new Gl(e.largestBatchId,hv(n.remoteSerializer,e.overlayMutation))}function l3(n,e,t){let[r,i,s]=$I(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:Kl(n.remoteSerializer,t.mutation)}}function $I(n,e){let t=e.path.lastSegment(),r=Lt(e.path.popLast());return[n,r,t]}function c3(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function u3(n,e){let t=e?new Nl(e.sequenceNumber,new Cn(vs(e.readTime),new B(sr(e.documentKey)),e.largestBatchId)):Nl.empty(),r=n.fields.map(([i,s])=>new Uo(Xe.fromServerFormat(i),s));return new Oy(n.indexId,n.collectionGroup,r,t)}function zT(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:ys(r.readTime),documentKey:Lt(r.documentKey.path),largestBatchId:r.largestBatchId}}var fv=class{getBundleMetadata(e,t){return GT(e).get(t).next(r=>{if(r)return n3(r)})}saveBundleMetadata(e,t){return GT(e).put(r3(t))}getNamedQuery(e,t){return jT(e).get(t).next(r=>{if(r)return i3(r)})}saveNamedQuery(e,t){return jT(e).put(s3(t))}};function GT(n){return at(n,Hh)}function jT(n){return at(n,Kh)}var fh=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Sl(e).get($I(this.userId,t)).next(r=>r?yy(this.serializer,r):null)}getOverlays(e,t){let r=or();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Gl(t,o);i.push(this.saveOverlay(e,a))}),E.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Lt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Sl(e).deleteAll(zy,a))}),E.waitFor(s)}getOverlaysForCollection(e,t,r){let i=or(),s=Lt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Sl(e).loadAll(zy,o).next(a=>{for(let l of a){let c=yy(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=or(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Sl(e).iterate({index:HA,range:a},(l,c,u)=>{let d=yy(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Sl(e).put(l3(this.serializer,this.userId,t))}};function Sl(n){return at(n,Yh)}var pv=class{globalsStore(e){return at(e,N_)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(r=>{let i=r?.value;return i?Ze.fromUint8Array(i):Ze.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}};var d3=5,h3=10,f3=13,vy=15,p3=20,m3=25,g3=30,y3=37,v3=45,_3=50,b3=53,S3=55,C3=60,w3=2,Tr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,d3);else if("booleanValue"in e)this.writeValueTypeLabel(t,h3),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,vy),t.writeNumber(Le(e.integerValue));else if("doubleValue"in e){let r=Le(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,f3):(this.writeValueTypeLabel(t,vy),Ll(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,p3),typeof r=="string"&&(r=Ar(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,g3),t.writeBytes(Ci(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,v3),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?sI(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):Xh(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):G()}writeIndexString(e,t){this.writeValueTypeLabel(t,m3),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,S3);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexVector(e,t){var r,i;let s=e.fields||{};this.writeValueTypeLabel(t,b3);let o=Ho,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.writeValueTypeLabel(t,vy),t.writeNumber(Le(a)),this.writeIndexString(o,t),this.writeIndexValueAux(s[o],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,_3);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,y3),B.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,C3),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(w3)}};Tr.INSTANCE=new Tr;var WT="\uD800",HT="\uDBFF",ko=0,KT=255,$T=1,xo=255,QT=255,YT=0,E3=64,T3=8,A3=1024;function I3(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function D3(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function R3(n){let e=0;for(let t=0;t<8;++t){let r=D3(n[t]&255);if(e+=r,r!==8)break}return e}function JT(n){let e=E3-R3(n);return Math.ceil(e/T3)}var mv=class{constructor(){this.buffer=new Uint8Array(A3),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<WT||HT<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<WT||HT<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=JT(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=JT(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(xo),this.writeEscapedByteAscending(QT)}writeInfinityDescending(){this.writeEscapedByteDescending(xo),this.writeEscapedByteDescending(QT)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=I3(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===ko?(this.writeEscapedByteAscending(ko),this.writeEscapedByteAscending(KT)):t===xo?(this.writeEscapedByteAscending(xo),this.writeEscapedByteAscending(YT)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===ko?(this.writeEscapedByteDescending(ko),this.writeEscapedByteDescending(KT)):t===xo?(this.writeEscapedByteDescending(xo),this.writeEscapedByteDescending(YT)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(ko),this.writeEscapedByteAscending($T)}writeSeparatorDescending(){this.writeEscapedByteDescending(ko),this.writeEscapedByteDescending($T)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},gv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},yv=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},is=class{constructor(){this.orderedCode=new mv,this.ascending=new gv(this.orderedCode),this.descending=new yv(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var ss=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function fi(n,e){let t=n.indexId-e.indexId;return t!==0||(t=XT(n.arrayValue,e.arrayValue),t!==0)||(t=XT(n.directionalValue,e.directionalValue),t!==0)?t:B.comparator(n.documentKey,e.documentKey)}function XT(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var ph=class{constructor(e){this.inequalityFilters=new ke((t,r)=>Xe.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if($(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=D_(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=ds(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ke(Xe.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Uo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Uo(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Uo(r.field,r.dir==="asc"?0:1)));return new Oy(Oy.UNKNOWN_ID,this.collectionId,t,Nl.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function QI(n){var e,t;if($(n instanceof de||n instanceof Ie),n instanceof de)if(n instanceof oh){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>de.create(n.field,"==",s)))||[];return Ie.create(i,"or")}else return n;let r=n.filters.map(i=>QI(i));return Ie.create(r,n.op)}function k3(n){if(n.getFilters().length===0)return[];let e=vv(QI(n));return $(YI(e)),H_(e)||K_(e)?[e]:e.getFilters()}function H_(n){return n instanceof de}function K_(n){return n instanceof Ie&&B_(n)}function YI(n){return H_(n)||K_(n)||x3(n)}function x3(n){if(n instanceof Ie&&Hy(n)){for(let e of n.getFilters())if(!H_(e)&&!K_(e))return!1;return!0}return!1}function vv(n){if($(n instanceof de||n instanceof Ie),n instanceof de)return n;if(n.filters.length===1)return vv(n.filters[0]);let e=n.filters.map(r=>vv(r)),t=Ie.create(e,n.op);return t=mh(t),YI(t)?t:($(t instanceof Ie),$($o(t)),$(t.filters.length>1),t.filters.reduce((r,i)=>$_(r,i)))}function $_(n,e){$(n instanceof de||n instanceof Ie),$(e instanceof de||e instanceof Ie);let t;return n instanceof de?e instanceof de?t=M3(n,e):t=ZT(n,e):e instanceof de?t=ZT(e,n):t=N3(n,e),mh(t)}function M3(n,e){return Ie.create([n,e],"and")}function N3(n,e){if($(n.filters.length>0&&e.filters.length>0),$o(n)&&$o(e))return dI(n,e.getFilters());let t=Hy(n)?n:e,r=Hy(n)?e:n,i=t.filters.map(s=>$_(s,r));return Ie.create(i,"or")}function ZT(n,e){if($o(e))return dI(e,n.getFilters());{let t=e.filters.map(r=>$_(n,r));return Ie.create(t,"or")}}function mh(n){if($(n instanceof de||n instanceof Ie),n instanceof de)return n;let e=n.getFilters();if(e.length===1)return mh(e[0]);if(cI(n))return n;let t=e.map(i=>mh(i)),r=[];return t.forEach(i=>{i instanceof de?r.push(i):i instanceof Ie&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Ie.create(r,n.op)}var _v=class{constructor(){this.collectionParentIndex=new $l}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),E.resolve()}getCollectionParents(e,t){return E.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return E.resolve()}deleteFieldIndex(e,t){return E.resolve()}deleteAllFieldIndexes(e){return E.resolve()}createTargetIndexes(e,t){return E.resolve()}getDocumentsMatchingTarget(e,t){return E.resolve(null)}getIndexType(e,t){return E.resolve(0)}getFieldIndexes(e,t){return E.resolve([])}getNextCollectionGroupToUpdate(e){return E.resolve(null)}getMinOffset(e,t){return E.resolve(Cn.min())}getMinOffsetFromCollectionGroup(e,t){return E.resolve(Cn.min())}updateCollectionGroup(e,t,r){return E.resolve()}updateIndexEntries(e,t){return E.resolve()}},$l=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ke(fe.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ke(fe.comparator)).toArray()}};var eA="IndexedDbIndexManager",Gd=new Uint8Array(0),bv=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new $l,this.targetToDnfSubTargets=new ur(r=>ms(r),(r,i)=>ac(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Lt(i)};return tA(e).put(s)}return E.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[MA(t),""],!1,!0);return tA(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(sr(o.parent))}return r})}addFieldIndex(e,t){let r=Cl(e),i=c3(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=No(e);return s.next(a=>{o.put(zT(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Cl(e),i=No(e),s=Mo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Cl(e),r=Mo(e),i=No(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return E.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new ph(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Mo(e),i=!0,s=new Map;return E.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=oe(),a=[];return E.forEach(s,(l,c)=>{O(eA,`Using index ${U2(l)} to execute ${ms(t)}`);let u=hB(c,l),d=fB(c,l),f=pB(c,l),v=mB(c,l),w=this.encodeBound(l,c,f),A=this.encodeBound(l,c,v),T=this.encodeValues(l,c,d),P=this.generateIndexRanges(l.indexId,u,w,f.inclusive,A,v.inclusive,T);return E.forEach(P,U=>r.loadFirst(U,t.limit).next(L=>{L.forEach(I=>{let j=B.fromSegments(I.documentKey);o.has(j)||(o=o.add(j),a.push(j))})}))}).next(()=>a)}else return E.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=k3(Ie.create(e.filters,"and")).map(i=>tv(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let f=t?this.encodeSingleElement(t[d/c]):Gd,v=this.generateLowerBound(e,f,r[d%c],i),w=this.generateUpperBound(e,f,s[d%c],o),A=a.map(T=>this.generateLowerBound(e,f,T,!0));u.push(...this.createRange(v,w,A))}return u}generateLowerBound(e,t,r,i){let s=new ss(e,B.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new ss(e,B.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new ph(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return E.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<gB(s)&&(r=1):r=0})).next(()=>yB(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new is;for(let i of ds(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);Tr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new is;return Tr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new is;return Tr.INSTANCE.writeIndexValue(fs(this.databaseId,t),r.forKind(q2(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new is);let s=0;for(let o of ds(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&Bl(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);Tr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new is;l.seed(a.encodedBytes()),Tr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof de&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Cl(e),i=No(e);return(t?r.loadAll(Uy,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return E.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(u3(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:se(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Cl(e),s=No(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(Uy,IDBKeyRange.bound(t,t)).next(a=>E.forEach(a,l=>s.put(zT(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return E.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?E.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),E.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?E.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return Mo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Mo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Mo(e),s=new ke(fi);return i.iterate({index:WA,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new ss(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new ke(fi),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=D_(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Bl(o))for(let a of o.arrayValue.values||[])r=r.add(new ss(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new ss(t.indexId,e.key,Gd,i));return r}updateEntries(e,t,r,i,s){O(eA,"Updating index entries for document '%s'",t.key);let o=[];return AV(i,s,fi,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),E.waitFor(o)}getNextSequenceNumber(e){let t=1;return No(e).iterate({index:jA,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>fi(o,a)).filter((o,a,l)=>!a||fi(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=fi(o,e),l=fi(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Gd,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Gd,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return fi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(nA)}getMinOffset(e,t){return E.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||G())).next(nA)}};function tA(n){return at(n,Ol)}function Mo(n){return at(n,Qh)}function Cl(n){return at(n,M_)}function No(n){return at(n,$h)}function nA(n){$(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;R_(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Cn(e.readTime,e.documentKey,t)}function JI(n,e,t){let r=n.store(Nn),i=n.store(ca),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,f)=>(a++,f.delete()));s.push(l.next(()=>{$(a===1)}));let c=[];for(let u of t.mutations){let d=UA(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return E.waitFor(s).next(()=>c)}function gh(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw G();return JSON.stringify(e).length}var yh=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){$(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return pi(e).iterate({index:os,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Vo(e),o=pi(e);return o.add({}).next(a=>{$(typeof a=="number");let l=new zl(a,t,r,i),c=e3(this.serializer,this.userId,l),u=[],d=new ke((f,v)=>se(f.canonicalString(),v.canonicalString()));for(let f of i){let v=UA(this.userId,f.key.path,a);d=d.add(f.key.path.popLast()),u.push(o.put(c)),u.push(s.put(v,Q2))}return d.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),E.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return pi(e).get(t).next(r=>r?($(r.userId===this.userId),rs(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?E.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return pi(e).iterate({index:os,range:i},(o,a,l)=>{a.userId===this.userId&&($(a.batchId>=r),s=rs(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=_i;return pi(e).iterate({index:os,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,_i],[this.userId,Number.POSITIVE_INFINITY]);return pi(e).loadAll(os,t).next(r=>r.map(i=>rs(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Kd(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Vo(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,f=sr(u);if(c!==this.userId||!t.path.isEqual(f)){l.done();return}return pi(e).get(d).next(v=>{if(!v)throw G();$(v.userId===this.userId),s.push(rs(this.serializer,v))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ke(se),i=[];return t.forEach(s=>{let o=Kd(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Vo(e).iterate({range:a},(c,u,d)=>{let[f,v,w]=c,A=sr(v);if(f!==this.userId||!s.path.isEqual(A)){d.done();return}r=r.add(w)});i.push(l)}),E.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Kd(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new ke(se);return Vo(e).iterate({range:o},(l,c,u)=>{let[d,f,v]=l,w=sr(f);if(d!==this.userId||!r.isPrefixOf(w)){u.done();return}w.length===i&&(a=a.add(v))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(pi(e).get(s).next(o=>{if(o===null)throw G();$(o.userId===this.userId),r.push(rs(this.serializer,o))}))}),E.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return JI(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),E.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return E.resolve();let r=IDBKeyRange.lowerBound($2(this.userId)),i=[];return Vo(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=sr(s[1]);i.push(c)}}).next(()=>{$(i.length===0)})})}containsKey(e,t){return XI(e,this.userId,t)}getMutationQueueMetadata(e){return ZI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:_i,lastStreamToken:""})}};function XI(n,e,t){let r=Kd(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Vo(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,f]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function O3(n,e){let t=!1;return ZI(n).iterateSerial(r=>XI(n,r,e).next(i=>(i&&(t=!0),E.resolve(!i)))).next(()=>t)}function pi(n){return at(n,Nn)}function Vo(n){return at(n,ca)}function ZI(n){return at(n,ic)}var _y=2,ea=class n{constructor(e){this.lastId=e}next(){return this.lastId+=_y,this.lastId}static forTargetCache(){return new n(2-_y)}static forSyncEngine(){return new n(1-_y)}};var Sv=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new ea(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>Y.fromTimestamp(new qe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Oo(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>($(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Oo(e).iterate((o,a)=>{let l=Al(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>E.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Oo(e).iterate((r,i)=>{let s=Al(i);t(s)})}retrieveMetadata(e){return rA(e).get(rh).next(t=>($(t!==null),t))}saveMetadata(e,t){return rA(e).put(rh,t)}saveTargetData(e,t){return Oo(e).put(KI(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=ms(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Oo(e).iterate({range:i,index:GA},(o,a,l)=>{let c=Al(a);ac(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=gi(e);return t.forEach(o=>{let a=Lt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),E.waitFor(i)}removeMatchingKeys(e,t,r){let i=gi(e);return E.forEach(t,s=>{let o=Lt(s.path);return E.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=gi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=gi(e),s=oe();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=sr(o[1]),u=new B(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Lt(t.path),i=IDBKeyRange.bound([r],[MA(r)],!1,!0),s=0;return gi(e).iterate({index:x_,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Oo(e).get(t).next(r=>r?Al(r):null)}};function Oo(n){return at(n,ua)}function rA(n){return at(n,Es)}function gi(n){return at(n,da)}var iA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},uc=-1,eD=40*1024*1024,Sn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};Sn.DEFAULT_COLLECTION_PERCENTILE=10;Sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;Sn.DEFAULT=new Sn(eD,Sn.DEFAULT_COLLECTION_PERCENTILE,Sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);Sn.DISABLED=new Sn(uc,0,0);var sA="LruGarbageCollector",oA=1*1024*1024,P3=1*60*1e3,F3=5*60*1e3;function aA([n,e],[t,r]){let i=se(n,t);return i===0?se(e,r):i}var Cv=class{constructor(e){this.maxElements=e,this.buffer=new ke(aA),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();aA(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},wv=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==uc&&this.scheduleGC(P3)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){O(sA,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>C(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Mi(t)?O(sA,"Ignoring IndexedDB error during garbage collection: ",t):yield xi(t)}yield this.scheduleGC(F3)}))}},Ev=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return E.resolve(on.INVALID);let r=new Cv(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===uc?(O("LruGarbageCollector","Garbage collection skipped; disabled"),E.resolve(iA)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(O("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iA):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(O("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),Po()<=zn.DEBUG){let f=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;O("LruGarbageCollector",f)}return E.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function L3(n,e){return new Ev(n,e)}var Tv=class{constructor(e,t){this.db=e,this.garbageCollector=L3(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return jd(e,r)}removeReference(e,t,r){return jd(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return jd(e,t)}isPinned(e,t){return O3(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,Y.min()),gi(e).delete(V3(l))))});s.push(u)}}).next(()=>E.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return jd(e,t)}forEachOrphanedDocument(e,t){let r=gi(e),i=on.INVALID,s;return r.iterate({index:x_},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==on.INVALID&&t(new B(sr(s)),i),i=c,s=l):i=on.INVALID}).next(()=>{i!==on.INVALID&&t(new B(sr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function V3(n){return[0,Lt(n.path)]}function B3(n,e){return{targetId:0,path:Lt(n.path),sequenceNumber:e}}function jd(n,e){return gi(n).put(B3(e,n.currentSequenceNumber))}var vh=class{constructor(){this.changes=new ur(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,it.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?E.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Av=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return es(e).put(r)}removeEntry(e,t,r){return es(e).delete(q3(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=it.newInvalidDocument(t);return es(e).iterate({index:$d,range:IDBKeyRange.only(wl(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:it.newInvalidDocument(t)};return es(e).iterate({index:$d,range:IDBKeyRange.only(wl(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:gh(s)}}).next(()=>r)}getEntries(e,t){let r=$t();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=$t(),i=new Oe(B.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,gh(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return E.resolve();let i=new ke(uA);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(wl(i.first()),wl(i.last())),o=i.getIterator(),a=o.getNext();return es(e).iterate({index:$d,range:s},(l,c,u)=>{let d=B.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&uA(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(wl(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),tf(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return es(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=$t();for(let d of c){let f=this.maybeDecodeDocument(B.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);f.isFoundDocument()&&(cc(t,f)||i.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=$t(),o=cA(t,r),a=cA(t,Cn.max());return es(e).iterate({index:zA,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(B.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new Iv(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return lA(e).get(qy).next(t=>($(!!t),t))}setMetadata(e,t){return lA(e).put(qy,t)}maybeDecodeDocument(e,t){if(t){let r=Xq(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(Y.min())))return r}return it.newInvalidDocument(e)}};function tD(n){return new Av(n)}var Iv=class extends vh{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new ur(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ke((s,o)=>se(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=UT(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=gh(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=UT(this.documentCache.serializer,o.convertToNoDocument(Y.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),E.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function lA(n){return at(n,sc)}function es(n){return at(n,Wh)}function wl(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function q3(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],tf(e),t[t.length-1]]}function cA(n,e){let t=e.documentKey.path.toArray();return[n,tf(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function uA(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=se(t[s],r[s]),i)return i;return i=se(t.length,r.length),i||(i=se(t[t.length-2],r[r.length-2]),i)?i:se(t[t.length-1],r[r.length-1])}var U3=17;var Dv=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var _h=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&kl(r.mutation,i,an.empty(),qe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,oe()).next(()=>r))}getLocalViewOfDocuments(e,t,r=oe()){let i=or();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Tl();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=or();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,oe()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=$t(),o=ql(),a=MB();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof Ln)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),kl(u.mutation,c,u.mutation.getFieldMask(),qe.now())):o.set(c.key,an.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new Dv(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=ql(),i=new Oe((o,a)=>o-a),s=oe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||an.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||oe()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=CI();u.forEach(f=>{if(!s.has(f)){let v=RI(t.get(f),r.get(f));v!==null&&d.set(f,v),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return E.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return SB(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):q_(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):E.resolve(or()),a=jo,l=s;return o.next(c=>E.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?E.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,oe())).next(u=>({batchId:a,changes:SI(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new B(t)).next(r=>{let i=Tl();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Tl();return this.indexManager.getCollectionParents(e,s).next(a=>E.forEach(a,l=>{let c=vB(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,it.newInvalidDocument(u)))});let a=Tl();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&kl(u.mutation,c,an.empty(),qe.now()),cc(t,c)&&(a=a.insert(l,c))}),a})}};var Rv=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return E.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,a3(t)),E.resolve()}getNamedQuery(e,t){return E.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,o3(t)),E.resolve()}};var kv=class{constructor(){this.overlays=new Oe(B.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return E.resolve(this.overlays.get(t))}getOverlays(e,t){let r=or();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),E.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),E.resolve()}getOverlaysForCollection(e,t,r){let i=or(),s=t.length+1,o=new B(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return E.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Oe((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let f=s.get(u.largestBatchId);f===null&&(f=or(),s=s.insert(u.largestBatchId,f)),f.set(u.getKey(),u)}}let a=or(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>a.set(d,f)),!(a.size()>=i)););return E.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Gl(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=oe(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var xv=class{constructor(){this.sessionToken=Ze.EMPTY_BYTE_STRING}getSessionToken(e){return E.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,E.resolve()}};var Ql=class{constructor(){this.refsByKey=new ke(nt.compareByKey),this.refsByTarget=new ke(nt.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new nt(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new nt(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new B(new fe([])),r=new nt(t,e),i=new nt(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new B(new fe([])),r=new nt(t,e),i=new nt(t,e+1),s=oe();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new nt(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},nt=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return B.comparator(e.key,t.key)||se(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return se(e.targetOrBatchId,t.targetOrBatchId)||B.comparator(e.key,t.key)}};var Mv=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ke(nt.compareByKey)}checkEmpty(e){return E.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new zl(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new nt(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return E.resolve(o)}lookupMutationBatch(e,t){return E.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return E.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return E.resolve(this.mutationQueue.length===0?_i:this.nextBatchId-1)}getAllMutationBatches(e){return E.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new nt(t,0),i=new nt(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),E.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ke(se);return t.forEach(i=>{let s=new nt(i,0),o=new nt(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),E.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;B.isDocumentKey(s)||(s=s.child(""));let o=new nt(new B(s),0),a=new ke(se);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),E.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");$(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return E.forEach(t.mutations,s=>{let o=new nt(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new nt(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return E.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,E.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function z3(){return new Oe(B.comparator)}var Nv=class{constructor(e){this.sizer=e,this.docs=z3(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return E.resolve(r?r.document.mutableCopy():it.newInvalidDocument(t))}getEntries(e,t){let r=$t();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():it.newInvalidDocument(i))}),E.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=$t(),o=t.path,a=new B(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||R_(OA(u),r)<=0||!i.has(u.key)&&!cc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return E.resolve(s)}getAllFromCollectionGroup(e,t,r,i){G()}forEachDocumentKey(e,t){return E.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Ov(this)}getSize(e){return E.resolve(this.size)}};function G3(n){return new Nv(n)}var Ov=class extends vh{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),E.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var Pv=class{constructor(e){this.persistence=e,this.targets=new ur(t=>ms(t),ac),this.lastRemoteSnapshotVersion=Y.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Ql,this.targetCount=0,this.targetIdGenerator=ea.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),E.resolve()}getLastRemoteSnapshotVersion(e){return E.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return E.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),E.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),E.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ea(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,E.resolve()}updateTargetData(e,t){return this.saveTargetData(t),E.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,E.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),E.waitFor(s).next(()=>i)}getTargetCount(e){return E.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return E.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),E.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),E.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),E.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return E.resolve(r)}containsKey(e,t){return E.resolve(this.references.containsKey(t))}};var j3="MemoryPersistence",bh=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new on(0),this._started=!1,this._started=!0,this.globalsCache=new xv,this.referenceDelegate=e(this),this.targetCache=new Pv(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new _v,this.remoteDocumentCache=G3(r),this.serializer=new hh(t),this.bundleCache=new Rv(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new kv,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new Mv(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){O(j3,"Starting transaction:",e);let i=new Fv(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return E.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},Fv=class extends th{constructor(e){super(),this.currentSequenceNumber=e}},Sh=class n{constructor(e){this.persistence=e,this.localViewReferences=new Ql,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw G()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),E.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),E.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),E.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.orphanedDocuments,i=>{let s=B.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,Y.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return E.or([()=>E.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var Lv=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new nh("createOrUpgrade",t);r<1&&i>=1&&(H3(e),K3(e),dA(e),Q3(e));let o=E.resolve();return r<3&&i>=3&&(r!==0&&(X3(e),dA(e)),o=o.next(()=>eU(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>$3(e,s))),o=o.next(()=>{tU(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(J3(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{Z3(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{nU(e),rU(e)})),r<12&&i>=12&&(o=o.next(()=>{sU(e)})),r<13&&i>=13&&(o=o.next(()=>Y3(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(ns))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>iU(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore($h).clear()}).next(()=>{t.objectStore(Qh).clear()})),r<17&&i>=17&&(o=o.next(()=>{oU(e)})),o}addDocumentGlobal(e){let t=0;return e.store(ns).iterate((r,i)=>{t+=gh(i)}).next(()=>{let r={byteSize:t};return e.store(sc).put(qy,r)})}removeAcknowledgedMutations(e){let t=e.store(ic),r=e.store(Nn);return t.loadAll().next(i=>E.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,_i],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(os,o).next(a=>E.forEach(a,l=>{$(l.userId===s.userId);let c=rs(this.serializer,l);return JI(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(da),r=e.store(ns);return e.store(Es).get(rh).next(s=>{let o=l=>t.put({targetId:0,path:Lt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new fe(l),d=W3(u);a.push(t.get(d).next(f=>f?E.resolve():o(u)))}).next(()=>E.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(Ol,{keyPath:rV});let r=t.store(Ol),i=new $l,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Lt(l)})}};return t.store(ns).iterate({keysOnly:!0},(o,a)=>{let l=new fe(o);return s(l.popLast())}).next(()=>t.store(ca).iterate({keysOnly:!0},([o,a,l],c)=>{let u=sr(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(ua);return t.iterate((r,i)=>{let s=Al(i),o=KI(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(ns),i=[];return r.iterate((s,o)=>{let a=t.store(Wh),l=aU(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>E.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Nn),i=tD(this.serializer),s=new bh(Sh.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:oe();rs(this.serializer,l).keys().forEach(f=>u=u.add(f)),a.set(l.userId,u)}),E.forEach(a,(l,c)=>{let u=new st(c),d=fh.forUser(this.serializer,u),f=s.getIndexManager(u),v=yh.forUser(u,this.serializer,f,s.referenceDelegate);return new _h(i,v,d,f).recalculateAndSaveOverlaysForDocumentKeys(new Pl(t,on.INVALID),l).next()})})}};function W3(n){return[0,Lt(n)]}function H3(n){n.createObjectStore(rc)}function K3(n){n.createObjectStore(ic,{keyPath:K2}),n.createObjectStore(Nn,{keyPath:BA,autoIncrement:!0}).createIndex(os,qA,{unique:!0}),n.createObjectStore(ca)}function $3(n,e){return e.store(Nn).loadAll().next(r=>{n.deleteObjectStore(Nn),n.createObjectStore(Nn,{keyPath:BA,autoIncrement:!0}).createIndex(os,qA,{unique:!0});let s=e.store(Nn),o=r.map(a=>s.put(a));return E.waitFor(o)})}function Q3(n){n.createObjectStore(ns)}function Y3(n){let e=n.createObjectStore(Wh,{keyPath:Y2});e.createIndex($d,J2),e.createIndex(zA,X2)}function J3(n){n.createObjectStore(sc)}function dA(n){n.createObjectStore(da,{keyPath:tV}).createIndex(x_,nV,{unique:!0}),n.createObjectStore(ua,{keyPath:Z2}).createIndex(GA,eV,{unique:!0}),n.createObjectStore(Es)}function X3(n){n.deleteObjectStore(da),n.deleteObjectStore(ua),n.deleteObjectStore(Es)}function Z3(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function eU(n){let e=n.store(Es),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Y.min().toTimestamp(),targetCount:0};return e.put(rh,t)}function tU(n){n.createObjectStore(Wo,{keyPath:iV})}function nU(n){n.createObjectStore(Hh,{keyPath:sV})}function rU(n){n.createObjectStore(Kh,{keyPath:oV})}function iU(n){n.createObjectStore(M_,{keyPath:aV,autoIncrement:!0}).createIndex(Uy,lV,{unique:!1}),n.createObjectStore($h,{keyPath:cV}).createIndex(jA,uV,{unique:!1}),n.createObjectStore(Qh,{keyPath:dV}).createIndex(WA,hV,{unique:!1})}function sU(n){let e=n.createObjectStore(Yh,{keyPath:fV});e.createIndex(zy,pV,{unique:!1}),e.createIndex(HA,mV,{unique:!1})}function oU(n){n.createObjectStore(N_,{keyPath:gV})}function aU(n){return n.document?new B(fe.fromString(n.document.name).popFirst(5)):n.noDocument?B.fromSegments(n.noDocument.path):n.unknownDocument?B.fromSegments(n.unknownDocument.path):G()}var mi="IndexedDbPersistence",by=30*60*1e3,Sy=5e3,lU=4e3,Cy="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",cU="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",uU="firestore_zombie",nD="main",Vv=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=U3){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=f=>Promise.resolve(),!n.isAvailable())throw new M(D.UNIMPLEMENTED,cU);this.referenceDelegate=new Tv(this,i),this.dbName=t+nD,this.serializer=new hh(l),this.simpleDb=new Si(this.dbName,this.schemaVersion,new Lv(this.serializer)),this.globalsCache=new pv,this.targetCache=new Sv(this.referenceDelegate,this.serializer),this.remoteDocumentCache=tD(this.serializer),this.bundleCache=new fv,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Be(mi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new M(D.FAILED_PRECONDITION,Cy);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new on(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>C(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>C(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>C(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Wd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Mi(e))return O(mi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return O(mi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return El(e).get(Do).next(r=>E.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return Wd(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return C(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,by)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=at(t,Wo);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,by),o=i.filter(a=>s.indexOf(a)===-1);return E.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",lU,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?E.resolve(!0):El(e).get(Do).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Sy)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new M(D.FAILED_PRECONDITION,Cy);return!1}}return this.networkEnabled&&this.inForeground?!0:Wd(e).loadAll().next(s=>this.filterActiveClients(s,Sy).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&O(mi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return C(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[rc,Wo],e=>{let t=new Pl(e,on.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>Wd(e).loadAll().next(t=>this.filterActiveClients(t,by).map(r=>r.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return yh.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new bv(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return fh.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){O(mi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=TV(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new Pl(a,this.listenSequence?this.listenSequence.next():on.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new M(D.FAILED_PRECONDITION,PA);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return El(e).get(Do).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,Sy)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new M(D.FAILED_PRECONDITION,Cy)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return El(e).put(Do,t)}static isAvailable(){return Si.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=El(e);return t.get(Do).next(r=>this.isLocalClient(r)?(O(mi,"Releasing primary lease."),t.delete(Do)):E.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Be(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;kf()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return O(mi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Be(mi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Be("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${uU}_${this.persistenceKey}_${e}`}};function El(n){return at(n,rc)}function Wd(n){return at(n,Wo)}function Q_(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function dU(n){return C(this,null,function*(){if(!Si.isAvailable())return Promise.resolve();let e=n+nD;yield Si.delete(e)})}function hU(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}var Y_="LocalStore",fU=5*60*1e6,Yl=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Oe(se),this.targetIdByTarget=new ur(s=>ms(s),ac),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _h(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function rD(n,e,t,r){return new Yl(n,e,t,r)}function iD(n,e){return C(this,null,function*(){let t=q(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=oe();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function pU(n,e){let t=q(n),r=qe.now(),i=e.reduce((a,l)=>a.add(l.key),oe()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=$t(),c=oe();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,f)=>{f.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let f of e){let v=jB(f,s.get(f.key).overlayedDocument);v!=null&&d.push(new Ln(f.key,v,aI(v.value.mapValue),We.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:SI(s)}))}function mU(n,e){let t=q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return TU(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,gU(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function gU(n){let e=oe();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function yU(n,e){let t=q(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>($(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function vU(n){let e=q(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function sD(n){let e=q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function _U(n,e){let t=q(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let f=i.get(d);if(!f)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let v=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?v=v.withResumeToken(Ze.EMPTY_BYTE_STRING,Y.min()).withLastLimboFreeSnapshotVersion(Y.min()):u.resumeToken.approximateByteSize()>0&&(v=v.withResumeToken(u.resumeToken,r)),i=i.insert(d,v),bU(f,v,u)&&a.push(t.targetCache.updateTargetData(s,v))});let l=$t(),c=oe();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(oD(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(Y.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return E.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function oD(n,e,t){let r=oe(),i=oe();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=$t();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(Y.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):O(Y_,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function bU(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=fU?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function SU(n,e){return C(this,null,function*(){let t=q(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>E.forEach(e,i=>E.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>E.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Mi(r))O(Y_,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function CU(n,e){let t=q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=_i),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function wU(n,e){let t=q(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function ta(n,e){let t=q(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,E.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new Zo(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function EU(n,e,t){let r=q(n),i=r.targetIdByTarget.get(t);return i!==void 0?E.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function na(n,e,t){return C(this,null,function*(){let r=q(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Mi(o))O(Y_,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function nf(n,e,t){let r=q(n),i=Y.min(),s=oe();return r.persistence.runTransaction("Execute query","readwrite",o=>EU(r,o,Vt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:Y.min(),t?s:oe())).next(a=>(cD(r,vI(e),a),{documents:a,remoteKeys:s})))}function TU(n,e,t,r){let i=t.batch,s=i.keys(),o=E.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);$(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function AU(n,e){let t=q(n),r=q(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):E.resolve(null)))}function IU(n,e){q(q(n,Yl).mutationQueue).removeCachedMutationKeys(e)}function DU(n){return q(q(n,Yl).persistence).getActiveClients()}function aD(n,e){let t=q(n),r=q(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function lD(n,e){let t=q(n),r=t.collectionGroupReadTime.get(e)||Y.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,NA(r,jo),Number.MAX_SAFE_INTEGER)).then(i=>(cD(t,e,i),i))}function cD(n,e,t){let r=n.collectionGroupReadTime.get(e)||Y.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function RU(n){return Vt(ha(fe.fromString(`__bundle__/docs/${n}`)))}function kU(n,e,t,r){return C(this,null,function*(){let i=q(n),s=oe(),o=$t();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield ta(i,RU(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>oD(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function xU(n,e){let t=q(n),r=Je(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function MU(n,e){let t=q(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function NU(n,e){let t=q(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function OU(r,i){return C(this,arguments,function*(n,e,t=oe()){let s=yield ta(n,Vt(W_(e.bundledQuery))),o=q(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Je(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(Ze.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var Bv=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var PU=100;function FU(){return kf()?8:FA(Aa())>0?6:4}var Ch=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=PU,this.relativeIndexReadCostPerDocument=FU()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Bv;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Po()<=zn.DEBUG&&O("QueryEngine","SDK will not create cache indexes for query:",Fo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),E.resolve()):(Po()<=zn.DEBUG&&O("QueryEngine","Query:",Fo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Po()<=zn.DEBUG&&O("QueryEngine","The SDK decides to create cache indexes for query:",Fo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Vt(t))):E.resolve())}performQueryUsingIndex(e,t){if(NT(t))return E.resolve(null);let r=Vt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=lh(t,null,"F"),r=Vt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=oe(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,lh(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return NT(t)||i.isEqual(Y.min())?E.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?E.resolve(null):(Po()<=zn.DEBUG&&O("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Fo(t)),this.appendRemainingResults(e,o,t,NA(i,jo)).next(a=>a))})}applyQuery(e,t){let r=new ke(_I(e));return t.forEach((i,s)=>{cc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Po()<=zn.DEBUG&&O("QueryEngine","Using full collection scan to execute query:",Fo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,Cn.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var uD="firestore_clients";function hA(n,e){return`${uD}_${n}_${e}`}var dD="firestore_mutations";function fA(n,e,t){let r=`${dD}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var hD="firestore_targets";function wy(n,e){return`${hD}_${n}_${e}`}var LU="firestore_online_state";function VU(n){return`${LU}_${n}`}var BU="firestore_bundle_loaded_v2";function qU(n){return`${BU}_${n}`}var UU="firestore_sequence_number";function zU(n){return`${UU}_${n}`}var ir="SharedClientState",wh=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new M(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Be(ir,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},xl=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new M(r.error.code,r.error.message))),i?new n(e,r.state,s):(Be(ir,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Eh=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=z_();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=nI(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Be(ir,`Failed to parse client data for instance '${e}': ${t}`),null)}},qv=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Be(ir,`Failed to parse online state: ${e}`),null)}},Jl=class{constructor(){this.activeTargetIds=z_()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Ml=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Oe(se),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=hA(this.persistenceKey,this.localClientId),this.sequenceNumberKey=zU(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Jl),this.clientStateKeyRe=new RegExp(`^${uD}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${dD}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${hD}_${o}_(\\d+)$`),this.onlineStateKey=VU(this.persistenceKey),this.bundleLoadedKey=qU(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return C(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(hA(this.persistenceKey,r));if(i){let s=Eh.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(wy(this.persistenceKey,e));if(i){let s=xl.fromWebStorageEntry(e,i);s&&(r=s.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(wy(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return O(ir,"READ",e,t),t}setItem(e,t){O(ir,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){O(ir,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(O(ir,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Be("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>C(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=GU(t.newValue);r!==on.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new wh(this.currentUser,e,t,r),s=fA(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=fA(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=wy(this.persistenceKey,e),s=new xl(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Eh.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return wh.fromWebStorageEntry(new st(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return xl.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return qv.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return C(this,null,function*(){if(e.user.uid!==this.currentUser.uid){O(ir,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=z_();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function GU(n){let e=on.INVALID;if(n!=null)try{let t=JSON.parse(n);$(typeof t=="number"),e=t}catch(t){Be(ir,"Failed to read sequence number from WebStorage",t)}return e}var Th=class{constructor(){this.localState=new Jl,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Jl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Uv=class{addCallback(e){}shutdown(){}};var zv=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Hd=null;function jU(){return 268435456+Math.round(2147483648*Math.random())}function Ey(){return Hd===null?Hd=jU():Hd++,"0x"+Hd.toString(16)}function WU(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var HU="1.9.1",Ft="GrpcConnection",KU=`gl-node/${process.versions.node} fire/${la} grpc/${HU}`;function Ty(n,e,t,r){$(e===null||e.type==="OAuth");let i=new cs.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",KU),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var Gv=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){O(Ft,"Creating Firestore stub.");let e=this.databaseInfo.ssl?cs.credentials.createSsl():cs.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=Ey(),a=this.ensureActiveStub(),l=Ty(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return WU(u=>(O(Ft,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,f)=>{d?(O(Ft,`RPC '${e}' ${o} failed with error:`,d),u(new M(Jd(d.code),d.message))):(O(Ft,`RPC '${e}' ${o} completed with response:`,f),u(void 0,f))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=Ey(),l=[],c=new rt;O(Ft,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=Ty(this.databasePath,i,s,this.databaseInfo.appId),f=Object.assign(Object.assign({},r),{database:this.databasePath}),v=u[e](f,d),w=!1;return v.on("data",A=>{O(Ft,`RPC ${e} ${a} received result:`,A),l.push(A),o!==void 0&&l.length===o&&(w=!0,c.resolve(l))}),v.on("end",()=>{O(Ft,`RPC '${e}' ${a} completed.`),w||(w=!0,c.resolve(l))}),v.on("error",A=>{O(Ft,`RPC '${e}' ${a} failed with error:`,A);let T=Jd(A.code);c.reject(new M(T,A.message))}),c.promise}openStream(e,t,r){let i=Ey(),s=this.ensureActiveStub(),o=Ty(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=f=>{l||(l=!0,u.callOnClose(f),a.end())},u=new zv({sendFn:f=>{if(l)O(Ft,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,f);else{O(Ft,`RPC '${e}' stream ${i} sending:`,f);try{a.write(f)}catch(v){throw Be("Failure sending:",f),Be("Error:",v),v}}},closeFn:()=>{O(Ft,`RPC '${e}' stream ${i} closed locally via close().`),c()}}),d=!1;return a.on("data",f=>{l||(O(Ft,`RPC '${e}' stream ${i} received:`,f),d||(u.callOnConnected(),d=!0),u.callOnMessage(f))}),a.on("end",()=>{O(Ft,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",f=>{if(!l){On(Ft,`RPC '${e}' stream ${i} error. Code:`,f.code,"Message:",f.message);let v=Jd(f.code);c(new M(v,f.message))}}),O(Ft,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},fD={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},$U={nested:fD},QU=Object.freeze({__proto__:null,nested:fD,default:$U});var YU={longs:String,enums:String,defaults:!0,oneofs:!1};function JU(){let n=RA.fromJSON(QU,YU);return cs.loadPackageDefinition(n)}function XU(n){let e=JU();return new Gv(e,n)}function ZU(){return new Uv}function pD(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function e4(){return null}function dc(n){return new lv(n,!1)}var t4="ExponentialBackoff",n4=1e3,r4=1.5,i4=60*1e3,Xl=class{constructor(e,t,r=n4,i=r4,s=i4){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&O(t4,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var pA="PersistentStream",s4=60*1e3,o4=10*1e3,Ah=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new Xl(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.responseCount=0,this.state===4){this.performBackoff();return}this.auth()}stop(){return C(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,s4,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return C(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return C(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(Be(t.toString()),Be("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===D.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new M(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,o4,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>++this.responseCount===1?this.onFirst(i):this.onNext(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>C(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return O(pA,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(O(pA,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},jv=class extends Ah{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=mq(this.serializer,e),r=yq(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=dv(this.serializer),t.addTarget=Dq(this.serializer,e);let r=Aq(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=dv(this.serializer),t.removeTarget=e,this.sendRequest(t)}},Wv=class extends Ah{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return $(!!e.streamToken),this.lastStreamToken=e.streamToken,$(!e.writeResults||e.writeResults.length===0),this.listener.onHandshakeComplete()}onNext(e){$(!!e.streamToken),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=Sq(e.writeResults,e.commitTime),r=Je(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=dv(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Kl(this.serializer,r))};this.sendRequest(t)}};var Hv=class{},Kv=class extends Hv{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new M(D.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,uv(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new M(D.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,uv(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new M(D.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function a4(n,e,t,r){return new Kv(n,e,t,r)}function l4(n,e){return C(this,null,function*(){let t=q(n),r={writes:e.map(i=>Kl(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,fe.emptyPath(),r)})}function c4(n,e){return C(this,null,function*(){let t=q(n),r={documents:e.map(a=>Hl(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,fe.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=pq(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());$(!!l),o.push(l)}),o})}function u4(n,e,t){let r=q(n);return r.verifyInitialized(),new Wv(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function d4(n,e,t){let r=q(n);return r.verifyInitialized(),new jv(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var h4="OnlineStateTracker",mA=1,gA=10*1e3,$v=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",gA,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${gA/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=mA&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${mA} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Be(t),this.shouldWarnClientIsOffline=!1):O(h4,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var _s="RemoteStore",f4=10,Qv=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>C(this,null,function*(){Ni(this)&&(O(_s,"Restarting streams for network reachability change."),yield x4(this))}))}),this.onlineStateTracker=new $v(r,i)}};function p4(n,e,t,r,i){return new Qv(n,e,t,r,i)}function m4(n){let e=q(n);return e.offlineCauses.delete(0),hc(e)}function hc(n){return C(this,null,function*(){if(Ni(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function g4(n){return C(this,null,function*(){let e=q(n);e.offlineCauses.add(0),yield fa(e),e.onlineStateTracker.set("Offline")})}function fa(n){return C(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function y4(n){return C(this,null,function*(){let e=q(n);O(_s,"RemoteStore shutting down."),e.offlineCauses.add(5),yield fa(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function rf(n,e){let t=q(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),Z_(t)?X_(t):ga(t).isOpen()&&J_(t,e))}function pa(n,e){let t=q(n),r=ga(t);t.listenTargets.delete(e),r.isOpen()&&mD(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Ni(t)&&t.onlineStateTracker.set("Unknown"))}function J_(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Y.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ga(n).watch(e)}function mD(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),ga(n).unwatch(e)}function X_(n){n.watchChangeAggregator=new av({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),ga(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function Z_(n){return Ni(n)&&!ga(n).isStarted()&&n.listenTargets.size>0}function Ni(n){return q(n).offlineCauses.size===0}function gD(n){n.watchChangeAggregator=void 0}function v4(n){return C(this,null,function*(){n.onlineStateTracker.set("Online")})}function _4(n){return C(this,null,function*(){n.listenTargets.forEach((e,t)=>{J_(n,e)})})}function b4(n,e){return C(this,null,function*(){gD(n),Z_(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),X_(n)):n.onlineStateTracker.set("Unknown")})}function S4(n,e,t){return C(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof uh&&e.state===2&&e.cause){try{yield w4(n,e)}catch(r){O(_s,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ih(n,r)}return}if(e instanceof Go?n.watchChangeAggregator.handleDocumentChange(e):e instanceof ch?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(Y.min()))try{let r=yield sD(n.localStore);t.compareTo(r)>=0&&(yield C4(n,t))}catch(r){O(_s,"Failed to raise snapshot:",r),yield Ih(n,r)}})}function Ih(n,e,t){return C(this,null,function*(){if(Mi(e))n.offlineCauses.add(1),yield fa(n),n.onlineStateTracker.set("Offline"),t||(t=()=>sD(n.localStore)),n.asyncQueue.enqueueRetryable(()=>C(this,null,function*(){O(_s,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield hc(n)}));else throw e})}function yD(n,e){return e().catch(t=>Ih(n,t,e))}function C4(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(Ze.EMPTY_BYTE_STRING,s.snapshotVersion)),mD(n,r);let o=new Zo(s.target,r,i,s.sequenceNumber);J_(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function w4(n,e){return C(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function ma(n){return C(this,null,function*(){let e=q(n),t=Oi(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:_i;for(;E4(e);)try{let i=yield CU(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,T4(e,i)}catch(i){yield Ih(e,i)}vD(e)&&_D(e)})}function E4(n){return Ni(n)&&n.writePipeline.length<f4}function T4(n,e){n.writePipeline.push(e);let t=Oi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function vD(n){return Ni(n)&&!Oi(n).isStarted()&&n.writePipeline.length>0}function _D(n){Oi(n).start()}function A4(n){return C(this,null,function*(){Oi(n).writeHandshake()})}function I4(n){return C(this,null,function*(){let e=Oi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function D4(n,e,t){return C(this,null,function*(){let r=n.writePipeline.shift(),i=rv.from(r,e,t);yield yD(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield ma(n)})}function R4(n,e){return C(this,null,function*(){e&&Oi(n).handshakeComplete&&(yield k4(n,e)),vD(n)&&_D(n)})}function k4(n,e){return C(this,null,function*(){if(JB(e.code)){let t=n.writePipeline.shift();Oi(n).inhibitBackoff(),yield yD(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield ma(n)}})}function x4(n){return C(this,null,function*(){let e=q(n);e.offlineCauses.add(4),yield fa(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield hc(e)})}function yA(n,e){return C(this,null,function*(){let t=q(n);t.asyncQueue.verifyOperationInProgress(),O(_s,"RemoteStore received new credentials");let r=Ni(t);t.offlineCauses.add(3),yield fa(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield hc(t)})}function Yv(n,e){return C(this,null,function*(){let t=q(n);e?(t.offlineCauses.delete(2),yield hc(t)):e||(t.offlineCauses.add(2),yield fa(t),t.onlineStateTracker.set("Unknown"))})}function ga(n){return n.watchStream||(n.watchStream=d4(n.datastore,n.asyncQueue,{onConnected:v4.bind(null,n),onOpen:_4.bind(null,n),onClose:b4.bind(null,n),onWatchChange:S4.bind(null,n)}),n.onNetworkStatusChange.push(e=>C(this,null,function*(){e?(n.watchStream.inhibitBackoff(),Z_(n)?X_(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),gD(n))}))),n.watchStream}function Oi(n){return n.writeStream||(n.writeStream=u4(n.datastore,n.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:A4.bind(null,n),onClose:R4.bind(null,n),onHandshakeComplete:I4.bind(null,n),onMutationResult:D4.bind(null,n)}),n.onNetworkStatusChange.push(e=>C(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield ma(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(O(_s,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var M4="AsyncQueue",Jv=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new M(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ya(n,e){if(Be(M4,`${e}: ${n}`),Mi(n))return new M(D.UNAVAILABLE,`${e}: ${n}`);throw n}var Dh=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||B.comparator(t.key,r.key):this.comparator=(t,r)=>B.comparator(t.key,r.key),this.keyedMap=Tl(),this.sortedSet=new Oe(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Rh=class{constructor(){this.changeMap=new Oe(B.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):G()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},ra=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Dh.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!lc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Xv=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function N4(){return new Zv}var Zv=class{constructor(){this.queries=bD(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){B4(this,new M(D.ABORTED,"Firestore shutting down"))}};function bD(){return new ur(n=>yI(n),lc)}function e0(n,e){return C(this,null,function*(){let t=q(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new Xv,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=ya(o,`Initialization of query '${Fo(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&n0(t)})}function t0(n,e){return C(this,null,function*(){let t=q(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function O4(n,e){let t=q(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&n0(t)}function P4(n,e,t){let r=q(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function F4(n,e){let t=q(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&n0(t)}function L4(n,e){q(n).snapshotsInSyncListeners.add(e),e.next()}function V4(n,e){q(n).snapshotsInSyncListeners.delete(e)}function B4(n,e){let t=q(n),r=t.queries;t.queries=bD(),r.forEach((i,s)=>{for(let o of s.listeners)o.onError(e)})}function n0(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var SD=function(n){return n.Default="default",n.Cache="cache",n}(SD||{}),Zl=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ra(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=ra.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==SD.Cache}};var e_=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=oe(),i=oe();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var kh=class{constructor(e){this.serializer=e}toDocumentKey(e){return ar(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?qI(this.serializer,e.document,!1):it.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Je(e)}},t_=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=CD(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=fe.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new kh(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||oe()).add(s);t.set(o,a)}}return t}complete(){return C(this,null,function*(){let e=yield kU(this.localStore,new kh(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield OU(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function CD(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function q4(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var xh=class{constructor(e){this.key=e}},Mh=class{constructor(e){this.key=e}},Nh=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=oe(),this.mutatedKeys=oe(),this.docComparator=_I(e),this.documentSet=new Dh(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Rh,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let f=i.get(u),v=cc(this.query,d)?d:null,w=f?this.mutatedKeys.has(f.key):!1,A=v?v.hasLocalMutations||this.mutatedKeys.has(v.key)&&v.hasCommittedMutations:!1,T=!1;f&&v?f.data.isEqual(v.data)?w!==A&&(r.track({type:3,doc:v}),T=!0):this.shouldWaitForSyncedDocument(f,v)||(r.track({type:2,doc:v}),T=!0,(l&&this.docComparator(v,l)>0||c&&this.docComparator(v,c)<0)&&(a=!0)):!f&&v?(r.track({type:0,doc:v}),T=!0):f&&!v&&(r.track({type:1,doc:f}),T=!0,(l||c)&&(a=!0)),T&&(v?(o=o.add(v),A?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,f)=>U4(d.type,f.type)||this.docComparator(d.doc,f.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new ra(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Rh,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=oe(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Mh(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new xh(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=oe();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ra.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function U4(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return G()}};return t(n)-t(e)}var Pi="SyncEngine",n_=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},r_=class{constructor(e){this.key=e,this.receivedDocument=!1}},i_=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new ur(a=>yI(a),lc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Oe(B.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Ql,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ea.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function z4(n,e,t,r,i,s,o){let a=new i_(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function G4(n,e,t=!0){return C(this,null,function*(){let r=sf(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield wD(r,e,t,!0),i})}function j4(n,e){return C(this,null,function*(){let t=sf(n);yield wD(t,e,!0,!1)})}function wD(n,e,t,r){return C(this,null,function*(){let i=yield ta(n.localStore,Vt(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=yield r0(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&rf(n.remoteStore,i),a})}function r0(n,e,t,r,i){return C(this,null,function*(){n.applyDocChanges=(d,f,v)=>tz(n,d,f,v);let s=yield nf(n.localStore,e,!0),o=new Nh(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Wl.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);o0(n,t,c.limboChanges);let u=new n_(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function W4(n,e,t){return C(this,null,function*(){let r=q(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!lc(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield na(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&pa(r.remoteStore,i.targetId),ia(r,i.targetId)}).catch(xi))):(ia(r,i.targetId),yield na(r.localStore,i.targetId,!0))})}function H4(n,e){return C(this,null,function*(){let t=q(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),pa(t.remoteStore,r.targetId))})}function K4(n,e,t){return C(this,null,function*(){let r=l0(n);try{let i=yield pU(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),Z4(r,i.batchId,t),yield Mr(r,i.changes),yield ma(r.remoteStore)}catch(i){let s=ya(i,"Failed to persist write");t.reject(s)}})}function ED(n,e){return C(this,null,function*(){let t=q(n);try{let r=yield _U(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&($(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?$(o.receivedDocument):i.removedDocuments.size>0&&($(o.receivedDocument),o.receivedDocument=!1))}),yield Mr(t,r,e)}catch(r){yield xi(r)}})}function vA(n,e,t){let r=q(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),F4(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function $4(n,e,t){return C(this,null,function*(){let r=q(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Oe(B.comparator);o=o.insert(s,it.newNoDocument(s,Y.min()));let a=oe().add(s),l=new jl(Y.min(),new Map,new Oe(se),o,a);yield ED(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),a0(r)}else yield na(r.localStore,e,!1).then(()=>ia(r,e,t)).catch(xi)})}function Q4(n,e){return C(this,null,function*(){let t=q(n),r=e.batch.batchId;try{let i=yield mU(t.localStore,e);s0(t,r,null),i0(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Mr(t,i)}catch(i){yield xi(i)}})}function Y4(n,e,t){return C(this,null,function*(){let r=q(n);try{let i=yield yU(r.localStore,e);s0(r,e,t),i0(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Mr(r,i)}catch(i){yield xi(i)}})}function J4(n,e){return C(this,null,function*(){let t=q(n);Ni(t.remoteStore)||O(Pi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield vU(t.localStore);if(r===_i){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=ya(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function i0(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function X4(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new M(D.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function Z4(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Oe(se)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function s0(n,e,t){let r=q(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function ia(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||TD(n,i)})}function TD(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(pa(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),a0(n))}function o0(n,e,t){for(let r of t)r instanceof xh?(n.limboDocumentRefs.addReference(r.key,e),ez(n,r)):r instanceof Mh?(O(Pi,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||TD(n,r.key)):G()}function ez(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(O(Pi,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),a0(n))}function a0(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new B(fe.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new r_(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),rf(n.remoteStore,new Zo(Vt(ha(t.path)),r,"TargetPurposeLimboResolution",on.INVALID))}}function Mr(n,e,t){return C(this,null,function*(){let r=q(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{var u;if((c||t)&&r.isPrimaryClient){let d=c?!c.fromCache:(u=t?.targetChanges.get(l.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){i.push(c);let d=e_.fromSnapshot(l.targetId,c);s.push(d)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield SU(r.localStore,s))})}function tz(n,e,t,r){return C(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield nf(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return o0(n,e.targetId,a.limboChanges),a.snapshot})}function nz(n,e){return C(this,null,function*(){let t=q(n);if(!t.currentUser.isEqual(e)){O(Pi,"User change. New user:",e.toKey());let i=yield iD(t.localStore,e);t.currentUser=e,X4(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Mr(t,i.affectedDocuments)}})}function rz(n,e){let t=q(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return oe().add(r.key);{let i=oe(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function iz(n,e){return C(this,null,function*(){let t=q(n),r=yield nf(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&o0(t,e.targetId,i.limboChanges),i})}function sz(n,e){return C(this,null,function*(){let t=q(n);return lD(t.localStore,e).then(r=>Mr(t,r))})}function oz(n,e,t,r){return C(this,null,function*(){let i=q(n),s=yield AU(i.localStore,e);if(s===null){O(Pi,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield ma(i.remoteStore):t==="acknowledged"||t==="rejected"?(s0(i,e,r||null),i0(i,e),IU(i.localStore,e)):G(),yield Mr(i,s)})}function az(n,e){return C(this,null,function*(){let t=q(n);if(sf(t),l0(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield _A(t,r.toArray());t._isPrimaryClient=!0,yield Yv(t.remoteStore,!0);for(let s of i)rf(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(ia(t,o),na(t.localStore,o,!0))),pa(t.remoteStore,o)}),yield i,yield _A(t,r),lz(t),t._isPrimaryClient=!1,yield Yv(t.remoteStore,!1)}})}function lz(n){let e=q(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{pa(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Oe(B.comparator)}function _A(n,e,t){return C(this,null,function*(){let r=q(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield ta(r.localStore,Vt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield iz(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield aD(r.localStore,o);a=yield ta(r.localStore,c),yield r0(r,AD(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function AD(n){return gI(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function cz(n){let e=q(n);return DU(e.localStore)}function uz(n,e,t,r){return C(this,null,function*(){let i=q(n);if(i._isPrimaryClient){O(Pi,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield lD(i.localStore,vI(s[0])),a=jl.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Ze.EMPTY_BYTE_STRING);yield Mr(i,o,a);break}case"rejected":{yield na(i.localStore,e,!0),ia(i,e,r);break}default:G()}})}function dz(n,e,t){return C(this,null,function*(){let r=sf(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){O(Pi,"Adding an already active target "+i);continue}let o=yield aD(r.localStore,i),a=yield ta(r.localStore,o);yield r0(r,AD(o),a.targetId,!1,a.resumeToken),rf(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield na(r.localStore,i,!1).then(()=>{pa(r.remoteStore,i),ia(r,i)}).catch(xi))}})}function sf(n){let e=q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=ED.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rz.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$4.bind(null,e),e.syncEngineListener.onWatchChange=O4.bind(null,e.eventManager),e.syncEngineListener.onWatchError=P4.bind(null,e.eventManager),e}function l0(n){let e=q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Q4.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Y4.bind(null,e),e}function hz(n,e,t){let r=q(n);fz(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function fz(n,e,t){return C(this,null,function*(){try{let r=yield e.getMetadata();if(yield xU(n.localStore,r))return yield e.close(),t._completeWith(q4(r)),Promise.resolve(new Set);t._updateProgress(CD(r));let s=new t_(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Mr(n,a.changedDocs,void 0),yield MU(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return On(Pi,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var s_=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return C(this,null,function*(){this.serializer=dc(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return rD(this.persistence,new Ch,t.initialUser,this.serializer)}createPersistence(t){return new bh(Sh.factory,this.serializer)}createSharedClientState(t){return new Th}terminate(){return C(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})();var Oh=class n extends s_{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){yield _f(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield l0(this.onlineComponentProvider.syncEngine),yield ma(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return rD(this.persistence,new Ch,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new wv(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new Vy(t,this.persistence);return new Ly(e.asyncQueue,r)}createPersistence(e){let t=Q_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Sn.withCacheSize(this.cacheSizeBytes):Sn.DEFAULT;return new Vv(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,pD(),e4(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Th}},o_=class n extends Oh{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return C(this,null,function*(){yield _f(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof Ml&&(this.sharedClientState.syncEngine={applyBatchState:oz.bind(null,t),applyTargetState:uz.bind(null,t),applyActiveTargetsChange:dz.bind(null,t),getActiveClients:cz.bind(null,t),synchronizeWithChangedDocuments:sz.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>C(this,null,function*(){yield az(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=pD();if(!Ml.isAvailable(t))throw new M(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Q_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ml(t,e.asyncQueue,r,e.clientId,e.initialUser)}},c0=(()=>{class n{initialize(t,r){return C(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>vA(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=nz.bind(null,this.syncEngine),yield Yv(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return N4()}createDatastore(t){let r=dc(t.databaseInfo.databaseId),i=XU(t.databaseInfo);return a4(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return p4(this.localStore,this.datastore,t.asyncQueue,r=>vA(this.syncEngine,r,0),ZU())}createSyncEngine(t,r){return z4(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return C(this,null,function*(){var t,r;yield y4(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}n.provider={build:()=>new n};return n})(),pz=10240;function mz(n,e=pz){let t=0;return{read(){return C(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return C(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function u0(n,e,t){if(!t)throw new M(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function d0(n,e,t,r){if(e===!0&&r===!0)throw new M(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function bA(n){if(!B.isDocumentKey(n))throw new M(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function SA(n){if(B.isDocumentKey(n))throw new M(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function gz(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function fc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=yz(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":G()}function yz(n){return n.constructor?n.constructor.name:null}function ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new M(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=fc(n);throw new M(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ID(n,e){if(e<=0)throw new M(D.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function vz(n,e){if(!(n instanceof Uint8Array))throw new M(D.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${fc(n)}`);return mz(n,e)}var sa=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):Be("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var a_=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var l_=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new rt,this.buffer=new Uint8Array,this.textDecoder=XB(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return C(this,null,function*(){return this.metadata.promise})}nextElement(){return C(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return C(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new a_(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return C(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return C(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return C(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function _z(n,e){return new l_(n,e)}var c_=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new M(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield c4(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Di(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=B.fromPath(r);this.mutations.push(new Ul(i,this.precondition(i)))}),yield l4(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=Y.min();else throw G();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new M(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Y.min())?We.exists(!1):We.updateTime(t):We.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Y.min()))throw new M(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return We.updateTime(t)}else return We.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var u_=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Xl(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>C(this,null,function*(){let e=new c_(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return oc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!NI(t)}return!1}};var Ri="FirestoreClient",bz=100,Sz=11,Cz=20,wz=22,d_=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=st.UNAUTHENTICATED,this.clientId=Zd.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>C(this,null,function*(){O(Ri,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(O(Ri,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:bz}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ya(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ay(n,e){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),O(Ri,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>C(this,null,function*(){r.isEqual(i)||(yield iD(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function CA(n,e){return C(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield h0(n);O(Ri,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>yA(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>yA(e.remoteStore,i)),n._onlineComponents=e})}function Ez(n){return n.name==="FirebaseError"?n.code===D.FAILED_PRECONDITION||n.code===D.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===wz||n.code===Cz||n.code===Sz:!0}function h0(n){return C(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){O(Ri,"Using user provided OfflineComponentProvider");try{yield Ay(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!Ez(t))throw t;On("Error using user provided cache. Falling back to memory cache: "+t),yield Ay(n,new s_)}}else O(Ri,"Using default OfflineComponentProvider"),yield Ay(n,new s_);return n._offlineComponents})}function of(n){return C(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(O(Ri,"Using user provided OnlineComponentProvider"),yield CA(n,n._uninitializedComponentsProvider._online)):(O(Ri,"Using default OnlineComponentProvider"),yield CA(n,new c0))),n._onlineComponents})}function DD(n){return h0(n).then(e=>e.persistence)}function f0(n){return h0(n).then(e=>e.localStore)}function RD(n){return of(n).then(e=>e.remoteStore)}function p0(n){return of(n).then(e=>e.syncEngine)}function Tz(n){return of(n).then(e=>e.datastore)}function oa(n){return C(this,null,function*(){let e=yield of(n),t=e.eventManager;return t.onListen=G4.bind(null,e.syncEngine),t.onUnlisten=W4.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=j4.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=H4.bind(null,e.syncEngine),t})}function Az(n){return n.asyncQueue.enqueue(()=>C(this,null,function*(){let e=yield DD(n),t=yield RD(n);return e.setNetworkEnabled(!0),m4(t)}))}function Iz(n){return n.asyncQueue.enqueue(()=>C(this,null,function*(){let e=yield DD(n),t=yield RD(n);return e.setNetworkEnabled(!1),g4(t)}))}function Dz(n){let e=new rt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let t=yield p0(n);return J4(t,e)})),e.promise}function Rz(n,e,t,r){let i=new sa(r),s=new Zl(e,i,t);return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let o=yield oa(n);return e0(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let o=yield oa(n);return t0(o,s)}))}}function kz(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield f0(n);return Pz(r,e,t)})),t.promise}function kD(n,e,t={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let i=yield oa(n);return Fz(i,n.asyncQueue,e,t,r)})),r.promise}function xz(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield f0(n);return Lz(r,e,t)})),t.promise}function xD(n,e,t={}){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let i=yield oa(n);return Vz(i,n.asyncQueue,e,t,r)})),r.promise}function Mz(n,e){let t=new rt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield p0(n);return K4(r,e,t)})),t.promise}function Nz(n,e){let t=new sa(e);return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield oa(n);return L4(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let r=yield oa(n);return V4(r,t)}))}}function Oz(n,e,t){let r=new rt;return n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){let i=yield Tz(n);new u_(n.asyncQueue,i,t,e,r).run()})),r.promise}function Pz(n,e,t){return C(this,null,function*(){try{let r=yield wU(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new M(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=ya(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function Fz(n,e,t,r,i){let s=new sa({next:a=>{s.mute(),e.enqueueAndForget(()=>t0(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new M(D.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new M(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Zl(ha(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return e0(n,o)}function Lz(n,e,t){return C(this,null,function*(){try{let r=yield nf(n,e,!0),i=new Nh(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=ya(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function Vz(n,e,t,r,i){let s=new sa({next:a=>{s.mute(),e.enqueueAndForget(()=>t0(n,o)),a.fromCache&&r.source==="server"?i.reject(new M(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Zl(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return e0(n,o)}function Bz(n,e,t,r){let i=Uz(t,dc(e));n.asyncQueue.enqueueAndForget(()=>C(this,null,function*(){hz(yield p0(n),i,r)}))}function qz(n,e){return n.asyncQueue.enqueue(()=>C(this,null,function*(){return NU(yield f0(n),e)}))}function Uz(n,e){let t;return typeof n=="string"?t=OI().encode(n):t=n,_z(vz(t),e)}function zz(n,e){return n.timeoutSeconds===e.timeoutSeconds}function MD(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Gz="ComponentProvider",wA=new Map;function jz(n){let e=wA.get(n);e&&(O(Gz,"Removing Datastore"),wA.delete(n),e.terminate())}function Wz(n,e,t,r){return new jy(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,MD(r.experimentalLongPollingOptions),r.useFetchStreams)}var ND="firestore.googleapis.com",EA=!0,TA=5,AA=30,Hz=!0,Ph=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new M(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ND,this.ssl=EA}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:EA;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=eD;else{if(e.cacheSizeBytes!==uc&&e.cacheSizeBytes<oA)throw new M(D.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${oA}`);this.cacheSizeBytes=e.cacheSizeBytes}d0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=Hz:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=MD((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),Kz(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&zz(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function Kz(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new M(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<TA)throw new M(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${TA})`);if(n.timeoutSeconds>AA)throw new M(D.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${AA})`)}}var bs=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ph({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new M(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new M(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ph(e),e.credentials!==void 0&&(this._authCredentials=F2(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return jz(this),Promise.resolve()}};function OD(n,e,t,r={}){var i;n=ge(n,bs);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==ND&&s.host!==o&&On("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=st.MOCK_USER;else{a=rb(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new M(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new st(c)}n._authCredentials=new Dy(new Xd(a,l))}}var yt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},Me=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},lr=class n extends yt{constructor(e,t,r){super(e,t,ha(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new Me(this.firestore,null,new B(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function m0(n,e,...t){if(n=Ve(n),u0("collection","path",e),n instanceof bs){let r=fe.fromString(e,...t);return SA(r),new lr(n,null,r)}else{if(!(n instanceof Me)&&!(n instanceof lr))throw new M(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(fe.fromString(e,...t));return SA(r),new lr(n.firestore,null,r)}}function PD(n,e){if(n=ge(n,bs),u0("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new M(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new yt(n,null,bB(e))}function pc(n,e,...t){if(n=Ve(n),arguments.length===1&&(e=Zd.newId()),u0("doc","path",e),n instanceof bs){let r=fe.fromString(e,...t);return bA(r),new Me(n,null,new B(r))}else{if(!(n instanceof Me)&&!(n instanceof lr))throw new M(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(fe.fromString(e,...t));return bA(r),new Me(n.firestore,n instanceof lr?n.converter:null,new B(r))}}function g0(n,e){return n=Ve(n),e=Ve(e),(n instanceof Me||n instanceof lr)&&(e instanceof Me||e instanceof lr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function y0(n,e){return n=Ve(n),e=Ve(e),n instanceof yt&&e instanceof yt?n.firestore===e.firestore&&lc(n._query,e._query)&&n.converter===e.converter:!1}var $z="AsyncQueue",Fh=class{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Xl(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new rt;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return C(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Mi(e))O($z,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=Qz(r);throw Be("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=Jv.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&G()}verifyOperationInProgress(){}drain(){return C(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function Qz(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var h_=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new rt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var FD=uc,Ue=class extends bs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Fh,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Fh(e),this._firestoreClient=void 0,yield e}})}};function vt(n){if(n._terminated)throw new M(D.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||LD(n),n._firestoreClient}function LD(n){var e,t,r;let i=n._freezeSettings(),s=Wz(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new d_(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&Yz(n._componentsProvider))}function Yz(n){let e=n?._online.build();return{_offline:n?._offline.build(e),_online:e}}function VD(n,e){On("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return qD(n,c0.provider,{build:r=>new Oh(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function BD(n){return C(this,null,function*(){On("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();qD(n,c0.provider,{build:t=>new o_(t,e.cacheSizeBytes)})})}function qD(n,e,t){if(n=ge(n,Ue),n._firestoreClient||n._terminated)throw new M(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new M(D.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},LD(n)}function UD(n){if(n._initialized&&!n._terminated)throw new M(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new rt;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{yield dU(Q_(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function zD(n){n=ge(n,Ue);let e=vt(n);return Dz(e)}function GD(n){n=ge(n,Ue);let e=vt(n);return Az(e)}function jD(n){n=ge(n,Ue);let e=vt(n);return Iz(e)}function WD(n,e){n=ge(n,Ue);let t=vt(n),r=new h_;return Bz(t,n._databaseId,e,r),r}function HD(n,e){n=ge(n,Ue);let t=vt(n);return qz(t,e).then(r=>r?new yt(n,null,r.query):null)}function Jz(n,e=!0){O2(ob),Ia(new Bi("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new Ue(new Ry(t.getProvider("auth-internal")),new Ny(t.getProvider("app-check-internal")),NV(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Lr(vT,_T,n),Lr(vT,_T,"esm2017")}var dr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Ze.fromBase64String(e))}catch(t){throw new M(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Ze.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Vn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new M(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xe(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Rr=class{constructor(e){this._methodName=e}};var Ss=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new M(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new M(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}};var ec=class{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return hU(this._values,e._values)}};var Xz=/^__.*__$/,f_=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ln(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ii(e,this.data,t,this.fieldTransforms)}},Lh=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ln(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function KD(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var Vh=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Bh(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(KD(this.dataSource)&&Xz.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},p_=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||dc(e)}createContext(e,t,r,i=!1){return new Vh({dataSource:e,methodName:t,targetDoc:r,path:Xe.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function As(n){let e=n._freezeSettings(),t=dc(n._databaseId);return new p_(n._databaseId,!!e.ignoreUndefinedProperties,t)}function af(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);b0("Data must be an object, but it was:",o,r);let a=YD(r,o),l,c;if(s.merge)l=new an(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let f=__(e,d,t);if(!o.contains(f))throw new M(D.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);XD(u,f)||u.push(f)}l=new an(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new f_(new It(a),l,c)}var tc=class n extends Rr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function $D(n,e,t){return new Vh({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var m_=class n extends Rr{_toFieldTransform(e){return new gs(e.path,new Ti)}isEqual(e){return e instanceof n}},g_=class n extends Rr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=$D(this,e,!0),r=this._elements.map(s=>Is(s,t)),i=new Ir(r);return new gs(e.path,i)}isEqual(e){return e instanceof n&&xf(this._elements,e._elements)}},y_=class n extends Rr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=$D(this,e,!0),r=this._elements.map(s=>Is(s,t)),i=new Dr(r);return new gs(e.path,i)}isEqual(e){return e instanceof n&&xf(this._elements,e._elements)}},v_=class n extends Rr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Ai(e.serializer,EI(e.serializer,this._operand));return new gs(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function v0(n,e,t,r){let i=n.createContext(1,e,t);b0("Data must be an object, but it was:",i,r);let s=[],o=It.empty();Ts(r,(l,c)=>{let u=S0(e,l,t);c=Ve(c);let d=i.childContextForFieldPath(u);if(c instanceof tc)s.push(u);else{let f=Is(c,d);f!=null&&(s.push(u),o.set(u,f))}});let a=new an(s);return new Lh(o,a,i.fieldTransforms)}function _0(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[__(e,r,t)],l=[i];if(s.length%2!==0)throw new M(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(__(e,s[f])),l.push(s[f+1]);let c=[],u=It.empty();for(let f=a.length-1;f>=0;--f)if(!XD(c,a[f])){let v=a[f],w=l[f];w=Ve(w);let A=o.childContextForFieldPath(v);if(w instanceof tc)c.push(v);else{let T=Is(w,A);T!=null&&(c.push(v),u.set(v,T))}}let d=new an(c);return new Lh(u,d,o.fieldTransforms)}function QD(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Is(t,i)}function Is(n,e){if(n=Ve(n),JD(n))return b0("Unsupported field value:",e,n),YD(n,e);if(n instanceof Rr)return e6(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return Zz(n,e)}else return t6(n,e)}function YD(n,e){let t={};return YA(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ts(n,(r,i)=>{let s=Is(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function Zz(n,e){let t=[],r=0;for(let i of n){let s=Is(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function e6(n,e){if(!KD(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function t6(n,e){if(n=Ve(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return EI(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=qe.fromDate(n);return{timestampValue:Xo(e.serializer,t)}}else if(n instanceof qe){let t=new qe(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:Xo(e.serializer,t)}}else{if(n instanceof Ss)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof dr)return{bytesValue:PI(e.serializer,n._byteString)};if(n instanceof Me){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:j_(n.firestore._databaseId||e.databaseId,n._key.path)}}else{if(n instanceof ec)return n6(n,e);throw e.createError(`Unsupported field value: ${fc(n)}`)}}}function n6(n,e){return{mapValue:{fields:{[F_]:{stringValue:L_},[Ho]:{arrayValue:{values:n.toArray().map(r=>{if(typeof r!="number")throw e.createError("VectorValues must only contain numeric values.");return G_(e.serializer,r)})}}}}}}function JD(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof qe)&&!(n instanceof Ss)&&!(n instanceof dr)&&!(n instanceof Me)&&!(n instanceof Rr)&&!(n instanceof ec)}function b0(n,e,t){if(!JD(t)||!gz(t)){let r=fc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function __(n,e,t){if(e=Ve(e),e instanceof Vn)return e._internalPath;if(typeof e=="string")return S0(n,e);throw Bh("Field path arguments must be of type string or ",n,!1,void 0,t)}var r6=new RegExp("[~\\*/\\[\\]]");function S0(n,e,t){if(e.search(r6)>=0)throw Bh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Vn(...e.split("."))._internalPath}catch{throw Bh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Bh(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new M(D.INVALID_ARGUMENT,a+n+l)}function XD(n,e){return n.some(t=>t.isEqual(e))}var Cs=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Me(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new b_(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(lf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},b_=class extends Cs{data(){return super.data()}};function lf(n,e){return typeof e=="string"?S0(n,e):e instanceof Vn?e._internalPath:e._delegate._internalPath}function ZD(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new M(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var nc=class{},ws=class extends nc{};function Nr(n,e,...t){let r=[];e instanceof nc&&r.push(e),r=r.concat(t),d6(r);for(let i of r)n=i._apply(n);return n}var qh=class n extends ws{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return c1(e._query,t),new yt(e.firestore,e.converter,U_(e._query,t))}_parse(e){let t=As(e.firestore);return i6(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function e1(n,e,t){let r=e,i=lf("where",n);return qh._create(i,r,t)}var S_=class n extends nc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Ie.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(c6(e._query,t),new yt(e.firestore,e.converter,U_(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var C_=class n extends ws{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=s6(e._query,this._field,this._direction);return new yt(e.firestore,e.converter,wB(e._query,t))}};function t1(n,e="asc"){let t=e,r=lf("orderBy",n);return C_._create(r,t)}var Uh=class n extends ws{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new yt(e.firestore,e.converter,lh(e._query,this._limit,this._limitType))}};function n1(n){return ID("limit",n),Uh._create("limit",n,"F")}function r1(n){return ID("limitToLast",n),Uh._create("limitToLast",n,"L")}var zh=class n extends ws{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=l1(e,this.type,this._docOrFields,this._inclusive);return new yt(e.firestore,e.converter,EB(e._query,t))}};function i1(...n){return zh._create("startAt",n,!0)}function s1(...n){return zh._create("startAfter",n,!1)}var Gh=class n extends ws{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=l1(e,this.type,this._docOrFields,this._inclusive);return new yt(e.firestore,e.converter,TB(e._query,t))}};function o1(...n){return Gh._create("endBefore",n,!1)}function a1(...n){return Gh._create("endAt",n,!0)}function l1(n,e,t,r){if(t[0]=Ve(t[0]),t[0]instanceof Cs)return o6(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=As(n.firestore);return a6(n._query,n.firestore._databaseId,i,e,t,r)}}function i6(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new M(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){DA(o,s);let c=[];for(let u of o)c.push(IA(r,n,u));a={arrayValue:{values:c}}}else a=IA(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&DA(o,s),a=QD(t,e,o,s==="in"||s==="not-in");return de.create(i,s,a)}function s6(n,e,t){if(n.startAt!==null)throw new M(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new M(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ps(e,t)}function o6(n,e,t,r,i){if(!r)throw new M(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of Qo(n))if(o.field.isKeyField())s.push(fs(e,r.key));else{let a=r.data.field(o.field);if(Jh(a))throw new M(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new M(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new cr(s,i)}function a6(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new M(D.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new M(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!q_(n)&&c.indexOf("/")!==-1)throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(fe.fromString(c));if(!B.isDocumentKey(d))throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let f=new B(d);a.push(fs(e,f))}else{let d=QD(t,r,c);a.push(d)}}return new cr(a,s)}function IA(n,e,t){if(t=Ve(t),typeof t=="string"){if(t==="")throw new M(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!q_(e)&&t.indexOf("/")!==-1)throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(fe.fromString(t));if(!B.isDocumentKey(r))throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return fs(n,new B(r))}else{if(t instanceof Me)return fs(n,t._key);throw new M(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${fc(t)}.`)}}function DA(n,e){if(!Array.isArray(n)||n.length===0)throw new M(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function l6(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function c1(n,e){let t=u6(n.filters,l6(e.op));if(t!==null)throw t===e.op?new M(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new M(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function c6(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)c1(t,i),t=U_(t,i)}function u6(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function d6(n){let e=n.filter(r=>r instanceof S_).length,t=n.filter(r=>r instanceof qh).length;if(e>1||e>0&&t>0)throw new M(D.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var aa=class{convertValue(e,t="none"){switch(hs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Le(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ci(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw G()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ts(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Ho].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Le(o.doubleValue));return new ec(s)}convertGeoPoint(e){return new Ss(Le(e.latitude),Le(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=P_(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Fl(e));default:return null}}convertTimestamp(e){let t=Ar(e);return new qe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=fe.fromString(e);$(HI(r));let i=new wi(r.get(1),r.get(3)),s=new B(r.popFirst(5));return i.isEqual(t)||Be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function cf(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var w_=class extends aa{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,t)}};function E_(n){return h6(n,["next","error","complete"])}function h6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var kr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},wn=class extends Cs{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new ki(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(lf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},ki=class extends wn{data(e={}){return super.data(e)}},Bn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new kr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ki(this._firestore,this._userDataWriter,r.key,r,new kr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new M(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=f6(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function f6(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new ki(n._firestore,n._userDataWriter,r.doc.key,r.doc,new kr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new ki(n._firestore,n._userDataWriter,r.doc.key,r.doc,new kr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:p6(r.type),doc:i,oldIndex:s,newIndex:o}})}}function p6(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return G()}}function C0(n,e){return n instanceof wn&&e instanceof wn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Bn&&e instanceof Bn?n._firestore===e._firestore&&y0(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function u1(n){n=ge(n,Me);let e=ge(n.firestore,Ue),t=vt(e);return kD(t,n._key).then(r=>A0(e,n,r))}var xr=class extends aa{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new Me(this.firestore,null,t)}};function d1(n){n=ge(n,Me);let e=ge(n.firestore,Ue),t=vt(e),r=new xr(e);return kz(t,n._key).then(i=>new wn(e,r,n._key,i,new kr(i!==null&&i.hasLocalMutations,!0),n.converter))}function h1(n){n=ge(n,Me);let e=ge(n.firestore,Ue),t=vt(e);return kD(t,n._key,{source:"server"}).then(r=>A0(e,n,r))}function f1(n){n=ge(n,yt);let e=ge(n.firestore,Ue),t=vt(e),r=new xr(e);return ZD(n._query),xD(t,n._query).then(i=>new Bn(e,r,n,i))}function p1(n){n=ge(n,yt);let e=ge(n.firestore,Ue),t=vt(e),r=new xr(e);return xz(t,n._query).then(i=>new Bn(e,r,n,i))}function m1(n){n=ge(n,yt);let e=ge(n.firestore,Ue),t=vt(e),r=new xr(e);return xD(t,n._query,{source:"server"}).then(i=>new Bn(e,r,n,i))}function w0(n,e,t){n=ge(n,Me);let r=ge(n.firestore,Ue),i=cf(n.converter,e,t),s=As(r),a=af(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,We.none());return va(r,[a])}function E0(n,e,t,...r){n=ge(n,Me);let i=ge(n.firestore,Ue),s=As(i);e=Ve(e);let o;typeof e=="string"||e instanceof Vn?o=_0(s,"updateDoc",n._key,e,t,r):o=v0(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,We.exists(!0));return va(i,[a])}function g1(n){let e=ge(n.firestore,Ue),t=[new Di(n._key,We.none())];return va(e,t)}function y1(n,e){let t=ge(n.firestore,Ue),r=pc(n),i=cf(n.converter,e),s=As(n.firestore),a=af(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,We.exists(!1));return va(t,[a]).then(()=>r)}function T0(n,...e){var t,r,i;n=Ve(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!E_(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(E_(e[o])){let f=e[o];e[o]=(t=f.next)===null||t===void 0?void 0:t.bind(f),e[o+1]=(r=f.error)===null||r===void 0?void 0:r.bind(f),e[o+2]=(i=f.complete)===null||i===void 0?void 0:i.bind(f)}let l,c,u;if(n instanceof Me)c=ge(n.firestore,Ue),u=ha(n._key.path),l={next:f=>{e[o]&&e[o](A0(c,n,f))},error:e[o+1],complete:e[o+2]};else{let f=ge(n,yt);c=ge(f.firestore,Ue),u=f._query;let v=new xr(c);l={next:w=>{e[o]&&e[o](new Bn(c,v,f,w))},error:e[o+1],complete:e[o+2]},ZD(n._query)}let d=vt(c);return Rz(d,u,a,l)}function v1(n,e){n=ge(n,Ue);let t=vt(n),r=E_(e)?e:{next:e};return Nz(t,r)}function va(n,e){let t=vt(n);return Mz(t,e)}function A0(n,e,t){let r=t.docs.get(e._key),i=new xr(n);return new wn(n,i,e._key,r,new kr(t.hasPendingWrites,t.fromCache),e.converter)}var m6={maxAttempts:5};function g6(n){if(n.maxAttempts<1)throw new M(D.INVALID_ARGUMENT,"Max attempts must be at least 1")}var jh=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=As(e)}set(e,t,r){this._verifyNotCommitted();let i=vi(e,this._firestore),s=cf(i.converter,t,r),o=af(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,We.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=vi(e,this._firestore);t=Ve(t);let o;return typeof t=="string"||t instanceof Vn?o=_0(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=v0(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,We.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=vi(e,this._firestore);return this._mutations=this._mutations.concat(new Di(t._key,We.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new M(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function vi(n,e){if(n=Ve(n),n.firestore!==e)throw new M(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var T_=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=As(e)}get(e){let t=vi(e,this._firestore),r=new w_(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return G();let s=i[0];if(s.isFoundDocument())return new Cs(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Cs(this._firestore,r,t._key,null,t.converter);throw G()})}set(e,t,r){let i=vi(e,this._firestore),s=cf(i.converter,t,r),o=af(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=vi(e,this._firestore);t=Ve(t);let o;return typeof t=="string"||t instanceof Vn?o=_0(this._dataReader,"Transaction.update",s._key,t,r,i):o=v0(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=vi(e,this._firestore);return this._transaction.delete(t._key),this}};var A_=class extends T_{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=vi(e,this._firestore),r=new xr(this._firestore);return super.get(e).then(i=>new wn(this._firestore,r,t._key,i._document,new kr(!1,!1),t.converter))}};function _1(n,e,t){n=ge(n,Ue);let r=Object.assign(Object.assign({},m6),t);g6(r);let i=vt(n);return Oz(i,s=>e(new A_(n,s)),r)}function b1(){return new tc("deleteField")}function S1(){return new m_("serverTimestamp")}function C1(...n){return new g_("arrayUnion",n)}function w1(...n){return new y_("arrayRemove",n)}function E1(n){return new v_("increment",n)}Jz("node");var y6="@firebase/firestore-compat",v6="0.3.38";function M0(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new M("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function T1(){if(typeof Uint8Array>"u")throw new M("unimplemented","Uint8Arrays are not available in this environment.")}function A1(){if(!JA())throw new M("unimplemented","Blobs are unavailable in Firestore in this environment.")}var uf=class n{constructor(e){this._delegate=e}static fromBase64String(e){return A1(),new n(dr.fromBase64String(e))}static fromUint8Array(e){return T1(),new n(dr.fromUint8Array(e))}toBase64(){return A1(),this._delegate.toBase64()}toUint8Array(){return T1(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function I0(n){return _6(n,["next","error","complete"])}function _6(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var D0=class{enableIndexedDbPersistence(e,t){return VD(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return BD(e._delegate)}clearIndexedDbPersistence(e){return UD(e._delegate)}},df=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof wi||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&On("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){OD(this._delegate,e,t,r)}enableNetwork(){return GD(this._delegate)}disableNetwork(){return jD(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,d0("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return zD(this._delegate)}onSnapshotsInSync(e){return v1(this._delegate,e)}get app(){if(!this._appCompat)throw new M("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Sa(this,m0(this._delegate,e))}catch(t){throw Bt(t,"collection()","Firestore.collection()")}}doc(e){try{return new hr(this,pc(this._delegate,e))}catch(t){throw Bt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new xs(this,PD(this._delegate,e))}catch(t){throw Bt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return _1(this._delegate,t=>e(new hf(this,t)))}batch(){return vt(this._delegate),new ff(new jh(this._delegate,e=>va(this._delegate,e)))}loadBundle(e){return WD(this._delegate,e)}namedQuery(e){return HD(this._delegate,e).then(t=>t?new xs(this,t):null)}},_a=class extends aa{constructor(e){super(),this.firestore=e}convertBytes(e){return new uf(new dr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return hr.forKey(t,this.firestore,null)}};function b6(n){kA(n)}var hf=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new _a(e)}get(e){let t=Ds(e);return this._delegate.get(t).then(r=>new Rs(this._firestore,new wn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Ds(e);return r?(M0("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ds(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ds(e);return this._delegate.delete(t),this}},ff=class{constructor(e){this._delegate=e}set(e,t,r){let i=Ds(e);return r?(M0("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Ds(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Ds(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},ba=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new ki(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ks(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new _a(e),t),i.set(t,s)),s}};ba.INSTANCES=new WeakMap;var hr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new _a(e)}static forPath(e,t,r){if(e.length%2!==0)throw new M("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new Me(t._delegate,r,new B(e)))}static forKey(e,t,r){return new n(t,new Me(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Sa(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Sa(this.firestore,m0(this._delegate,e))}catch(t){throw Bt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Ve(e),e instanceof Me?g0(this._delegate,e):!1}set(e,t){t=M0("DocumentReference.set",t);try{return t?w0(this._delegate,e,t):w0(this._delegate,e)}catch(r){throw Bt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?E0(this._delegate,e):E0(this._delegate,e,t,...r)}catch(i){throw Bt(i,"updateDoc()","DocumentReference.update()")}}delete(){return g1(this._delegate)}onSnapshot(...e){let t=I1(e),r=D1(e,i=>new Rs(this.firestore,new wn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return T0(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=d1(this._delegate):e?.source==="server"?t=h1(this._delegate):t=u1(this._delegate),t.then(r=>new Rs(this.firestore,new wn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ba.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Bt(n,e,t){return n.message=n.message.replace(e,t),n}function I1(n){for(let e of n)if(typeof e=="object"&&!I0(e))return e;return{}}function D1(n,e){var t,r;let i;return I0(n[0])?i=n[0]:I0(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Rs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new hr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return C0(this._delegate,e._delegate)}},ks=class extends Rs{data(e){let t=this._delegate.data(e);return this._delegate._converter||xA(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},xs=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new _a(e)}where(e,t,r){try{return new n(this.firestore,Nr(this._delegate,e1(e,t,r)))}catch(i){throw Bt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Nr(this._delegate,t1(e,t)))}catch(r){throw Bt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Nr(this._delegate,n1(e)))}catch(t){throw Bt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Nr(this._delegate,r1(e)))}catch(t){throw Bt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Nr(this._delegate,i1(...e)))}catch(t){throw Bt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Nr(this._delegate,s1(...e)))}catch(t){throw Bt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Nr(this._delegate,o1(...e)))}catch(t){throw Bt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Nr(this._delegate,a1(...e)))}catch(t){throw Bt(t,"endAt()","Query.endAt()")}}isEqual(e){return y0(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=p1(this._delegate):e?.source==="server"?t=m1(this._delegate):t=f1(this._delegate),t.then(r=>new mc(this.firestore,new Bn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=I1(e),r=D1(e,i=>new mc(this.firestore,new Bn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return T0(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ba.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},R0=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ks(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},mc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new xs(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ks(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new R0(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ks(this._firestore,r))})}isEqual(e){return C0(this._delegate,e._delegate)}},Sa=class n extends xs{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new hr(this.firestore,e):null}doc(e){try{return e===void 0?new hr(this.firestore,pc(this._delegate)):new hr(this.firestore,pc(this._delegate,e))}catch(t){throw Bt(t,"doc()","CollectionReference.doc()")}}add(e){return y1(this._delegate,e).then(t=>new hr(this.firestore,t))}isEqual(e){return g0(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ba.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Ds(n){return ge(n,Me)}var k0=class n{constructor(...e){this._delegate=new Vn(...e)}static documentId(){return new n(Xe.keyField().canonicalString())}isEqual(e){return e=Ve(e),e instanceof Vn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var x0=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=S1();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=b1();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=C1(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=w1(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=E1(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var S6={Firestore:df,GeoPoint:Ss,Timestamp:qe,Blob:uf,Transaction:hf,WriteBatch:ff,DocumentReference:hr,DocumentSnapshot:Rs,Query:xs,QueryDocumentSnapshot:ks,QuerySnapshot:mc,CollectionReference:Sa,FieldPath:k0,FieldValue:x0,setLogLevel:b6,CACHE_SIZE_UNLIMITED:FD};function C6(n,e){n.INTERNAL.registerComponent(new Bi("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},S6)))}function w6(n){C6(n,(e,t)=>new df(e,t,new D0)),n.registerVersion(y6,v6,"node")}w6(Zt);function E6(n,e=Tc){return new Ns(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function R1(n,e){return E6(n,e)}function T6(n,e){return R1(n,e).pipe(Dc(void 0),Ac(),ve(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function P0(n,e){return R1(n,e).pipe(ve(t=>({payload:t,type:"query"})))}var pf=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=M1(r,t);return new gf(i,s,this.afs)}snapshotChanges(){return T6(this.ref,this.afs.schedulers.outsideAngular).pipe(Gt)}valueChanges(e={}){return this.snapshotChanges().pipe(ve(({payload:t})=>e.idField?Yt(ne({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return qn(this.ref.get(e)).pipe(Gt)}};function mf(n,e){return P0(n,e).pipe(Dc(void 0),Ac(),ve(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function k1(n,e,t){return mf(n,t).pipe(Ic((r,i)=>A6(r,i.map(s=>s.payload),e),[]),q0(),ve(r=>r.map(i=>({type:i.type,payload:i}))))}function A6(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=I6(n,r))}),n}function N0(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function I6(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return N0(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return N0(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return N0(n,e.oldIndex,1);break}return n}function x1(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var gf=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=mf(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ve(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Dc(void 0),Ac(),Ca(([r,i])=>i.length>0||!r),ve(([,r])=>r),Gt)}auditTrail(e){return this.stateChanges(e).pipe(Ic((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=x1(e);return k1(this.query,t,this.afs.schedulers.outsideAngular).pipe(Gt)}valueChanges(e={}){return P0(this.query,this.afs.schedulers.outsideAngular).pipe(ve(t=>t.payload.docs.map(r=>e.idField?Yt(ne({},r.data()),{[e.idField]:r.id}):r.data())),Gt)}get(e){return qn(this.query.get(e)).pipe(Gt)}add(e){return this.ref.add(e)}doc(e){return new pf(this.ref.doc(e),this.afs)}},O0=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?mf(this.query,this.afs.schedulers.outsideAngular).pipe(Gt):mf(this.query,this.afs.schedulers.outsideAngular).pipe(ve(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ca(t=>t.length>0),Gt)}auditTrail(e){return this.stateChanges(e).pipe(Ic((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=x1(e);return k1(this.query,t,this.afs.schedulers.outsideAngular).pipe(Gt)}valueChanges(e={}){return P0(this.query,this.afs.schedulers.outsideAngular).pipe(ve(r=>r.payload.docs.map(i=>e.idField?ne({[e.idField]:i.id},i.data()):i.data())),Gt)}get(e){return qn(this.query.get(e)).pipe(Gt)}},D6=new $e("angularfire2.enableFirestorePersistence"),R6=new $e("angularfire2.firestore.persistenceSettings"),k6=new $e("angularfire2.firestore.settings"),x6=new $e("angularfire2.firestore.use-emulator");function M1(n,e=t=>t){return{query:e(n),ref:n}}var Qt=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,f,v,w,A,T,P,U){this.schedulers=l;let L=Pa(t,a,r),I=u;d&&Jf(L,a,f,w,A,T,v,P),[this.firestore,this.persistenceEnabled$]=Kc(`${L.name}.firestore`,"AngularFirestore",L.name,()=>{let j=a.runOutsideAngular(()=>L.firestore());if(s&&j.settings(s),I&&j.useEmulator(...I),i&&!Nc(o)){let J=()=>{try{return qn(j.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(b){return typeof console<"u"&&console.warn(b),Or(!1)}};return[j,a.runOutsideAngular(J)]}else return[j,Or(!1)]},[s,I,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=M1(i,r),a=this.schedulers.ngZone.run(()=>s);return new gf(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new O0(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new pf(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ee(Us),ee(zs,8),ee(D6,8),ee(k6,8),ee(Ps),ee(Pr),ee(Wc),ee(R6,8),ee(x6,8),ee(Kb,8),ee(Wf,8),ee(Hf,8),ee(Kf,8),ee($f,8),ee(Qf,8),ee(Yf,8),ee(Ui,8))};static \u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var N1=(()=>{class n{constructor(t){this.db=t,this.accesoHeader="header service running...",this.dbPath="/header",this.headerRef=t.collection(this.dbPath)}getHeader(){return this.headerRef}updateHeader(t,r){return this.headerRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Qt))}}static{this.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var O1=(()=>{class n{constructor(t){this.headerService=t,this.header=new $c,console.log(this.headerService),this.headerService.getHeader().snapshotChanges().pipe(ve(r=>r.map(i=>ne({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.header=r[0],console.log(this.header)})}actualizarHeader(){this.header.id&&this.headerService.updateHeader(this.header.id,this.header).then(()=>{console.log("Header actualizado exitosamente")})}static{this.\u0275fac=function(r){return new(r||n)(_e(N1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-header"]],decls:13,vars:7,consts:[["headerForm","ngForm"],[1,"container","color-light"],[1,"form-box"],[3,"ngSubmit"],["type","text","name","name","placeholder","Nombre",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","goalLife","placeholder","Meta de vida",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","photoUrl","placeholder","URL de la foto",1,"txt",3,"ngModelChange","ngModel"],["type","email","name","email","placeholder","Correo electr\xF3nico",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","phoneNumber","placeholder","Tel\xE9fono",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","location","placeholder","Ubicaci\xF3n",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","socialNetwork","placeholder","Red social",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit"]],template:function(r,i){if(r&1){let s=et();V(0,"div",1)(1,"div",2)(2,"form",3,0),Te("ngSubmit",function(){return X(s),Z(i.actualizarHeader())}),V(4,"input",4),Ce("ngModelChange",function(a){return X(s),Se(i.header.name,a)||(i.header.name=a),Z(a)}),z(),V(5,"input",5),Ce("ngModelChange",function(a){return X(s),Se(i.header.goalLife,a)||(i.header.goalLife=a),Z(a)}),z(),V(6,"input",6),Ce("ngModelChange",function(a){return X(s),Se(i.header.photoUrl,a)||(i.header.photoUrl=a),Z(a)}),z(),V(7,"input",7),Ce("ngModelChange",function(a){return X(s),Se(i.header.email,a)||(i.header.email=a),Z(a)}),z(),V(8,"input",8),Ce("ngModelChange",function(a){return X(s),Se(i.header.phoneNumber,a)||(i.header.phoneNumber=a),Z(a)}),z(),V(9,"input",9),Ce("ngModelChange",function(a){return X(s),Se(i.header.location,a)||(i.header.location=a),Z(a)}),z(),V(10,"input",10),Ce("ngModelChange",function(a){return X(s),Se(i.header.socialNetwork,a)||(i.header.socialNetwork=a),Z(a)}),z(),V(11,"button",11),re(12,"Actualizar"),z()()()()}r&2&&(te(4),be("ngModel",i.header.name),te(),be("ngModel",i.header.goalLife),te(),be("ngModel",i.header.photoUrl),te(),be("ngModel",i.header.email),te(),be("ngModel",i.header.phoneNumber),te(),be("ngModel",i.header.location),te(),be("ngModel",i.header.socialNetwork))},dependencies:[zt,Ct,qt,Ut,Nt,Mt],styles:[".container.color-light[_ngcontent-%COMP%]{background-color:#fdfdfd;border-radius:12px;padding:2rem;max-width:600px;margin:2rem auto;box-shadow:0 0 15px #0000001a}.container.color-dark[_ngcontent-%COMP%]{background-color:#222;color:#fff;padding:1rem;text-align:center;border-radius:12px 12px 0 0}.form-box[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.txt[_ngcontent-%COMP%]{padding:.75rem 1rem;border:1px solid #ccc;border-radius:8px;font-size:1rem;width:100%;transition:border .3s}.txt[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn-submit[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:.75rem;border-radius:8px;font-weight:700;font-size:1rem;cursor:pointer;transition:background-color .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#0056b3}"]})}}return n})();var gc=class{constructor(){this.startDate="",this.endDate="",this.location="",this.position="",this.company="",this.accomplishment=""}};var P1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/work-experience",this.workExperienceRef=t.collection(this.dbPath)}getWorkExperience(){return this.workExperienceRef}createWorkExperience(t){return this.workExperienceRef.add(ne({},t))}deleteWorkExperience(t){return this.workExperienceRef.doc(t).delete()}update(t,r){return this.workExperienceRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Qt))}}static{this.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function O6(n,e){if(n&1){let t=et();V(0,"div",15)(1,"div",16)(2,"div",17)(3,"button",18),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.deleteJob(i.id))}),re(4,"Eliminar"),z(),V(5,"button",19),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.edit(i))}),re(6,"Actualizar"),z()(),V(7,"div",20),re(8),z()()()}if(n&2){let t=e.$implicit;te(8),Fs(" ",t.company," - ",t.position," ")}}var F1=(()=>{class n{constructor(t){this.workExperienceService=t,this.itemCount=0,this.text="Agregar",this.btntxt="Agregar",this.workExperience=[],this.myWorkExperience=new gc,console.log(this.workExperienceService),this.workExperienceService.getWorkExperience().snapshotChanges().pipe(ve(r=>r.map(i=>ne({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.workExperience=r,console.log(this.workExperience)})}AgregarJob(){this.myWorkExperience.id?this.workExperienceService.update(this.myWorkExperience.id,this.myWorkExperience).then(()=>{console.log("Update successfully!"),this.resetForm()}):this.workExperienceService.createWorkExperience(this.myWorkExperience).then(()=>{console.log("Created successfully"),this.resetForm()})}deleteJob(t){this.workExperienceService.deleteWorkExperience(t).then(()=>{console.log("delete item successfully!")}),console.log(t)}edit(t){this.myWorkExperience=ne({},t),this.btntxt="Actualizar"}resetForm(){this.myWorkExperience=new gc,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(_e(P1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-workexperience"]],decls:18,vars:8,consts:[["workForm","ngForm"],[1,"container","color-dark"],[1,"col3"],[1,"container","color-light"],[1,"form-box"],[3,"ngSubmit"],["type","text","name","startate","placeholder","Start date (mm/yyyy)",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","enddate","placeholder","End date (mm/yyyy)",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","loction","placeholder","Location",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","posion","placeholder","Position",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","copany","placeholder","Company",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","acomplishments","placeholder","Accomplishments",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit"],[1,"col2"],["class","list-container",4,"ngFor","ngForOf"],[1,"list-container"],[1,"list-content"],[1,"list-actions"],[1,"btn-delete",3,"click"],[1,"btn-edit",3,"click"],[1,"list-text"]],template:function(r,i){if(r&1){let s=et();V(0,"div",1)(1,"div",2)(2,"p"),re(3,"Work-experience items:"),z()()(),V(4,"div",3)(5,"div",4)(6,"form",5,0),Te("ngSubmit",function(){return X(s),Z(i.AgregarJob())}),V(8,"input",6),Ce("ngModelChange",function(a){return X(s),Se(i.myWorkExperience.startDate,a)||(i.myWorkExperience.startDate=a),Z(a)}),z(),V(9,"input",7),Ce("ngModelChange",function(a){return X(s),Se(i.myWorkExperience.endDate,a)||(i.myWorkExperience.endDate=a),Z(a)}),z(),V(10,"input",8),Ce("ngModelChange",function(a){return X(s),Se(i.myWorkExperience.location,a)||(i.myWorkExperience.location=a),Z(a)}),z(),V(11,"input",9),Ce("ngModelChange",function(a){return X(s),Se(i.myWorkExperience.position,a)||(i.myWorkExperience.position=a),Z(a)}),z(),V(12,"input",10),Ce("ngModelChange",function(a){return X(s),Se(i.myWorkExperience.company,a)||(i.myWorkExperience.company=a),Z(a)}),z(),V(13,"input",11),Ce("ngModelChange",function(a){return X(s),Se(i.myWorkExperience.accomplishment,a)||(i.myWorkExperience.accomplishment=a),Z(a)}),z(),V(14,"button",12),re(15),z()(),V(16,"div",13),ln(17,O6,9,2,"div",14),z()()()}r&2&&(te(8),be("ngModel",i.myWorkExperience.startDate),te(),be("ngModel",i.myWorkExperience.endDate),te(),be("ngModel",i.myWorkExperience.location),te(),be("ngModel",i.myWorkExperience.position),te(),be("ngModel",i.myWorkExperience.company),te(),be("ngModel",i.myWorkExperience.accomplishment),te(2),un(i.btntxt),te(2),cn("ngForOf",i.workExperience))},dependencies:[dn,zt,Ct,qt,Ut,Nt,Mt],styles:[".container.color-light[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 1rem}.form-box[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px #0000001a;max-width:500px;width:100%}.txt[_ngcontent-%COMP%]{width:100%;padding:.75rem;margin-bottom:1rem;font-size:1rem;border:1px solid #ccc;border-radius:6px;transition:border-color .3s}.txt[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:.75rem;background-color:#007bff;color:#fff;font-size:1rem;border:none;border-radius:6px;cursor:pointer;transition:background .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#0056b3}.list-container[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:1rem;margin-top:1rem}.list-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.list-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list-text[_ngcontent-%COMP%]{flex-grow:1;font-size:.95rem;color:#333}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-edit[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#0d6e83}"]})}}return n})();var vc=class{constructor(){this.fechaInic="",this.fechaFin="",this.titulo="",this.escuela=""}};var L1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/education",this.educationRef=t.collection(this.dbPath)}getEducation(){return this.educationRef}createEducation(t){return this.educationRef.add(ne({},t))}deleteEducation(t){return this.educationRef.doc(t).delete()}update(t,r){return this.educationRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Qt))}}static{this.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function F6(n,e){if(n&1){let t=et();V(0,"div",13)(1,"div",14)(2,"div",15)(3,"button",16),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.deleteJob(i.id))}),re(4,"Eliminar"),z(),V(5,"button",17),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.edit(i))}),re(6,"Actualizar"),z()(),V(7,"div",18),re(8),z()()()}if(n&2){let t=e.$implicit;te(8),H0(" ",t.escuela," - ",t.titulo," (",t.fechaInic," - ",t.fechaFin,") ")}}var V1=(()=>{class n{constructor(t){this.educationService=t,this.itemCount=0,this.btntxt="Agregar",this.goalText="",this.education=[],this.myeducation=new vc,console.log(this.educationService),this.educationService.getEducation().snapshotChanges().pipe(ve(r=>r.map(i=>ne({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.education=r,console.log(this.education)})}AgregarJob(){this.myeducation.id?this.educationService.update(this.myeducation.id,this.myeducation).then(()=>{console.log("Update successfully!"),this.resetForm()}):this.educationService.createEducation(this.myeducation).then(()=>{console.log("Created successfully"),this.resetForm()})}deleteJob(t){this.educationService.deleteEducation(t).then(()=>{console.log("delete item successfully!")}),console.log(t)}edit(t){this.myeducation=ne({},t),this.btntxt="Actualizar"}resetForm(){this.myeducation=new vc,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(_e(L1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-education"]],decls:20,vars:6,consts:[["eduForm","ngForm"],[1,"container","color-dark"],[1,"col3"],[1,"container","color-light"],[1,"form-box"],[3,"ngSubmit"],["type","text","name","fechaInic","placeholder","Fecha inicio (mm/yyyy)",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","fechaFin","placeholder","Fecha fin (mm/yyyy)",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","titulo","placeholder","T\xEDtulo",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","escuela","placeholder","Escuela",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit"],[1,"col2"],["class","list-container",4,"ngFor","ngForOf"],[1,"list-container"],[1,"list-content"],[1,"list-actions"],[1,"btn-delete",3,"click"],[1,"btn-edit",3,"click"],[1,"list-text"]],template:function(r,i){if(r&1){let s=et();V(0,"div",1)(1,"div",2)(2,"p"),re(3,"Registros educativos:"),z()()(),V(4,"div",3)(5,"div",4)(6,"form",5,0),Te("ngSubmit",function(){return X(s),Z(i.AgregarJob())}),V(8,"input",6),Ce("ngModelChange",function(a){return X(s),Se(i.myeducation.fechaInic,a)||(i.myeducation.fechaInic=a),Z(a)}),z(),Un(9,"br"),V(10,"input",7),Ce("ngModelChange",function(a){return X(s),Se(i.myeducation.fechaFin,a)||(i.myeducation.fechaFin=a),Z(a)}),z(),Un(11,"br"),V(12,"input",8),Ce("ngModelChange",function(a){return X(s),Se(i.myeducation.titulo,a)||(i.myeducation.titulo=a),Z(a)}),z(),Un(13,"br"),V(14,"input",9),Ce("ngModelChange",function(a){return X(s),Se(i.myeducation.escuela,a)||(i.myeducation.escuela=a),Z(a)}),z(),Un(15,"br"),V(16,"button",10),re(17),z()(),V(18,"div",11),ln(19,F6,9,4,"div",12),z()()()}r&2&&(te(8),be("ngModel",i.myeducation.fechaInic),te(2),be("ngModel",i.myeducation.fechaFin),te(2),be("ngModel",i.myeducation.titulo),te(2),be("ngModel",i.myeducation.escuela),te(3),un(i.btntxt),te(2),cn("ngForOf",i.education))},dependencies:[dn,zt,Ct,qt,Ut,Nt,Mt],styles:[".container.color-light[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 1rem}.form-box[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px #0000001a;max-width:500px;width:100%}.txt[_ngcontent-%COMP%]{width:100%;padding:.75rem;margin-bottom:1rem;font-size:1rem;border:1px solid #ccc;border-radius:6px;transition:border-color .3s}.txt[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:.75rem;background-color:#007bff;color:#fff;font-size:1rem;border:none;border-radius:6px;cursor:pointer;transition:background .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#0056b3}.list-container[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:1rem;margin-top:1rem}.list-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.list-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list-text[_ngcontent-%COMP%]{flex-grow:1;font-size:.95rem;color:#333}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-edit[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#0d6e83}"]})}}return n})();var _c=class{constructor(){this.titulo="",this.ano="",this.desc=""}};var B1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/certificates",this.certificatesRef=t.collection(this.dbPath)}getCertificates(){return this.certificatesRef}createCertificates(t){return this.certificatesRef.add(ne({},t))}deleteCertificates(t){return this.certificatesRef.doc(t).delete()}update(t,r){return this.certificatesRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Qt))}}static{this.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function V6(n,e){if(n&1){let t=et();V(0,"div",12)(1,"div",13)(2,"div",14)(3,"button",15),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.deleteJob(i.id))}),re(4,"Eliminar"),z(),V(5,"button",16),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.edit(i))}),re(6,"Actualizar"),z()(),V(7,"div",17),re(8),z()()()}if(n&2){let t=e.$implicit;te(8),Fs(" ",t.titulo," - ",t.ano," ")}}var q1=(()=>{class n{constructor(t){this.certificatesService=t,this.itemCount=0,this.btntxt="Agregar",this.goalText="",this.certificates=[],this.myCertificates=new _c,console.log(this.certificatesService),this.certificatesService.getCertificates().snapshotChanges().pipe(ve(r=>r.map(i=>ne({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.certificates=r,console.log(this.certificates)})}AgregarJob(){this.myCertificates.id?this.certificatesService.update(this.myCertificates.id,this.myCertificates).then(()=>{console.log("Update successfully!"),this.resetForm()}):this.certificatesService.createCertificates(this.myCertificates).then(()=>{console.log("Created successfully"),this.resetForm()})}deleteJob(t){this.certificatesService.deleteCertificates(t).then(()=>{console.log("delete item successfully!")}),console.log(t)}edit(t){this.myCertificates=ne({},t),this.btntxt="Actualizar"}resetForm(){this.myCertificates=new _c,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(_e(B1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-certificates"]],decls:15,vars:5,consts:[["certForm","ngForm"],[1,"container","color-dark"],[1,"col3"],[1,"container","color-light"],[1,"form-box"],[3,"ngSubmit"],["type","text","name","titulo","placeholder","T\xEDtulo",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","ano","placeholder","A\xF1o",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","desc","placeholder","Descripci\xF3n",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit"],[1,"col2"],["class","list-container",4,"ngFor","ngForOf"],[1,"list-container"],[1,"list-content"],[1,"list-actions"],[1,"btn-delete",3,"click"],[1,"btn-edit",3,"click"],[1,"list-text"]],template:function(r,i){if(r&1){let s=et();V(0,"div",1)(1,"div",2)(2,"p"),re(3,"Certificados registrados:"),z()()(),V(4,"div",3)(5,"div",4)(6,"form",5,0),Te("ngSubmit",function(){return X(s),Z(i.AgregarJob())}),V(8,"input",6),Ce("ngModelChange",function(a){return X(s),Se(i.myCertificates.titulo,a)||(i.myCertificates.titulo=a),Z(a)}),z(),V(9,"input",7),Ce("ngModelChange",function(a){return X(s),Se(i.myCertificates.ano,a)||(i.myCertificates.ano=a),Z(a)}),z(),V(10,"input",8),Ce("ngModelChange",function(a){return X(s),Se(i.myCertificates.desc,a)||(i.myCertificates.desc=a),Z(a)}),z(),V(11,"button",9),re(12),z()(),V(13,"div",10),ln(14,V6,9,2,"div",11),z()()()}r&2&&(te(8),be("ngModel",i.myCertificates.titulo),te(),be("ngModel",i.myCertificates.ano),te(),be("ngModel",i.myCertificates.desc),te(2),un(i.btntxt),te(2),cn("ngForOf",i.certificates))},dependencies:[dn,zt,Ct,qt,Ut,Nt,Mt],styles:[".container.color-light[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 1rem}.form-box[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px #0000001a;max-width:500px;width:100%}.txt[_ngcontent-%COMP%]{width:100%;padding:.75rem;margin-bottom:1rem;font-size:1rem;border:1px solid #ccc;border-radius:6px;transition:border-color .3s}.txt[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:.75rem;background-color:#007bff;color:#fff;font-size:1rem;border:none;border-radius:6px;cursor:pointer;transition:background .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#0056b3}.list-container[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:1rem;margin-top:1rem}.list-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.list-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list-text[_ngcontent-%COMP%]{flex-grow:1;font-size:.95rem;color:#333}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-edit[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#0d6e83}"]})}}return n})();var bc=class{constructor(){this.skill="",this.percentage=""}};var U1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/skills",this.skillsRef=t.collection(this.dbPath)}getSkills(){return this.skillsRef}createSkills(t){return this.skillsRef.add(ne({},t))}deleteSkills(t){return this.skillsRef.doc(t).delete()}update(t,r){return this.skillsRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Qt))}}static{this.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function q6(n,e){if(n&1){let t=et();V(0,"div",9)(1,"div",10)(2,"div",11)(3,"button",12),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.deleteJob(i.id))}),re(4,"Eliminar"),z(),V(5,"button",13),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.edit(i))}),re(6,"Actualizar"),z()(),V(7,"div",14),re(8),z()()()}if(n&2){let t=e.$implicit;te(8),Fs(" ",t.skill," - ",t.percentage,"% ")}}var z1=(()=>{class n{constructor(t){this.skillsService=t,this.itemCount=0,this.btntxt="Agregar",this.goalText="",this.skills=[],this.mySkills=new bc,console.log(this.skillsService),this.skillsService.getSkills().snapshotChanges().pipe(ve(r=>r.map(i=>ne({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.skills=r,console.log(this.skills)})}AgregarJob(){this.mySkills.id?this.skillsService.update(this.mySkills.id,this.mySkills).then(()=>{console.log("Update successfully!"),this.resetForm()}):this.skillsService.createSkills(this.mySkills).then(()=>{console.log("Created successfully"),this.resetForm()})}deleteJob(t){this.skillsService.deleteSkills(t).then(()=>{console.log("delete item successfully!")}),console.log(t)}edit(t){this.mySkills=ne({},t),this.btntxt="Actualizar"}resetForm(){this.mySkills=new bc,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(_e(U1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-skills"]],decls:12,vars:4,consts:[["skillForm","ngForm"],[1,"container","color-light"],[1,"form-box"],[3,"ngSubmit"],["type","text","name","skill","placeholder","Habilidad",1,"txt",3,"ngModelChange","ngModel"],["type","text","name","percentage","placeholder","Porcentaje",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit"],[1,"col2"],["class","list-container",4,"ngFor","ngForOf"],[1,"list-container"],[1,"list-content"],[1,"list-actions"],[1,"btn-delete",3,"click"],[1,"btn-edit",3,"click"],[1,"list-text"]],template:function(r,i){if(r&1){let s=et();V(0,"div",1)(1,"div",2)(2,"form",3,0),Te("ngSubmit",function(){return X(s),Z(i.AgregarJob())}),V(4,"input",4),Ce("ngModelChange",function(a){return X(s),Se(i.mySkills.skill,a)||(i.mySkills.skill=a),Z(a)}),z(),Un(5,"br"),V(6,"input",5),Ce("ngModelChange",function(a){return X(s),Se(i.mySkills.percentage,a)||(i.mySkills.percentage=a),Z(a)}),z(),Un(7,"br"),V(8,"button",6),re(9),z()(),V(10,"div",7),ln(11,q6,9,2,"div",8),z()()()}r&2&&(te(4),be("ngModel",i.mySkills.skill),te(2),be("ngModel",i.mySkills.percentage),te(3),un(i.btntxt),te(2),cn("ngForOf",i.skills))},dependencies:[dn,zt,Ct,qt,Ut,Nt,Mt],styles:[".container.color-light[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 1rem}.form-box[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px #0000001a;max-width:500px;width:100%}.txt[_ngcontent-%COMP%]{width:100%;padding:.75rem;margin-bottom:1rem;font-size:1rem;border:1px solid #ccc;border-radius:6px;transition:border-color .3s}.txt[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:.75rem;background-color:#007bff;color:#fff;font-size:1rem;border:none;border-radius:6px;cursor:pointer;transition:background .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#0056b3}.list-container[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:1rem;margin-top:1rem}.list-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.list-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list-text[_ngcontent-%COMP%]{flex-grow:1;font-size:.95rem;color:#333}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-edit[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#0d6e83}"]})}}return n})();var Sc=class{constructor(){this.language=""}};var G1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/languages",this.languagesRef=t.collection(this.dbPath)}getLanguages(){return this.languagesRef}createLanguages(t){return this.languagesRef.add(ne({},t))}deleteLanguages(t){return this.languagesRef.doc(t).delete()}update(t,r){return this.languagesRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Qt))}}static{this.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function z6(n,e){if(n&1){let t=et();V(0,"div",10)(1,"div",11)(2,"div",12)(3,"button",13),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.deleteJob(i.id))}),re(4,"Eliminar"),z(),V(5,"button",14),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.edit(i))}),re(6,"Actualizar"),z()(),V(7,"div",15),re(8),z()()()}if(n&2){let t=e.$implicit;te(8),xc(" ",t.language," ")}}var j1=(()=>{class n{constructor(t){this.languagesService=t,this.itemCount=0,this.btntxt="Agregar",this.goalText="",this.languages=[],this.myLanguages=new Sc,console.log(this.languagesService),this.languagesService.getLanguages().snapshotChanges().pipe(ve(r=>r.map(i=>ne({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.languages=r,console.log(this.languages)})}AgregarJob(){this.myLanguages.id?this.languagesService.update(this.myLanguages.id,this.myLanguages).then(()=>{console.log("Update successfully!"),this.resetForm()}):this.languagesService.createLanguages(this.myLanguages).then(()=>{console.log("Created successfully"),this.resetForm()})}deleteJob(t){this.languagesService.deleteLanguages(t).then(()=>{console.log("delete item successfully!")}),console.log(t)}edit(t){this.myLanguages=ne({},t),this.btntxt="Actualizar"}resetForm(){this.myLanguages=new Sc,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(_e(G1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-languages"]],decls:13,vars:3,consts:[["langForm","ngForm"],[1,"container","color-dark"],[1,"col3"],[1,"container","color-light"],[1,"form-box"],[3,"ngSubmit"],["type","text","name","language","placeholder","Idioma",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit"],[1,"col2"],["class","list-container",4,"ngFor","ngForOf"],[1,"list-container"],[1,"list-content"],[1,"list-actions"],[1,"btn-delete",3,"click"],[1,"btn-edit",3,"click"],[1,"list-text"]],template:function(r,i){if(r&1){let s=et();V(0,"div",1)(1,"div",2)(2,"p"),re(3,"Idiomas registrados:"),z()()(),V(4,"div",3)(5,"div",4)(6,"form",5,0),Te("ngSubmit",function(){return X(s),Z(i.AgregarJob())}),V(8,"input",6),Ce("ngModelChange",function(a){return X(s),Se(i.myLanguages.language,a)||(i.myLanguages.language=a),Z(a)}),z(),V(9,"button",7),re(10),z()(),V(11,"div",8),ln(12,z6,9,1,"div",9),z()()()}r&2&&(te(8),be("ngModel",i.myLanguages.language),te(2),un(i.btntxt),te(2),cn("ngForOf",i.languages))},dependencies:[dn,zt,Ct,qt,Ut,Nt,Mt],styles:[".container.color-light[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 1rem}.form-box[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px #0000001a;max-width:500px;width:100%}.txt[_ngcontent-%COMP%]{width:100%;padding:.75rem;margin-bottom:1rem;font-size:1rem;border:1px solid #ccc;border-radius:6px;transition:border-color .3s}.txt[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:.75rem;background-color:#007bff;color:#fff;font-size:1rem;border:none;border-radius:6px;cursor:pointer;transition:background .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#0056b3}.list-container[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:1rem;margin-top:1rem}.list-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.list-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list-text[_ngcontent-%COMP%]{flex-grow:1;font-size:.95rem;color:#333}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-edit[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#0d6e83}"]})}}return n})();var Cc=class{constructor(){this.descripcion=""}};var W1=(()=>{class n{constructor(t){this.db=t,this.dbPath="/interests",this.interestsRef=t.collection(this.dbPath)}getInterests(){return this.interestsRef}createInterests(t){return this.interestsRef.add(ne({},t))}deleteInterests(t){return this.interestsRef.doc(t).delete()}update(t,r){return this.interestsRef.doc(t).update(r)}static{this.\u0275fac=function(r){return new(r||n)(ee(Qt))}}static{this.\u0275prov=Ke({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function j6(n,e){if(n&1){let t=et();V(0,"div",10)(1,"div",11)(2,"div",12)(3,"button",13),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.deleteJob(i.id))}),re(4,"Eliminar"),z(),V(5,"button",14),Te("click",function(){let i=X(t).$implicit,s=ct();return Z(s.edit(i))}),re(6,"Actualizar"),z()(),V(7,"div",15),re(8),z()()()}if(n&2){let t=e.$implicit;te(8),xc(" ",t.descripcion," ")}}var H1=(()=>{class n{constructor(t){this.interestsService=t,this.itemCount=0,this.btntxt="Agregar",this.goalText="",this.interests=[],this.myInterests=new Cc,console.log(this.interestsService),this.interestsService.getInterests().snapshotChanges().pipe(ve(r=>r.map(i=>ne({id:i.payload.doc.id},i.payload.doc.data())))).subscribe(r=>{this.interests=r,console.log(this.interests)})}AgregarJob(){this.myInterests.id?this.interestsService.update(this.myInterests.id,this.myInterests).then(()=>{console.log("Update successfully!"),this.resetForm()}):this.interestsService.createInterests(this.myInterests).then(()=>{console.log("Created successfully"),this.resetForm()})}deleteJob(t){this.interestsService.deleteInterests(t).then(()=>{console.log("delete item successfully!")}),console.log(t)}edit(t){this.myInterests=ne({},t),this.btntxt="Actualizar"}resetForm(){this.myInterests=new Cc,this.btntxt="Agregar"}static{this.\u0275fac=function(r){return new(r||n)(_e(W1))}}static{this.\u0275cmp=St({type:n,selectors:[["app-admin-interests"]],decls:13,vars:3,consts:[["interestForm","ngForm"],[1,"container","color-dark"],[1,"col3"],[1,"container","color-light"],[1,"form-box"],[3,"ngSubmit"],["type","text","name","descripcion","placeholder","Descripci\xF3n",1,"txt",3,"ngModelChange","ngModel"],["type","submit",1,"btn-submit"],[1,"col2"],["class","list-container",4,"ngFor","ngForOf"],[1,"list-container"],[1,"list-content"],[1,"list-actions"],[1,"btn-delete",3,"click"],[1,"btn-edit",3,"click"],[1,"list-text"]],template:function(r,i){if(r&1){let s=et();V(0,"div",1)(1,"div",2)(2,"p"),re(3,"Intereses registrados:"),z()()(),V(4,"div",3)(5,"div",4)(6,"form",5,0),Te("ngSubmit",function(){return X(s),Z(i.AgregarJob())}),V(8,"input",6),Ce("ngModelChange",function(a){return X(s),Se(i.myInterests.descripcion,a)||(i.myInterests.descripcion=a),Z(a)}),z(),V(9,"button",7),re(10),z()(),V(11,"div",8),ln(12,j6,9,1,"div",9),z()()()}r&2&&(te(8),be("ngModel",i.myInterests.descripcion),te(2),un(i.btntxt),te(2),cn("ngForOf",i.interests))},dependencies:[dn,zt,Ct,qt,Ut,Nt,Mt],styles:[".container.color-light[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:2rem 1rem}.form-box[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;box-shadow:0 4px 12px #0000001a;max-width:500px;width:100%}.txt[_ngcontent-%COMP%]{width:100%;padding:.75rem;margin-bottom:1rem;font-size:1rem;border:1px solid #ccc;border-radius:6px;transition:border-color .3s}.txt[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:.75rem;background-color:#007bff;color:#fff;font-size:1rem;border:none;border-radius:6px;cursor:pointer;transition:background .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#0056b3}.list-container[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:1rem;margin-top:1rem}.list-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}.list-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.list-text[_ngcontent-%COMP%]{flex-grow:1;font-size:.95rem;color:#333}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#a71d2a}.btn-edit[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;border:none;padding:.4rem .9rem;border-radius:6px;font-size:.9rem;cursor:pointer}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#0d6e83}"]})}}return n})();var W6=[{path:"header",component:O1},{path:"workexperience",component:F1},{path:"education",component:V1},{path:"certificates",component:q1},{path:"skills",component:z1},{path:"languages",component:j1},{path:"interests",component:H1}],K1=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Xt({type:n})}static{this.\u0275inj=Jt({imports:[Df.forRoot(W6),Df]})}}return n})();var yf=(()=>{class n{constructor(){this.title="admin-cv"}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=St({type:n,selectors:[["app-root"]],decls:27,vars:0,consts:[["routerLink","/header"],["routerLink","/workexperience"],["routerLink","/education"],["routerLink","/certificates"],["routerLink","/skills"],["routerLink","/languages"],["routerLink","/interests"]],template:function(r,i){r&1&&(V(0,"h3")(1,"b"),re(2," admin-Cv App "),z()(),V(3,"nav")(4,"ul")(5,"li")(6,"a",0),re(7," header "),z()(),V(8,"li")(9,"a",1),re(10," work-experience "),z()(),V(11,"li")(12,"a",2),re(13," education "),z()(),V(14,"li")(15,"a",3),re(16," certificates "),z()(),V(17,"li")(18,"a",4),re(19," skills "),z()(),V(20,"li")(21,"a",5),re(22," languages "),z()(),V(23,"li")(24,"a",6),re(25," interests "),z()()()(),Un(26,"router-outlet"))},dependencies:[eb,tb]})}}return n})();var $1=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Xt({type:n,bootstrap:[yf]})}static{this.\u0275inj=Jt({providers:[X0()],imports:[J0,K1,Rb,Nb.initializeApp(Ob.firebase)]})}}return n})();var H6=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=Xt({type:n,bootstrap:[yf]})}static{this.\u0275inj=Jt({imports:[$1,Z0]})}}return n})();export{H6 as a};
